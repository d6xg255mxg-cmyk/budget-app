<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#212529">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" id="pwa-manifest">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <title>Í∞ÄÍ≥ÑÎ∂Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            position: relative;
        }

        .lang-selector {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 10;
        }

        .lang-selector select {
            padding: 6px 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 13px;
            background: white;
            cursor: pointer;
            color: #495057;
        }

        .header {
            background: white;
            color: #333;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #212529;
        }

        .month-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .month-selector button {
            background: white;
            border: 1px solid #dee2e6;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .month-selector button:hover {
            background: #f8f9fa;
        }

        .month-selector span {
            font-weight: 600;
            font-size: 18px;
            min-width: 150px;
            color: #212529;
        }

        .balance-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }

        .balance-hero {
            text-align: center;
            padding: 24px 20px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #212529 0%, #343a40 100%);
            border-radius: 10px;
            color: white;
            position: relative;
        }

        .balance-hero-label {
            font-size: 13px;
            color: rgba(255,255,255,0.6);
            margin-bottom: 6px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .balance-hero-amount {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: -0.5px;
            transition: all 0.3s ease;
        }

        .balance-hero-sub {
            font-size: 13px;
            color: rgba(255,255,255,0.5);
            margin-top: 4px;
        }

        .balance-hero-row {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .balance-hero-stat {
            text-align: center;
        }

        .balance-hero-stat-label {
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 4px;
        }

        .balance-hero-stat-value {
            font-size: 18px;
            font-weight: 600;
        }

        .balance-hero-stat-value.positive {
            color: #69db7c;
        }

        .balance-hero-stat-value.negative {
            color: #ff8787;
        }

        .privacy-toggle {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.2s;
            line-height: 1;
        }

        .privacy-toggle:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .hero-mode-toggle {
            position: absolute;
            top: 16px;
            left: 16px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
            line-height: 1;
        }
        .hero-mode-toggle:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .transfer-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            background: #748ffc;
            color: white;
        }

        .amount-hidden {
            letter-spacing: 4px;
        }

        .asset-type-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            overflow: hidden;
        }

        .asset-type-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.2s;
            border-right: 1px solid #dee2e6;
        }

        .asset-type-tab:last-child {
            border-right: none;
        }

        .asset-type-tab.active {
            background: #212529;
            color: white;
        }

        .asset-type-tab:hover:not(.active) {
            background: #f8f9fa;
        }

        .asset-type-content {
            display: none;
        }

        .asset-type-content.active {
            display: block;
        }

        .coin-search-results {
            max-height: 180px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 6px 6px;
            background: white;
            display: none;
        }

        .coin-search-results.active {
            display: block;
        }

        .coin-search-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            cursor: pointer;
            font-size: 14px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.15s;
        }

        .coin-search-item:hover {
            background: #f8f9fa;
        }

        .coin-search-item img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .coin-search-item .coin-symbol {
            color: #6c757d;
            font-size: 12px;
            text-transform: uppercase;
        }

        .asset-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 6px;
        }

        .asset-badge.fiat { background: #e3f2fd; color: #1565c0; }
        .asset-badge.crypto { background: #fff3e0; color: #e65100; }
        .asset-badge.stock { background: #e8f5e9; color: #2e7d32; }

        .balance-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 18px;
            color: #495057;
        }

        .balance-item.total {
            border-top: 2px solid #dee2e6;
            padding-top: 15px;
            margin-top: 15px;
            font-weight: bold;
            font-size: 24px;
            color: #212529;
        }

        .balance-item.crypto {
            color: #6c757d;
            font-size: 16px;
            font-style: italic;
        }

        .tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: white;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #f8f9fa;
            color: #495057;
        }

        .tab.active {
            background: white;
            color: #212529;
            border-bottom: 2px solid #212529;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: white;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #495057;
        }

        .input-row {
            display: flex;
            gap: 10px;
        }

        .input-row .input-group {
            flex: 1;
        }

        .btn {
            background: #212529;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #343a40;
        }

        .btn:active {
            background: #1a1e21;
        }

        .btn-delete {
            background: #6c757d;
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-delete:hover {
            background: #5a6268;
        }

        .btn-edit {
            background: #495057;
            padding: 8px 16px;
            font-size: 14px;
            margin-right: 5px;
        }

        .btn-edit:hover {
            background: #343a40;
        }

        .list {
            margin-top: 30px;
        }

        .list-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
            border: 1px solid #e9ecef;
            cursor: move;
        }

        .list-item:hover {
            background: #f8f9fa;
        }

        .list-item.dragging {
            opacity: 0.5;
            background: #e9ecef;
        }

        .list-item.drag-over {
            border-top: 3px solid #495057;
        }

        .drag-handle {
            cursor: grab;
            color: #adb5bd;
            font-size: 20px;
            margin-right: 10px;
            user-select: none;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .list-item-info {
            flex: 1;
        }

        .list-item-name {
            font-weight: 600;
            font-size: 16px;
            color: #212529;
            margin-bottom: 5px;
        }

        .list-item-detail {
            font-size: 14px;
            color: #6c757d;
        }

        .payment-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .payment-badge.regular {
            background: #e9ecef;
            color: #495057;
        }

        .payment-badge.crypto {
            background: #fff3cd;
            color: #856404;
        }

        .payment-badge.income {
            background: #d4edda;
            color: #155724;
        }

        .list-item.income {
            border-left: 4px solid #28a745;
        }

        .list-item-amount.income {
            color: #28a745;
        }

        .balance-item.income {
            color: #28a745;
        }

        .category-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 5px;
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .category-selector {
            margin-top: 10px;
        }

        .category-selector select {
            padding: 4px 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 12px;
            background: white;
            cursor: pointer;
        }

        .category-stats-item {
            margin-bottom: 20px;
            cursor: pointer;
            padding: 10px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .category-stats-item:hover {
            background: #f8f9fa;
        }

        .list-item-amount {
            font-size: 20px;
            font-weight: bold;
            color: #212529;
            margin-right: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #adb5bd;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .salary-input {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin-bottom: 30px;
        }

        .salary-input h3 {
            margin-bottom: 15px;
            font-size: 20px;
            color: #212529;
        }

        .salary-input input {
            background: white;
        }

        .calendar-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header h3 {
            margin: 0;
            color: #212529;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .calendar-nav button {
            background: white;
            border: 1px solid #dee2e6;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .calendar-nav button:hover {
            background: #e9ecef;
        }

        .calendar-month {
            font-weight: 600;
            color: #212529;
            min-width: 120px;
            text-align: center;
        }

        .monthly-summary {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }

        .monthly-summary-title {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .monthly-summary-items {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .monthly-summary-item {
            flex: 1;
            min-width: 150px;
        }

        .monthly-summary-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .monthly-summary-value {
            font-size: 20px;
            font-weight: bold;
            color: #212529;
        }

        .monthly-summary-value.crypto {
            color: #6c757d;
        }

        .calendar {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e9ecef;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .calendar-weekday {
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            color: #495057;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            min-height: 80px;
            padding: 8px;
            border: 1px solid #e9ecef;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        .calendar-day:hover {
            background: #f8f9fa;
        }

        .calendar-day.other-month {
            background: #fafafa;
            color: #adb5bd;
        }

        .calendar-day.today {
            background: #fff9e6;
        }

        .calendar-day-number {
            font-size: 14px;
            font-weight: 600;
            color: #212529;
            margin-bottom: 4px;
        }

        .calendar-day.other-month .calendar-day-number {
            color: #adb5bd;
        }

        .calendar-day-expense {
            font-size: 12px;
            color: #495057;
            font-weight: 600;
            margin-top: 4px;
        }

        .calendar-day-items {
            font-size: 11px;
            color: #6c757d;
            margin-top: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 4px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .view-toggle button {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.2s;
        }

        .view-toggle button.active {
            background: white;
            color: #212529;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .data-management {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin-bottom: 20px;
        }

        .data-management h3 {
            margin-bottom: 15px;
            font-size: 18px;
            color: #212529;
        }

        .data-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-secondary {
            background: white;
            color: #212529;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #f8f9fa;
        }

        #importFile {
            display: none;
        }

        .image-upload-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin-bottom: 20px;
        }

        .image-upload-section h3 {
            margin-bottom: 15px;
            font-size: 18px;
            color: #212529;
        }

        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #495057;
            background: #f8f9fa;
        }

        .upload-area.dragover {
            border-color: #212529;
            background: #e9ecef;
        }

        #imageFile {
            display: none;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            margin-top: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #212529;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #212529;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .modal-close:hover {
            background: #f8f9fa;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-expense-item {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-expense-item:last-child {
            border-bottom: none;
        }

        .modal-expense-info {
            flex: 1;
        }

        .modal-expense-name {
            font-weight: 600;
            color: #212529;
            margin-bottom: 5px;
        }

        .modal-expense-amount {
            font-size: 18px;
            font-weight: bold;
            color: #212529;
        }

        .modal-total {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 2px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 18px;
        }

        .modal-empty {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .edit-form {
            padding: 20px;
        }

        .edit-form .input-group {
            margin-bottom: 15px;
        }

        .edit-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding: 15px 20px;
            border-top: 1px solid #e9ecef;
        }

        .btn-cancel {
            background: #e9ecef;
            color: #495057;
        }

        .btn-cancel:hover {
            background: #dee2e6;
        }

        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
            }

            .list-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .list-item-amount {
                margin: 10px 0;
            }
        }

        /* ===== Dark Mode ===== */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --border-color: #e9ecef;
            --border-light: #dee2e6;
            --text-primary: #212529;
            --text-secondary: #495057;
            --text-muted: #6c757d;
            --shadow: rgba(0,0,0,0.08);
            --hero-bg: linear-gradient(135deg, #212529 0%, #343a40 100%);
        }

        body.dark-mode {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #0f3460;
            --border-color: #1a3a5c;
            --border-light: #1a3a5c;
            --text-primary: #e4e6eb;
            --text-secondary: #b0b3b8;
            --text-muted: #8a8d91;
            --shadow: rgba(0,0,0,0.3);
            --hero-bg: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }

        body { background: var(--bg-secondary); color: var(--text-primary); }
        .container { background: var(--bg-primary); box-shadow: 0 2px 8px var(--shadow); }
        .header { background: var(--bg-primary); border-bottom-color: var(--border-color); }
        .header h1 { color: var(--text-primary); }
        .balance-summary { background: var(--bg-secondary); border-color: var(--border-color); }
        .balance-item { color: var(--text-secondary); }
        .balance-item.total { border-top-color: var(--border-light); color: var(--text-primary); }
        .balance-hero { background: var(--hero-bg); }
        .tabs { background: var(--bg-primary); border-bottom-color: var(--border-color); }
        .tab { background: var(--bg-primary); color: var(--text-muted); }
        .tab.active { color: var(--text-primary); border-bottom-color: var(--text-primary); }
        .tab:hover { background: var(--bg-secondary); }
        .content { background: var(--bg-primary); }
        .list-item { border-bottom-color: var(--border-color); }
        .list-item-name { color: var(--text-primary); }
        .list-item-detail { color: var(--text-muted); }
        .input-group label { color: var(--text-secondary); }
        .input-group input, .input-group select { background: var(--bg-secondary); color: var(--text-primary); border-color: var(--border-light); }
        .month-selector span { color: var(--text-primary); }
        .month-selector button { background: var(--bg-primary); border-color: var(--border-light); color: var(--text-primary); }
        .monthly-summary { background: var(--bg-secondary); border-color: var(--border-color); }
        .monthly-summary-title { color: var(--text-secondary); }
        .monthly-summary-label { color: var(--text-muted); }
        .monthly-summary-value { color: var(--text-primary); }
        .modal-content { background: var(--bg-primary); }
        .modal-header { border-bottom-color: var(--border-color); }
        .modal-header h3 { color: var(--text-primary); }
        .calendar-day { background: var(--bg-primary); border-color: var(--border-color); }
        .calendar-weekday { color: var(--text-muted); }
        .empty-state p { color: var(--text-muted); }
        .upload-area { background: var(--bg-secondary); border-color: var(--border-light); }
        .category-badge { background: var(--bg-secondary); color: var(--text-secondary); }
        .edit-form .input-group input, .edit-form .input-group select { background: var(--bg-secondary); color: var(--text-primary); border-color: var(--border-light); }
        .view-toggle button { background: var(--bg-primary); color: var(--text-muted); border-color: var(--border-light); }
        .view-toggle button.active { background: var(--text-primary); color: var(--bg-primary); }
        .data-management { background: var(--bg-secondary); border-color: var(--border-color); }
        .lang-selector select { background: var(--bg-primary); color: var(--text-secondary); border-color: var(--border-light); }
        .asset-type-tab { background: var(--bg-primary); color: var(--text-muted); border-color: var(--border-light); }
        .asset-type-tab.active { background: var(--text-primary); color: var(--bg-primary); }
        .coin-search-results { background: var(--bg-primary); border-color: var(--border-light); }
        .coin-search-item { border-bottom-color: var(--border-color); }
        .coin-search-item:hover { background: var(--bg-secondary); }
        .payment-badge { color: var(--text-secondary); }

        .dark-toggle {
            position: absolute;
            top: 15px;
            right: 140px;
            z-index: 10;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            transition: all 0.2s;
        }
        .dark-toggle:hover { background: var(--border-light); }

        /* ===== Search Bar ===== */
        .search-filter-bar {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .search-filter-bar input {
            flex: 1;
            min-width: 150px;
            padding: 10px 12px;
            border: 1px solid var(--border-light);
            border-radius: 6px;
            font-size: 14px;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        .search-filter-bar select {
            padding: 10px 12px;
            border: 1px solid var(--border-light);
            border-radius: 6px;
            font-size: 14px;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* ===== Budget Progress ===== */
        .budget-section { margin-bottom: 20px; }
        .budget-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        .budget-bar-track {
            height: 10px;
            background: var(--bg-secondary);
            border-radius: 5px;
            overflow: hidden;
        }
        .budget-bar-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        .budget-bar-fill.ok { background: linear-gradient(90deg, #69db7c, #51cf66); }
        .budget-bar-fill.warn { background: linear-gradient(90deg, #ffd43b, #fab005); }
        .budget-bar-fill.over { background: linear-gradient(90deg, #ff8787, #fa5252); }

        /* ===== Charts ===== */
        .chart-container {
            position: relative;
            margin: 20px 0;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .chart-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .chart-box {
            flex: 1;
            min-width: 280px;
        }

        /* ===== Google Drive ===== */
        .gdrive-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .gdrive-btn:hover { background: #3367d6; }
        .gdrive-btn:disabled { background: #a0c4ff; cursor: not-allowed; }

        /* ===== Collapsible Section ===== */
        .section-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        .section-toggle:hover { opacity: 0.8; }
        .section-toggle .toggle-arrow {
            transition: transform 0.3s;
            font-size: 14px;
            color: var(--text-muted);
        }
        .section-toggle.collapsed .toggle-arrow {
            transform: rotate(-90deg);
        }
        .section-body {
            overflow: hidden;
            transition: max-height 0.3s ease;
            max-height: 2000px;
        }
        .section-body.collapsed {
            max-height: 0;
        }

        @media (max-width: 600px) {
            .dark-toggle { right: 120px; top: 12px; }
            .chart-row { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="dark-toggle" onclick="toggleDarkMode()" id="darkToggle" title="Dark mode">üåô</button>
        <div class="lang-selector">
            <select id="langSelect" onchange="changeLanguage(this.value)">
                <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                <option value="en">üá¨üáß English</option>
                <option value="de">üá©üá™ Deutsch</option>
            </select>
        </div>
        <div class="header">
            <h1 data-i18n="title">üí∞ ÎÇòÏùò Í∞ÄÍ≥ÑÎ∂Ä</h1>
            <div class="month-selector">
                <button onclick="changeViewMonth(-1)">‚óÄ</button>
                <span id="viewMonth"></span>
                <button onclick="changeViewMonth(1)">‚ñ∂</button>
            </div>

            <!-- Total Assets Hero -->
            <div class="balance-hero">
                <button class="privacy-toggle" onclick="togglePrivacy()" id="privacyBtn" title="Hide/Show amounts">üëÅ</button>
                <button class="hero-mode-toggle" onclick="cycleHeroMode()" id="heroModeBtn" title="ÌëúÏãú Ï†ÑÌôò">‚öôÔ∏è</button>
                <div class="balance-hero-label" id="heroMainLabel" data-i18n="totalAssetLabel">Ï¥ù ÏûêÏÇ∞</div>
                <div class="balance-hero-amount" id="heroMainAmount">‚Ç¨0.00</div>
                <div class="balance-hero-sub" id="heroMainSub"></div>
                <div class="balance-hero-row">
                    <div class="balance-hero-stat">
                        <div class="balance-hero-stat-label" id="heroStat1Label" data-i18n="remaining">ÌÜµÏû• ÎÇ®ÏùÄ Í∏àÏï°</div>
                        <div class="balance-hero-stat-value positive" id="heroStat1Value">‚Ç¨0</div>
                    </div>
                    <div class="balance-hero-stat">
                        <div class="balance-hero-stat-label" id="heroStat2Label" data-i18n="monthlySpending">Ïù¥Î≤à Îã¨ ÏßÄÏ∂ú</div>
                        <div class="balance-hero-stat-value negative" id="heroStat2Value">‚Ç¨0</div>
                    </div>
                </div>
            </div>

            <div class="balance-summary">
                <div class="balance-item">
                    <span data-i18n="salary">ÏõîÍ∏â:</span>
                    <span class="privacy-amount" id="salaryDisplay">‚Ç¨0</span>
                </div>
                <div class="balance-item income">
                    <span data-i18n="otherIncome">+ Í∏∞ÌÉÄÏàòÏûÖ:</span>
                    <span class="privacy-amount" id="incomeDisplay">‚Ç¨0</span>
                </div>
                <div class="balance-item">
                    <span data-i18n="fixedExpense">Í≥†Ï†ïÏßÄÏ∂ú:</span>
                    <span class="privacy-amount" id="fixedExpenseDisplay">‚Ç¨0</span>
                </div>
                <div class="balance-item">
                    <span data-i18n="cardExpense">ÏùºÎ∞òÏπ¥Îìú ÏßÄÏ∂ú:</span>
                    <span class="privacy-amount" id="dailyExpenseDisplay">‚Ç¨0</span>
                </div>
                <div class="balance-item crypto">
                    <span data-i18n="cryptoCardExpense">ü™ô Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú ÏßÄÏ∂ú:</span>
                    <span class="privacy-amount" id="cryptoExpenseDisplay">‚Ç¨0</span>
                </div>
                <div class="balance-item" style="display: none;">
                    <span>üîÑ <span data-i18n="transfer">Ïù¥Ï≤¥</span>:</span>
                    <span class="privacy-amount" id="transferDisplay">‚Ç¨0</span>
                </div>
                <div class="balance-item total">
                    <span data-i18n="remaining">ÌÜµÏû• ÎÇ®ÏùÄ Í∏àÏï°:</span>
                    <span class="privacy-amount" id="remainingDisplay">‚Ç¨0</span>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(event, 'salary')" data-i18n="tabSalary">üíµ ÏõîÍ∏â</button>
            <button class="tab" onclick="switchTab(event, 'daily')" data-i18n="tabDaily">üìÖ ÏùºÎ≥ÑÏßÄÏ∂ú</button>
            <button class="tab" onclick="switchTab(event, 'assets')" data-i18n="tabAssets">üíé ÏûêÏÇ∞</button>
            <button class="tab" onclick="switchTab(event, 'stats')" data-i18n="tabStats">üìä ÏòàÏÇ∞/ÌÜµÍ≥Ñ</button>
        </div>

        <div class="content">
            <!-- ÏõîÍ∏â ÌÉ≠ -->
            <div id="salaryTab" class="tab-content active">
                <div class="data-management">
                    <h3 data-i18n="dataManagement">üìÅ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h3>
                    <p style="font-size: 14px; color: #6c757d; margin-bottom: 15px;">
                        <span data-i18n="dataManagementDesc">Îç∞Ïù¥ÌÑ∞Î•º ÌååÏùºÎ°ú Ï†ÄÏû•ÌïòÍ±∞ÎÇò Îã§Î•∏ Í∏∞Í∏∞ÏóêÏÑú Í∞ÄÏ†∏Ïò¨ Ïàò ÏûàÏäµÎãàÎã§.</span>
                    </p>
                    <div class="data-buttons">
                        <button class="btn btn-secondary" onclick="exportData()" data-i18n="export">üíæ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()" data-i18n="import">üìÇ Í∞ÄÏ†∏Ïò§Í∏∞</button>
                        <button class="gdrive-btn" onclick="saveToGDrive()" id="gdriveSaveBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M7.71 3.5L1.15 15l4.58 7.5h13.54l4.58-7.5L17.29 3.5H7.71zm-.28 1h2.87l-5.57 9.15-.01.02L2.97 15.5 7.43 4.5zm3.87 0h2.4l5.57 9.15-1.74 2.85H6.47L4.73 13.65 11.3 4.5zM19 15.5l-4.46 6H9.46L5 15.5h14z"/></svg>
                            Google Drive
                        </button>
                        <input type="file" id="importFile" accept=".json" onchange="importData(event)">
                    </div>
                </div>

                <div class="salary-input">
                    <h3 data-i18n="salaryInput">ÏõîÍ∏â ÏûÖÎ†•</h3>
                    <div class="input-row">
                        <div class="input-group">
                            <label data-i18n="selectMonth">Ïõî ÏÑ†ÌÉù</label>
                            <input type="month" id="salaryMonth">
                        </div>
                        <div class="input-group">
                            <label data-i18n="amountEuro">Í∏àÏï° (‚Ç¨)</label>
                            <input type="number" id="salaryInput" data-i18n-placeholder="enterSalary" placeholder="ÏõîÍ∏âÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                        </div>
                    </div>
                    <button class="btn" onclick="setSalary()" data-i18n="save">Ï†ÄÏû•</button>
                </div>

                <div class="list" id="salaryList">
                    <h3 style="margin: 20px 0 15px 0; color: #333;">ÏõîÎ≥Ñ ÏõîÍ∏â ÎÇ¥Ïó≠</h3>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; color: #495057; border: 1px solid #e9ecef; margin-top: 20px;">
                    <h4 style="margin-bottom: 10px; color: #212529;" data-i18n="usageGuide">üí° ÏÇ¨Ïö© ÏïàÎÇ¥</h4>
                    <p data-i18n="usageGuideDesc">Îß§Îã¨ Îã§Î•∏ ÏõîÍ∏âÏùÑ ÏûÖÎ†•Ìï† Ïàò ÏûàÏäµÎãàÎã§. Í∞ÄÏû• ÏµúÍ∑º ÏõîÍ∏âÏùÑ Í∏∞Ï§ÄÏúºÎ°ú ÎÇ®ÏùÄ Í∏àÏï°Ïù¥ Í≥ÑÏÇ∞Îê©ÎãàÎã§.</p>
                </div>
            </div>

            <!-- Í≥†Ï†ïÏßÄÏ∂ú ÌÉ≠ -->

            <!-- ÏùºÎ≥ÑÏßÄÏ∂ú ÌÉ≠ -->
            <div id="dailyTab" class="tab-content">
                <h2 style="margin-bottom: 20px;" data-i18n="addDailyExpense">ÏùºÎ≥Ñ ÏßÄÏ∂ú/ÏàòÏûÖ Ï∂îÍ∞Ä</h2>
                <div class="input-row">
                    <div class="input-group">
                        <label data-i18n="date">ÎÇ†Ïßú</label>
                        <input type="date" id="dailyDate">
                    </div>
                    <div class="input-group">
                        <label data-i18n="type">Ïú†Ìòï</label>
                        <select id="transactionType" onchange="updatePaymentMethodOptions()">
                            <option value="expense" data-i18n="expense">üí∏ ÏßÄÏ∂ú</option>
                            <option value="income" data-i18n="income">üí∞ ÏàòÏûÖ</option>
                            <option value="transfer" data-i18n="transfer">üîÑ Ïù¥Ï≤¥</option>
                        </select>
                    </div>
                </div>
                <!-- Ïù¥Ï≤¥ Ï†ÑÏö© ÌïÑÎìú -->
                <div id="transferFields" style="display: none;">
                    <div class="input-row">
                        <div class="input-group">
                            <label data-i18n="transferFrom">Ï∂úÍ∏à Í≥ÑÏ¢å</label>
                            <select id="transferFrom"></select>
                        </div>
                        <div class="input-group">
                            <label data-i18n="transferTo">ÏûÖÍ∏à Í≥ÑÏ¢å</label>
                            <select id="transferTo"></select>
                        </div>
                    </div>
                    <div id="transferAmountHint" style="display: none; padding: 8px 12px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;"></div>
                    <div class="input-row">
                        <div class="input-group">
                            <label data-i18n="transferMemo">Î©îÎ™® (ÏÑ†ÌÉù)</label>
                            <input type="text" id="transferMemo" data-i18n-placeholder="transferMemoPlaceholder" placeholder="Ïòà: ÏÉùÌôúÎπÑ Ïù¥Ï≤¥, ÌôòÏ†Ñ">
                        </div>
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label data-i18n="itemName">Ìï≠Î™©Î™Ö</label>
                        <input type="text" id="dailyName" data-i18n-placeholder="dailyNamePlaceholder" placeholder="Ïòà: ÏãùÎπÑ, ÍµêÌÜµÎπÑ, ÎπåÎ†§Ï§Ä Îèà ÌöåÏàò">
                    </div>
                    <div class="input-group">
                        <label data-i18n="amountEuro">Í∏àÏï° (‚Ç¨)</label>
                        <input type="number" id="dailyAmount" data-i18n-placeholder="enterAmount" placeholder="Í∏àÏï° ÏûÖÎ†•">
                    </div>
                </div>
                <div class="input-row" id="categoryGroupContainer">
                    <div class="input-group">
                        <label data-i18n="category">Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                        <select id="categorySelect">
                            <option value="">ü§ñ AI ÏûêÎèô Î∂ÑÎ•ò</option>
                            <option value="ÏãùÎπÑ">üçΩÔ∏è ÏãùÎπÑ</option>
                            <option value="ÍµêÌÜµÎπÑ">üöá ÍµêÌÜµÎπÑ</option>
                            <option value="ÏáºÌïë">üõçÔ∏è ÏáºÌïë</option>
                            <option value="Î¨∏ÌôîÏÉùÌôú">üé¨ Î¨∏ÌôîÏÉùÌôú</option>
                            <option value="Íµ¨ÎèÖÎ£å">üì± Íµ¨ÎèÖÎ£å</option>
                            <option value="ÏùòÎ£å">üè• ÏùòÎ£å</option>
                            <option value="ÍµêÏú°">üìö ÍµêÏú°</option>
                            <option value="Í∏∞ÌÉÄ">üì¶ Í∏∞ÌÉÄ</option>
                        </select>
                    </div>
                    <div class="input-group" id="paymentMethodGroupContainer">
                        <label data-i18n="paymentMethod">Í≤∞Ï†ú ÏàòÎã®</label>
                        <select id="paymentMethod">
                            <option value="regular" data-i18n="regularCard">üí≥ ÏùºÎ∞òÏπ¥Îìú (ÌÜµÏû•)</option>
                            <option value="crypto" data-i18n="cryptoCard">ü™ô Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú</option>
                        </select>
                    </div>
                </div>
                <div style="display: none;" id="paymentMethodGroup"></div>
                <button class="btn" onclick="addDailyExpense()" data-i18n="add">Ï∂îÍ∞Ä</button>

                <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: #212529;" data-i18n="categoryManagement">üìÅ Ïπ¥ÌÖåÍ≥†Î¶¨ Í¥ÄÎ¶¨</h4>
                            <p style="margin: 0; font-size: 14px; color: #6c757d;" data-i18n="addYourCategory">ÎÇòÎßåÏùò Ïπ¥ÌÖåÍ≥†Î¶¨Î•º Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî.</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="newCategoryName" data-i18n-placeholder="categoryName" placeholder="Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î¶Ñ" style="flex: 1; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <input type="text" id="newCategoryEmoji" data-i18n-placeholder="emoji" placeholder="Ïù¥Î™®ÏßÄ" style="width: 80px; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <button class="btn" onclick="addCustomCategory()" data-i18n="add">Ï∂îÍ∞Ä</button>
                    </div>
                    <div id="customCategoryList" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                    </div>
                </div>

                <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: #212529;" data-i18n="aiBulkClassify">ü§ñ Í∏∞Ï°¥ ÎÇ¥Ïó≠ AI Î∂ÑÎ•ò</h4>
                            <p style="margin: 0; font-size: 14px; color: #6c757d;" data-i18n="aiBulkClassifyDesc">Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä "Í∏∞ÌÉÄ"Ïù∏ Ìï≠Î™©Îì§ÏùÑ AIÍ∞Ä ÏûêÎèôÏúºÎ°ú Î∂ÑÎ•òÌï©ÎãàÎã§.</p>
                        </div>
                        <button class="btn" onclick="bulkClassifyExpenses(event)" style="white-space: nowrap;" data-i18n="bulkClassify">ÏùºÍ¥Ñ Î∂ÑÎ•ò</button>
                    </div>
                </div>

                <div class="view-toggle">
                    <button class="active" onclick="switchDailyView('list')" data-i18n="listView">üìã Î™©Î°ù</button>
                    <button onclick="switchDailyView('calendar')" data-i18n="calendarView">üìÖ Îã¨Î†•</button>
                </div>

                <div id="dailyListView">
                    <!-- Search / Filter -->
                    <div class="search-filter-bar">
                        <input type="text" id="expenseSearch" data-i18n-placeholder="searchExpenses" placeholder="ÏßÄÏ∂ú Ìï≠Î™© Í≤ÄÏÉâ..." oninput="filterDailyList()">
                        <select id="categoryFilter" onchange="filterDailyList()">
                            <option value="" data-i18n="allCategories">Ï†ÑÏ≤¥ Ïπ¥ÌÖåÍ≥†Î¶¨</option>
                        </select>
                        <select id="paymentFilter" onchange="filterDailyList()">
                            <option value="" data-i18n="allPayments">Ï†ÑÏ≤¥ Í≤∞Ï†úÏàòÎã®</option>
                            <option value="regular" data-i18n="regularCard">üí≥ ÏùºÎ∞òÏπ¥Îìú (ÌÜµÏû•)</option>
                            <option value="crypto" data-i18n="cryptoCard">ü™ô Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú</option>
                            <option value="income" data-i18n="income">üí∞ ÏàòÏûÖ</option>
                            <option value="transfer" data-i18n="transfer">üîÑ Ïù¥Ï≤¥</option>
                        </select>
                    </div>

                    <!-- ÏõîÎ≥Ñ Ï¥ù ÏßÄÏ∂ú ÏöîÏïΩ -->
                    <div class="monthly-summary" style="margin-bottom: 20px;">
                        <div class="monthly-summary-title" data-i18n="monthlyTotal">üìä Ïù¥Î≤à Îã¨ Ï¥ùÍ≥Ñ</div>
                        <div class="monthly-summary-items">
                            <div class="monthly-summary-item">
                                <div class="monthly-summary-label" data-i18n="cardExpenseShort">üí≥ ÏùºÎ∞òÏπ¥Îìú ÏßÄÏ∂ú</div>
                                <div class="monthly-summary-value" id="listMonthlyRegularTotal">‚Ç¨0.00</div>
                            </div>
                            <div class="monthly-summary-item">
                                <div class="monthly-summary-label" data-i18n="cryptoCardExpenseShort">ü™ô Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú ÏßÄÏ∂ú</div>
                                <div class="monthly-summary-value crypto" id="listMonthlyCryptoTotal">‚Ç¨0.00</div>
                            </div>
                            <div class="monthly-summary-item">
                                <div class="monthly-summary-label" data-i18n="incomeLabel">üí∞ ÏàòÏûÖ</div>
                                <div class="monthly-summary-value" style="color: #28a745;" id="listMonthlyIncome">‚Ç¨0.00</div>
                            </div>
                            <div class="monthly-summary-item">
                                <div class="monthly-summary-label" data-i18n="netExpense">Ïàú ÏßÄÏ∂ú</div>
                                <div class="monthly-summary-value" id="listMonthlyNet">‚Ç¨0.00</div>
                            </div>
                        </div>
                    </div>

                    <div class="list" id="dailyList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìÖ</div>
                            <p>ÏïÑÏßÅ ÏùºÎ≥ÑÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
                        </div>
                    </div>
                </div>

                <div id="dailyCalendarView" style="display: none;">
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <h3 data-i18n="expenseCalendar">üìÖ ÏßÄÏ∂ú Îã¨Î†•</h3>
                            <div class="calendar-nav">
                                <button onclick="changeMonth(-1)">‚óÄ</button>
                                <span class="calendar-month" id="calendarMonth"></span>
                                <button onclick="changeMonth(1)">‚ñ∂</button>
                            </div>
                        </div>
                        
                        <!-- ÏõîÎ≥Ñ Ï¥ù ÏßÄÏ∂ú ÏöîÏïΩ -->
                        <div class="monthly-summary">
                            <div class="monthly-summary-title" data-i18n="monthlyTotal">üìä Ïù¥Î≤à Îã¨ Ï¥ùÍ≥Ñ</div>
                            <div class="monthly-summary-items">
                                <div class="monthly-summary-item">
                                    <div class="monthly-summary-label" data-i18n="cardExpenseShort">üí≥ ÏùºÎ∞òÏπ¥Îìú ÏßÄÏ∂ú</div>
                                    <div class="monthly-summary-value" id="monthlyRegularTotal">‚Ç¨0.00</div>
                                </div>
                                <div class="monthly-summary-item">
                                    <div class="monthly-summary-label" data-i18n="cryptoCardExpenseShort">ü™ô Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú ÏßÄÏ∂ú</div>
                                    <div class="monthly-summary-value crypto" id="monthlyCryptoTotal">‚Ç¨0.00</div>
                                </div>
                                <div class="monthly-summary-item">
                                    <div class="monthly-summary-label" data-i18n="incomeLabel">üí∞ ÏàòÏûÖ</div>
                                    <div class="monthly-summary-value" style="color: #28a745;" id="monthlyIncome">‚Ç¨0.00</div>
                                </div>
                                <div class="monthly-summary-item">
                                    <div class="monthly-summary-label" data-i18n="netExpense">Ïàú ÏßÄÏ∂ú</div>
                                    <div class="monthly-summary-value" id="monthlyNet">‚Ç¨0.00</div>
                                </div>
                            </div>
                        </div>

                        <div class="calendar">
                            <div class="calendar-weekdays">
                                <div class="calendar-weekday" data-i18n="sun">Ïùº</div>
                                <div class="calendar-weekday" data-i18n="mon">Ïõî</div>
                                <div class="calendar-weekday" data-i18n="tue">Ìôî</div>
                                <div class="calendar-weekday" data-i18n="wed">Ïàò</div>
                                <div class="calendar-weekday" data-i18n="thu">Î™©</div>
                                <div class="calendar-weekday" data-i18n="fri">Í∏à</div>
                                <div class="calendar-weekday" data-i18n="sat">ÌÜ†</div>
                            </div>
                            <div class="calendar-days" id="calendarDays"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÏûêÏÇ∞ ÌÉ≠ -->
            <div id="assetsTab" class="tab-content">
                <h2 style="margin-bottom: 20px;" data-i18n="assetManagement">üíé ÏûêÏÇ∞ Í¥ÄÎ¶¨</h2>
                
                <!-- ÏûêÏÇ∞ Ï∂îÍ∞Ä Ìèº -->
                <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;" data-i18n="addEditAsset">ÏûêÏÇ∞ Ï∂îÍ∞Ä/ÏàòÏ†ï</h3>
                    
                    <!-- Asset Type Tabs -->
                    <div class="asset-type-tabs">
                        <button class="asset-type-tab active" onclick="switchAssetType('fiat', event)">üè¶ <span data-i18n="assetTypeFiat">Î≤ïÏ†ïÌôîÌèê</span></button>
                        <button class="asset-type-tab" onclick="switchAssetType('crypto', event)">ü™ô <span data-i18n="assetTypeCrypto">ÏïîÌò∏ÌôîÌèê</span></button>
                        <button class="asset-type-tab" onclick="switchAssetType('stock', event)">üìà <span data-i18n="assetTypeStock">Ï£ºÏãù</span></button>
                    </div>

                    <!-- Fiat Form -->
                    <div id="assetFormFiat" class="asset-type-content active">
                        <div class="input-row">
                            <div class="input-group">
                                <label data-i18n="platformName">ÌîåÎû´ÌèºÎ™Ö</label>
                                <input type="text" id="fiatPlatform" data-i18n-placeholder="platformPlaceholder" placeholder="Ïòà: ÌïúÍµ≠ Ïã†ÌïúÏùÄÌñâ, ÎèÖÏùº Deutsche Bank">
                            </div>
                            <div class="input-group">
                                <label data-i18n="currency">ÌÜµÌôî</label>
                                <select id="fiatCurrency">
                                    <option value="EUR">EUR (‚Ç¨)</option>
                                    <option value="KRW">KRW (‚Ç©)</option>
                                    <option value="USD">USD ($)</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label data-i18n="balance">ÏûîÍ≥†</label>
                                <input type="number" id="fiatAmount" data-i18n-placeholder="enterAmount" placeholder="Í∏àÏï° ÏûÖÎ†•" step="0.01">
                            </div>
                            <div class="input-group">
                                <label data-i18n="memoOptional">Î©îÎ™® (ÏÑ†ÌÉù)</label>
                                <input type="text" id="fiatMemo" data-i18n-placeholder="memoPlaceholder" placeholder="Ïòà: ÎπÑÏÉÅÍ∏à, Ìà¨ÏûêÏö©">
                            </div>
                        </div>
                    </div>

                    <!-- Crypto Form -->
                    <div id="assetFormCrypto" class="asset-type-content">
                        <div class="input-row">
                            <div class="input-group">
                                <label data-i18n="platformName">ÌîåÎû´ÌèºÎ™Ö</label>
                                <input type="text" id="cryptoPlatform" placeholder="Ïòà: Binance, Coinbase, MetaMask">
                            </div>
                            <div class="input-group">
                                <label data-i18n="selectCoin">ÏΩîÏù∏ ÏÑ†ÌÉù</label>
                                <div style="position: relative;">
                                    <input type="text" id="cryptoSearch" autocomplete="off" data-i18n-placeholder="searchCoin" placeholder="Í≤ÄÏÉâ (Ïòà: BTC, Solana, XRP...)" oninput="searchCoin(this.value)" onfocus="searchCoin(this.value)">
                                    <div class="coin-search-results" id="coinSearchResults"></div>
                                </div>
                                <input type="hidden" id="selectedCoinId">
                                <input type="hidden" id="selectedCoinSymbol">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label data-i18n="quantity">ÏàòÎüâ</label>
                                <input type="number" id="cryptoAmount" data-i18n-placeholder="enterQuantity" placeholder="Î≥¥Ïú† ÏàòÎüâ" step="0.00000001">
                            </div>
                            <div class="input-group">
                                <label data-i18n="memoOptional">Î©îÎ™® (ÏÑ†ÌÉù)</label>
                                <input type="text" id="cryptoMemo" data-i18n-placeholder="memoPlaceholder" placeholder="Ïòà: Ïû•Í∏∞ Î≥¥Ïú†, Ïä§ÌÖåÏù¥ÌÇπ">
                            </div>
                        </div>
                    </div>

                    <!-- Stock Form -->
                    <div id="assetFormStock" class="asset-type-content">
                        <div class="input-row">
                            <div class="input-group">
                                <label data-i18n="platformName">ÌîåÎû´ÌèºÎ™Ö</label>
                                <input type="text" id="stockPlatform" placeholder="Ïòà: Trade Republic, Interactive Brokers">
                            </div>
                            <div class="input-group">
                                <label data-i18n="stockTicker">Ï¢ÖÎ™© Ìã∞Ïª§</label>
                                <input type="text" id="stockTicker" data-i18n-placeholder="tickerPlaceholder" placeholder="Ïòà: AAPL, TSLA, 005930.KS" style="text-transform: uppercase;">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label data-i18n="shares">Î≥¥Ïú† Ï£ºÏàò</label>
                                <input type="number" id="stockShares" data-i18n-placeholder="enterShares" placeholder="Ï£ºÏãù ÏàòÎüâ" step="0.001">
                            </div>
                            <div class="input-group">
                                <label data-i18n="pricePerShare">Ï£ºÎãπ Í∞ÄÍ≤© (‚Ç¨)</label>
                                <input type="number" id="stockPrice" data-i18n-placeholder="currentPrice" placeholder="ÌòÑÏû¨ Ï£ºÎãπ Í∞ÄÍ≤©" step="0.01">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label data-i18n="memoOptional">Î©îÎ™® (ÏÑ†ÌÉù)</label>
                                <input type="text" id="stockMemo" placeholder="Ïòà: Ïû•Í∏∞ Ìà¨Ïûê, Î∞∞ÎãπÏ£º">
                            </div>
                        </div>
                    </div>

                    <button class="btn" onclick="addOrUpdateAsset()" data-i18n="add">Ï∂îÍ∞Ä</button>
                </div>

                <!-- Ï¥ù ÏûêÏÇ∞ ÏöîÏïΩ -->
                <div class="monthly-summary" style="margin-bottom: 20px;">
                    <div class="monthly-summary-title" data-i18n="totalAssetsEUR">üí∞ Ï¥ù ÏûêÏÇ∞ (EUR ÌôòÏÇ∞)</div>
                    <div style="font-size: 32px; font-weight: bold; color: #212529; margin-top: 10px;" id="totalAssetsEUR">
                        ‚Ç¨0.00
                    </div>
                    <div style="margin-top: 12px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" onclick="fetchLiveRates()" style="padding: 8px 16px; font-size: 13px; background: #495057;" data-i18n="fetchLiveRates">üîÑ Ïã§ÏãúÍ∞Ñ ÌôòÏú® Ï°∞Ìöå</button>
                        <span id="rateStatus" style="font-size: 13px; color: #6c757d;" data-i18n="defaultRatesUsed">üìå Í∏∞Î≥∏ ÌôòÏú® ÏÇ¨Ïö© Ï§ë</span>
                    </div>
                </div>

                <!-- ÏûêÏÇ∞ Î™©Î°ù -->
                <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef;">
                    <h3 style="margin-bottom: 15px;" data-i18n="assetList">ÏûêÏÇ∞ Î™©Î°ù</h3>
                    <div id="assetsList"></div>
                </div>
            </div>

            <!-- ÌÜµÍ≥Ñ ÌÉ≠ -->
            <div id="statsTab" class="tab-content">
                <h2 style="margin-bottom: 20px;" data-i18n="budgetAndStats">üìä ÏòàÏÇ∞ / ÌÜµÍ≥Ñ</h2>

                <!-- ===== Í≥†Ï†ïÏßÄÏ∂ú ÏÑπÏÖò (Ï†ëÍ∏∞ Í∞ÄÎä•) ===== -->
                <div style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div class="section-toggle collapsed" onclick="toggleSection('fixedSection', this)">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <h3 style="margin: 0; color: var(--text-primary);" data-i18n="fixedExpenses">üìå Í≥†Ï†ïÏßÄÏ∂ú</h3>
                            <span id="fixedTotalBadge" style="font-size: 15px; font-weight: 700; color: #5c7cfa;"></span>
                            <span id="fixedCountBadge" style="font-size: 12px; color: var(--text-muted);"></span>
                        </div>
                        <span class="toggle-arrow">‚ñº</span>
                    </div>
                    <div class="section-body collapsed" id="fixedSection">
                        <!-- ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú -->
                        <div class="image-upload-section" style="margin-top: 15px;">
                            <h4 style="margin-bottom: 8px;" data-i18n="photoAutoInput">üì∏ ÏÇ¨ÏßÑÏúºÎ°ú ÏûêÎèô ÏûÖÎ†•</h4>
                            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 10px;">
                                <span data-i18n="photoAutoInputDesc">Í≥†Ï†ïÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ Ï†ÅÌûå ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú Ïù∏ÏãùÌï¥ÏÑú ÏûÖÎ†•Ìï©ÎãàÎã§.</span>
                            </p>
                            <div class="upload-area" id="uploadArea" onclick="document.getElementById('imageFile').click()">
                                <div>üì∑</div>
                                <p style="margin: 10px 0; font-weight: 600;" data-i18n="clickOrDrag">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò Ïù¥ÎØ∏ÏßÄÎ•º ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</p>
                                <p style="font-size: 14px; color: var(--text-muted);" data-i18n="supportedFormats">PNG, JPG, JPEG ÌòïÏãù ÏßÄÏõê</p>
                            </div>
                            <input type="file" id="imageFile" accept="image/*" onchange="handleImageUpload(event)">
                            <img id="previewImage" class="preview-image" style="display: none;">
                            <div class="loading" id="loading">
                                <div class="spinner"></div>
                                <p data-i18n="analyzingImage">Ïù¥ÎØ∏ÏßÄÎ•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...</p>
                            </div>
                        </div>

                        <!-- Í≥†Ï†ïÏßÄÏ∂ú Ï∂îÍ∞Ä Ìèº -->
                        <div style="margin-top: 15px;">
                            <div class="input-row">
                                <div class="input-group">
                                    <label data-i18n="itemName">Ìï≠Î™©Î™Ö</label>
                                    <input type="text" id="fixedName" data-i18n-placeholder="fixedNamePlaceholder" placeholder="Ïòà: ÏõîÏÑ∏, ÌÜµÏã†ÎπÑ, Î≥¥ÌóòÎ£å">
                                </div>
                                <div class="input-group">
                                    <label data-i18n="amountEuro">Í∏àÏï° (‚Ç¨)</label>
                                    <input type="number" id="fixedAmount" data-i18n-placeholder="enterAmount" placeholder="Í∏àÏï° ÏûÖÎ†•">
                                </div>
                            </div>
                            <button class="btn" onclick="addFixedExpense()" data-i18n="add">Ï∂îÍ∞Ä</button>
                        </div>

                        <!-- Í≥†Ï†ïÏßÄÏ∂ú Î™©Î°ù -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--text-primary);" data-i18n="fixedExpenseList">Í≥†Ï†ïÏßÄÏ∂ú Î™©Î°ù</h4>
                            <p style="font-size: 12px; color: var(--text-muted); margin: 0;" data-i18n="dragToReorder">üí° ÎìúÎûòÍ∑∏Ìï¥ÏÑú ÏàúÏÑú Î≥ÄÍ≤Ω</p>
                        </div>
                        <div class="list" id="fixedList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìã</div>
                                <p>ÏïÑÏßÅ Í≥†Ï†ïÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ===== ÏòàÏÇ∞ Î™©Ìëú ===== -->
                <div class="monthly-summary" style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="monthly-summary-title" data-i18n="budgetGoals">üéØ ÏòàÏÇ∞ Î™©Ìëú</div>
                        <button class="btn" onclick="showBudgetSetup()" style="padding: 6px 14px; font-size: 13px;" data-i18n="setBudget">ÏÑ§Ï†ï</button>
                    </div>
                    <div id="budgetGoalsDisplay" style="margin-top: 10px;"></div>
                </div>

                <!-- Budget Setup (hidden) -->
                <div id="budgetSetupPanel" style="display:none; background: var(--bg-secondary); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 20px;">
                    <h4 style="margin-bottom: 12px;" data-i18n="setBudgetGoals">üéØ ÏòàÏÇ∞ Î™©Ìëú ÏÑ§Ï†ï</h4>
                    <div class="input-row">
                        <div class="input-group">
                            <label data-i18n="totalBudget">Ï¥ù ÏòàÏÇ∞ (‚Ç¨)</label>
                            <input type="number" id="totalBudgetInput" placeholder="Ïòà: 1500" step="10" oninput="updateVariableBudgetPreview()">
                        </div>
                    </div>
                    <div id="fixedInfoInSetup"></div>
                    <div id="categoryBudgetInputs" style="margin-top: 10px;"></div>
                    <div style="margin-top: 12px; display: flex; gap: 10px;">
                        <button class="btn" onclick="saveBudgetGoals()" data-i18n="save">Ï†ÄÏû•</button>
                        <button class="btn btn-secondary" onclick="hideBudgetSetup()" data-i18n="cancel">Ï∑®ÏÜå</button>
                    </div>
                </div>

                <!-- ===== Ï∞®Ìä∏ ===== -->
                <div class="chart-row">
                    <div class="chart-box">
                        <div class="chart-container">
                            <h4 style="margin-bottom: 10px; color: var(--text-primary);" data-i18n="categoryDonut">Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏßÄÏ∂ú</h4>
                            <canvas id="donutChart" width="300" height="300"></canvas>
                        </div>
                    </div>
                    <div class="chart-box">
                        <div class="chart-container">
                            <h4 style="margin-bottom: 10px; color: var(--text-primary);" data-i18n="monthlyComparison">ÏõîÎ≥Ñ ÏßÄÏ∂ú ÎπÑÍµê</h4>
                            <canvas id="barChart" width="300" height="300"></canvas>
                        </div>
                    </div>
                </div>

                <!-- ÏßÄÎÇúÎã¨ ÎåÄÎπÑ -->
                <div class="monthly-summary" style="margin-bottom: 20px;">
                    <div class="monthly-summary-title" data-i18n="vsLastMonth">ÏßÄÎÇúÎã¨ ÎåÄÎπÑ</div>
                    <div id="momComparison" style="margin-top: 10px;"></div>
                </div>

                <!-- Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Î∂ÑÏÑù -->
                <div class="monthly-summary" style="margin-bottom: 20px;">
                    <div class="monthly-summary-title" data-i18n="monthlyCategoryExpense">Ïù¥Î≤à Îã¨ Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏßÄÏ∂ú</div>
                    <div id="categoryStats"></div>
                </div>

                <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; color: var(--text-secondary); border: 1px solid var(--border-color);">
                    <h4 style="margin-bottom: 10px; color: var(--text-primary);" data-i18n="categoryGuide">üí° Ïπ¥ÌÖåÍ≥†Î¶¨ ÏïàÎÇ¥</h4>
                    <p data-i18n="categoryGuideDesc">AIÍ∞Ä ÏûêÎèôÏúºÎ°ú ÏßÄÏ∂ú Ìï≠Î™©ÏùÑ Î∂ÑÎ•òÌï©ÎãàÎã§. ÏàòÏ†ïÏù¥ ÌïÑÏöîÌïú Í≤ΩÏö∞ ÏùºÎ≥ÑÏßÄÏ∂ú ÌÉ≠ÏóêÏÑú Í∞Å Ìï≠Î™©ÏùÑ ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ÎÇ†ÏßúÎ≥Ñ ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ Î™®Îã¨ -->
    <div class="modal" id="dateModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modalDate"></h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
            </div>
        </div>
    </div>

    <!-- ÏßÄÏ∂ú ÏàòÏ†ï Î™®Îã¨ -->
    <div class="modal" id="editModal" onclick="closeEditModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 data-i18n="editTransaction">ÏßÄÏ∂ú/ÏàòÏûÖ ÏàòÏ†ï</h3>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="edit-form">
                <div class="input-group">
                    <label data-i18n="type">Ïú†Ìòï</label>
                    <select id="editTransactionType" onchange="updateEditPaymentMethodOptions()">
                        <option value="expense" data-i18n="expense">üí∏ ÏßÄÏ∂ú</option>
                        <option value="income" data-i18n="income">üí∞ ÏàòÏûÖ</option>
                    </select>
                </div>
                <div class="input-group">
                    <label data-i18n="date">ÎÇ†Ïßú</label>
                    <input type="date" id="editDate">
                </div>
                <div class="input-group">
                    <label data-i18n="itemName">Ìï≠Î™©Î™Ö</label>
                    <input type="text" id="editName" data-i18n-placeholder="itemName" placeholder="Ìï≠Î™©Î™Ö">
                </div>
                <div class="input-group">
                    <label data-i18n="amountEuro">Í∏àÏï° (‚Ç¨)</label>
                    <input type="number" id="editAmount" data-i18n-placeholder="amount" placeholder="Í∏àÏï°">
                </div>
                <div class="input-group">
                    <label data-i18n="category">Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="editCategory" style="flex: 1;">
                            <option value="ÏãùÎπÑ">üçΩÔ∏è ÏãùÎπÑ</option>
                            <option value="ÍµêÌÜµÎπÑ">üöá ÍµêÌÜµÎπÑ</option>
                            <option value="ÏáºÌïë">üõçÔ∏è ÏáºÌïë</option>
                            <option value="Î¨∏ÌôîÏÉùÌôú">üé¨ Î¨∏ÌôîÏÉùÌôú</option>
                            <option value="Íµ¨ÎèÖÎ£å">üì± Íµ¨ÎèÖÎ£å</option>
                            <option value="ÏùòÎ£å">üè• ÏùòÎ£å</option>
                            <option value="ÍµêÏú°">üìö ÍµêÏú°</option>
                            <option value="ÏàòÏûÖ">üí∞ ÏàòÏûÖ</option>
                            <option value="Í∏∞ÌÉÄ">üì¶ Í∏∞ÌÉÄ</option>
                        </select>
                        <button class="btn btn-secondary" onclick="aiClassifyInEdit(event)" style="white-space: nowrap;">ü§ñ AI</button>
                    </div>
                </div>
                <div class="input-group" id="editPaymentMethodGroup">
                    <label data-i18n="paymentMethod">Í≤∞Ï†ú ÏàòÎã®</label>
                    <select id="editPaymentMethod">
                        <option value="regular" data-i18n="regularCard">üí≥ ÏùºÎ∞òÏπ¥Îìú (ÌÜµÏû•)</option>
                        <option value="crypto" data-i18n="cryptoCard">ü™ô Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú</option>
                    </select>
                </div>
            </div>
            <div class="edit-actions">
                <button class="btn btn-cancel" onclick="closeEditModal()" data-i18n="cancel">Ï∑®ÏÜå</button>
                <button class="btn" onclick="saveEdit()" data-i18n="save">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <script>
        // ===== Îã§Íµ≠Ïñ¥ ÏßÄÏõê (i18n) =====
        let currentLang = localStorage.getItem('budgetAppLang') || 'ko';

        const translations = {
            ko: {
                title: 'üí∞ ÎÇòÏùò Í∞ÄÍ≥ÑÎ∂Ä',
                totalAssetLabel: 'Ï¥ù ÏûêÏÇ∞',
                monthlySpending: 'Ïù¥Î≤à Îã¨ ÏßÄÏ∂ú',
                salary: 'ÏõîÍ∏â:', otherIncome: '+ Í∏∞ÌÉÄÏàòÏûÖ:', fixedExpense: 'Í≥†Ï†ïÏßÄÏ∂ú:',
                cardExpense: 'ÏùºÎ∞òÏπ¥Îìú ÏßÄÏ∂ú:', cryptoCardExpense: 'ü™ô Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú ÏßÄÏ∂ú:',
                remaining: 'ÌÜµÏû• ÎÇ®ÏùÄ Í∏àÏï°:',
                tabSalary: 'üíµ ÏõîÍ∏â', tabDaily: 'üìÖ ÏùºÎ≥ÑÏßÄÏ∂ú',
                tabAssets: 'üíé ÏûêÏÇ∞', tabStats: 'üìä ÏòàÏÇ∞/ÌÜµÍ≥Ñ',
                budgetAndStats: 'üìä ÏòàÏÇ∞ / ÌÜµÍ≥Ñ', fixedExpenses: 'üìå Í≥†Ï†ïÏßÄÏ∂ú',
                dataManagement: 'üìÅ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨',
                dataManagementDesc: 'Îç∞Ïù¥ÌÑ∞Î•º ÌååÏùºÎ°ú Ï†ÄÏû•ÌïòÍ±∞ÎÇò Îã§Î•∏ Í∏∞Í∏∞ÏóêÏÑú Í∞ÄÏ†∏Ïò¨ Ïàò ÏûàÏäµÎãàÎã§.',
                export: 'üíæ ÎÇ¥Î≥¥ÎÇ¥Í∏∞', import: 'üìÇ Í∞ÄÏ†∏Ïò§Í∏∞',
                salaryInput: 'ÏõîÍ∏â ÏûÖÎ†•', selectMonth: 'Ïõî ÏÑ†ÌÉù',
                amountEuro: 'Í∏àÏï° (‚Ç¨)', enterSalary: 'ÏõîÍ∏âÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî',
                save: 'Ï†ÄÏû•', add: 'Ï∂îÍ∞Ä', cancel: 'Ï∑®ÏÜå',
                usageGuide: 'üí° ÏÇ¨Ïö© ÏïàÎÇ¥',
                usageGuideDesc: 'Îß§Îã¨ Îã§Î•∏ ÏõîÍ∏âÏùÑ ÏûÖÎ†•Ìï† Ïàò ÏûàÏäµÎãàÎã§. Í∞ÄÏû• ÏµúÍ∑º ÏõîÍ∏âÏùÑ Í∏∞Ï§ÄÏúºÎ°ú ÎÇ®ÏùÄ Í∏àÏï°Ïù¥ Í≥ÑÏÇ∞Îê©ÎãàÎã§.',
                photoAutoInput: 'üì∏ ÏÇ¨ÏßÑÏúºÎ°ú ÏûêÎèô ÏûÖÎ†•',
                photoAutoInputDesc: 'Í≥†Ï†ïÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ Ï†ÅÌûå ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú Ïù∏ÏãùÌï¥ÏÑú ÏûÖÎ†•Ìï©ÎãàÎã§.',
                clickOrDrag: 'ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò Ïù¥ÎØ∏ÏßÄÎ•º ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî',
                supportedFormats: 'PNG, JPG, JPEG ÌòïÏãù ÏßÄÏõê',
                analyzingImage: 'Ïù¥ÎØ∏ÏßÄÎ•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...',
                addFixedExpense: 'Í≥†Ï†ïÏßÄÏ∂ú Ï∂îÍ∞Ä', itemName: 'Ìï≠Î™©Î™Ö',
                fixedNamePlaceholder: 'Ïòà: ÏõîÏÑ∏, ÌÜµÏã†ÎπÑ, Î≥¥ÌóòÎ£å',
                enterAmount: 'Í∏àÏï° ÏûÖÎ†•', fixedExpenseList: 'Í≥†Ï†ïÏßÄÏ∂ú Î™©Î°ù',
                dragToReorder: 'üí° ÎìúÎûòÍ∑∏Ìï¥ÏÑú ÏàúÏÑú Î≥ÄÍ≤Ω',
                addDailyExpense: 'ÏùºÎ≥Ñ ÏßÄÏ∂ú/ÏàòÏûÖ Ï∂îÍ∞Ä', date: 'ÎÇ†Ïßú', type: 'Ïú†Ìòï',
                expense: 'üí∏ ÏßÄÏ∂ú', income: 'üí∞ ÏàòÏûÖ', transfer: 'üîÑ Ïù¥Ï≤¥',
                transferFrom: 'Ï∂úÍ∏à Í≥ÑÏ¢å', transferTo: 'ÏûÖÍ∏à Í≥ÑÏ¢å',
                transferMemo: 'Î©îÎ™® (ÏÑ†ÌÉù)', transferMemoPlaceholder: 'Ïòà: ÏÉùÌôúÎπÑ Ïù¥Ï≤¥, ÌôòÏ†Ñ',
                mainAccount: 'üè¶ Î©îÏù∏ ÌÜµÏû• (EUR)', krAccount: 'üá∞üá∑ ÌïúÍµ≠ ÌÜµÏû• (KRW)',
                cryptoAccount: 'ü™ô Í∞ÄÏÉÅÌôîÌèê', otherAccount: 'üìã Í∏∞ÌÉÄ',
                transferBadge: 'Ïù¥Ï≤¥', transferLabel: '‚Üí',
                heroModeBank: 'üè¶ ÌÜµÏû• ÏûîÏï°', heroModeAsset: 'üíé Ï¥ù ÏûêÏÇ∞', heroModeSpending: 'üí∏ Ïù¥Î≤àÎã¨ ÏßÄÏ∂ú',
                dailyNamePlaceholder: 'Ïòà: ÏãùÎπÑ, ÍµêÌÜµÎπÑ, ÎπåÎ†§Ï§Ä Îèà ÌöåÏàò',
                category: 'Ïπ¥ÌÖåÍ≥†Î¶¨', paymentMethod: 'Í≤∞Ï†ú ÏàòÎã®',
                regularCard: 'üí≥ ÏùºÎ∞òÏπ¥Îìú (ÌÜµÏû•)', cryptoCard: 'ü™ô Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú',
                categoryManagement: 'üìÅ Ïπ¥ÌÖåÍ≥†Î¶¨ Í¥ÄÎ¶¨',
                addYourCategory: 'ÎÇòÎßåÏùò Ïπ¥ÌÖåÍ≥†Î¶¨Î•º Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî.',
                categoryName: 'Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î¶Ñ', emoji: 'Ïù¥Î™®ÏßÄ',
                aiBulkClassify: 'ü§ñ Í∏∞Ï°¥ ÎÇ¥Ïó≠ AI Î∂ÑÎ•ò',
                aiBulkClassifyDesc: 'Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä "Í∏∞ÌÉÄ"Ïù∏ Ìï≠Î™©Îì§ÏùÑ AIÍ∞Ä ÏûêÎèôÏúºÎ°ú Î∂ÑÎ•òÌï©ÎãàÎã§.',
                bulkClassify: 'ÏùºÍ¥Ñ Î∂ÑÎ•ò',
                listView: 'üìã Î™©Î°ù', calendarView: 'üìÖ Îã¨Î†•',
                monthlyTotal: 'üìä Ïù¥Î≤à Îã¨ Ï¥ùÍ≥Ñ',
                cardExpenseShort: 'üí≥ ÏùºÎ∞òÏπ¥Îìú ÏßÄÏ∂ú', cryptoCardExpenseShort: 'ü™ô Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú ÏßÄÏ∂ú',
                incomeLabel: 'üí∞ ÏàòÏûÖ', netExpense: 'Ïàú ÏßÄÏ∂ú',
                expenseCalendar: 'üìÖ ÏßÄÏ∂ú Îã¨Î†•',
                sun: 'Ïùº', mon: 'Ïõî', tue: 'Ìôî', wed: 'Ïàò', thu: 'Î™©', fri: 'Í∏à', sat: 'ÌÜ†',
                assetManagement: 'üíé ÏûêÏÇ∞ Í¥ÄÎ¶¨', addEditAsset: 'ÏûêÏÇ∞ Ï∂îÍ∞Ä/ÏàòÏ†ï',
                platformName: 'ÌîåÎû´ÌèºÎ™Ö', platformPlaceholder: 'Ïòà: ÌïúÍµ≠ Ïã†ÌïúÏùÄÌñâ, ÎèÖÏùº Deutsche Bank',
                currency: 'ÌÜµÌôî', balance: 'ÏûîÍ≥†',
                memoOptional: 'Î©îÎ™® (ÏÑ†ÌÉù)', memoPlaceholder: 'Ïòà: ÎπÑÏÉÅÍ∏à, Ìà¨ÏûêÏö©',
                totalAssetsEUR: 'üí∞ Ï¥ù ÏûêÏÇ∞ (EUR ÌôòÏÇ∞)',
                fetchLiveRates: 'üîÑ Ïã§ÏãúÍ∞Ñ ÌôòÏú® Ï°∞Ìöå',
                defaultRatesUsed: 'üìå Í∏∞Î≥∏ ÌôòÏú® ÏÇ¨Ïö© Ï§ë',
                assetList: 'ÏûêÏÇ∞ Î™©Î°ù',
                categoryAnalysis: 'üìä Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏßÄÏ∂ú Î∂ÑÏÑù',
                monthlyCategoryExpense: 'Ïù¥Î≤à Îã¨ Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏßÄÏ∂ú',
                categoryGuide: 'üí° Ïπ¥ÌÖåÍ≥†Î¶¨ ÏïàÎÇ¥',
                categoryGuideDesc: 'AIÍ∞Ä ÏûêÎèôÏúºÎ°ú ÏßÄÏ∂ú Ìï≠Î™©ÏùÑ Î∂ÑÎ•òÌï©ÎãàÎã§. ÏàòÏ†ïÏù¥ ÌïÑÏöîÌïú Í≤ΩÏö∞ ÏùºÎ≥ÑÏßÄÏ∂ú ÌÉ≠ÏóêÏÑú Í∞Å Ìï≠Î™©ÏùÑ ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.',
                editTransaction: 'ÏßÄÏ∂ú/ÏàòÏûÖ ÏàòÏ†ï', amount: 'Í∏àÏï°',
                // Dynamic strings
                monthlySalaryHistory: 'ÏõîÎ≥Ñ ÏõîÍ∏â ÎÇ¥Ïó≠', delete: 'ÏÇ≠Ï†ú', edit: 'ÏàòÏ†ï',
                noSalaryYet: 'ÏïÑÏßÅ ÏõîÍ∏â ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.',
                noFixedYet: 'ÏïÑÏßÅ Í≥†Ï†ïÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.',
                noDailyYet: 'ÏïÑÏßÅ ÏùºÎ≥ÑÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.',
                noDailyThisMonth: 'Ïù¥Î≤à Îã¨ ÏùºÎ≥ÑÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.',
                noAssetsYet: 'Îì±Î°ùÎêú ÏûêÏÇ∞Ïù¥ ÏóÜÏäµÎãàÎã§.',
                noExpenseThisMonth: 'Ïù¥Î≤à Îã¨ ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.',
                noCategoryExpense: 'Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.',
                enterMonthAndAmount: 'ÏõîÍ≥º Í∏àÏï°ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                salarySaved: 'ÏõîÍ∏âÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!',
                enterNameAndAmount: 'Ìï≠Î™©Î™ÖÍ≥º Í∏àÏï°ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                enterAllFields: 'ÎÇ†Ïßú, Ìï≠Î™©Î™Ö, Í∏àÏï°ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                enterAllFieldsEdit: 'Î™®Îì† ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                edited: 'ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§!',
                aiClassifying: 'AI Î∂ÑÎ•ò Ï§ë...',
                classifying: 'Î∂ÑÎ•ò Ï§ë...',
                processing: 'Ï≤òÎ¶¨ Ï§ë...',
                enterCategoryName: 'Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                categoryExists: 'Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî Ïπ¥ÌÖåÍ≥†Î¶¨ÏûÖÎãàÎã§.',
                categoryAdded: 'Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!',
                deleteCategoryConfirm: 'Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                noCustomCategories: 'Ï∂îÍ∞ÄÌïú Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä ÏóÜÏäµÎãàÎã§.',
                nothingToClassify: 'Î∂ÑÎ•òÌï† Ìï≠Î™©Ïù¥ ÏóÜÏäµÎãàÎã§. Î™®Îì† Ìï≠Î™©Ïù¥ Ïù¥ÎØ∏ Î∂ÑÎ•òÎêòÏñ¥ ÏûàÏäµÎãàÎã§.',
                bulkClassifyStart: 'Í∞úÏùò Ìï≠Î™©ÏùÑ AIÎ°ú Î∂ÑÎ•òÌï©ÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.',
                classifyComplete: 'Í∞ú Ìï≠Î™©Ïùò Î∂ÑÎ•òÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!',
                classifyFailed: 'Í∞ú Ìï≠Î™© Î∂ÑÎ•ò Ïã§Ìå®',
                classifyError: 'Î∂ÑÎ•ò Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ',
                classifiedAs: 'Ïπ¥ÌÖåÍ≥†Î¶¨Î°ú Î∂ÑÎ•òÎêòÏóàÏäµÎãàÎã§.',
                enterItemNameFirst: 'Ìï≠Î™©Î™ÖÏùÑ Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                exportDone: 'Îç∞Ïù¥ÌÑ∞Î•º ÌååÏùºÎ°ú ÎÇ¥Î≥¥ÎÉàÏäµÎãàÎã§!',
                invalidFile: 'Ïò¨Î∞îÎ•∏ Í∞ÄÍ≥ÑÎ∂Ä Îç∞Ïù¥ÌÑ∞ ÌååÏùºÏù¥ ÏïÑÎãôÎãàÎã§.',
                mergeConfirm: 'Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏäµÎãàÎã§. Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Î•º Ïú†ÏßÄÌïòÍ≥† ÏÉà Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÍ∞ÄÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÌôïÏù∏: Îç∞Ïù¥ÌÑ∞ Î≥ëÌï©\nÏ∑®ÏÜå: Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú ÌõÑ Í∞ÄÏ†∏Ïò§Í∏∞',
                importDone: 'Îç∞Ïù¥ÌÑ∞Î•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Í∞ÄÏ†∏ÏôîÏäµÎãàÎã§!',
                importError: 'ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ',
                deleteAssetConfirm: 'Ïù¥ ÏûêÏÇ∞ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                imageOnly: 'Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎßå ÏóÖÎ°úÎìúÌï† Ïàò ÏûàÏäµÎãàÎã§.',
                fixedItemsAdded: 'Í∞úÏùò Í≥†Ï†ïÏßÄÏ∂ú Ìï≠Î™©Ïù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!',
                noValidExpense: 'Ïú†Ìö®Ìïú ÏßÄÏ∂ú ÎÇ¥Ïó≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.',
                imageAnalysisFailed: 'Ïù¥ÎØ∏ÏßÄÏóêÏÑú ÏßÄÏ∂ú ÎÇ¥Ïó≠ÏùÑ Ïù∏ÏãùÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§. ÏàòÎèôÏúºÎ°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                imageAnalysisError: 'Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ',
                aiAutoClassify: 'ü§ñ AI ÏûêÎèô Î∂ÑÎ•ò',
                yearMonth: (y, m) => `${y}ÎÖÑ ${m}Ïõî`,
                dateDisplay: (y, m, d, wd) => `${y}ÎÖÑ ${m}Ïõî ${d}Ïùº (${wd})`,
                itemCount: (n) => `${n}Í±¥`,
                subtotal: 'ÏÜåÍ≥Ñ',
                totalExpense: 'Ï¥ù ÏßÄÏ∂ú',
                regularCardLabel: 'üí≥ ÏùºÎ∞òÏπ¥Îìú', cryptoCardLabel: 'ü™ô Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú',
                incomeSection: 'üí∞ ÏàòÏûÖ',
                regularBadge: 'üí≥ ÏùºÎ∞ò', cryptoBadge: 'ü™ô Í∞ÄÏÉÅÌôîÌèê', incomeBadge: 'üí∞ ÏàòÏûÖ',
                liveTag: '(Ïã§ÏãúÍ∞Ñ)',
                rateLoading: '‚è≥ ÌôòÏú® Ï°∞Ìöå Ï§ë...',
                rateError: '‚ùå Ï°∞Ìöå Ïã§Ìå® (Í∏∞Î≥∏Í∞í ÏÇ¨Ïö© Ï§ë)',
                rateUpdated: 'ÏóÖÎç∞Ïù¥Ìä∏',
                // Category names
                catFood: 'ÏãùÎπÑ', catTransport: 'ÍµêÌÜµÎπÑ', catShopping: 'ÏáºÌïë',
                catEntertainment: 'Î¨∏ÌôîÏÉùÌôú', catSubscription: 'Íµ¨ÎèÖÎ£å',
                catMedical: 'ÏùòÎ£å', catEducation: 'ÍµêÏú°', catOther: 'Í∏∞ÌÉÄ', catIncome: 'ÏàòÏûÖ',
                enterPlatformAndBalance: 'ÌîåÎû´ÌèºÎ™ÖÍ≥º ÏûîÍ≥†Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                assetTypeFiat: 'Î≤ïÏ†ïÌôîÌèê', assetTypeCrypto: 'ÏïîÌò∏ÌôîÌèê', assetTypeStock: 'Ï£ºÏãù',
                selectCoin: 'ÏΩîÏù∏ ÏÑ†ÌÉù', searchCoin: 'Í≤ÄÏÉâ (Ïòà: BTC, Solana, XRP...)',
                quantity: 'ÏàòÎüâ', enterQuantity: 'Î≥¥Ïú† ÏàòÎüâ',
                stockTicker: 'Ï¢ÖÎ™© Ìã∞Ïª§', tickerPlaceholder: 'Ïòà: AAPL, TSLA, 005930.KS',
                shares: 'Ï£º', enterShares: 'Ï£ºÏãù ÏàòÎüâ',
                pricePerShare: 'Ï£ºÎãπ Í∞ÄÍ≤© (‚Ç¨)', currentPrice: 'ÌòÑÏû¨ Ï£ºÎãπ Í∞ÄÍ≤©',
                noCoinFound: 'ÏΩîÏù∏ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§',
                priceLoading: 'Í∞ÄÍ≤© Î°úÎî© Ï§ë...',
                priceFailed: 'Í∞ÄÍ≤© Ï°∞Ìöå Ïã§Ìå®',
                searchExpenses: 'ÏßÄÏ∂ú Ìï≠Î™© Í≤ÄÏÉâ...',
                allCategories: 'Ï†ÑÏ≤¥ Ïπ¥ÌÖåÍ≥†Î¶¨', allPayments: 'Ï†ÑÏ≤¥ Í≤∞Ï†úÏàòÎã®',
                budgetGoals: 'üéØ ÏòàÏÇ∞ Î™©Ìëú', setBudget: 'ÏÑ§Ï†ï',
                setBudgetGoals: 'üéØ ÏòàÏÇ∞ Î™©Ìëú ÏÑ§Ï†ï',
                totalBudget: 'Ï¥ù ÏòàÏÇ∞ (‚Ç¨)',
                budgetSaved: 'ÏòàÏÇ∞ Î™©ÌëúÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!',
                noBudgetSet: 'ÏòàÏÇ∞ Î™©ÌëúÎ•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.',
                spent: 'ÏßÄÏ∂ú', remaining2: 'ÎÇ®ÏùÄ Í∏àÏï°', over: 'Ï¥àÍ≥º',
                fixedLabel: 'Í≥†Ï†ï', variableLabel: 'Î≥ÄÎèô', variableBudget: 'Î≥ÄÎèôÏßÄÏ∂ú ÏòàÏÇ∞',
                categoryDonut: 'Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏßÄÏ∂ú', monthlyComparison: 'ÏõîÎ≥Ñ ÏßÄÏ∂ú ÎπÑÍµê',
                vsLastMonth: 'üìà ÏßÄÎÇúÎã¨ ÎåÄÎπÑ',
                noLastMonthData: 'ÏßÄÎÇúÎã¨ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.',
                increased: 'Ï¶ùÍ∞Ä', decreased: 'Í∞êÏÜå', same: 'ÎèôÏùº',
                gdriveSaving: 'Google Drive Ï†ÄÏû• Ï§ë...',
                gdriveSaved: 'Google DriveÏóê Ï†ÄÏû•Îê®!',
                gdriveError: 'Google Drive Ïó∞Í≤∞ Ïã§Ìå®',
                weekdays: ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'],
                monthNames: ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'],
            },
            en: {
                title: 'üí∞ My Budget',
                totalAssetLabel: 'Total Assets',
                monthlySpending: 'Monthly Spending',
                salary: 'Salary:', otherIncome: '+ Other Income:', fixedExpense: 'Fixed Expenses:',
                cardExpense: 'Card Expenses:', cryptoCardExpense: 'ü™ô Crypto Card Expenses:',
                remaining: 'Remaining Balance:',
                tabSalary: 'üíµ Salary', tabDaily: 'üìÖ Daily',
                tabAssets: 'üíé Assets', tabStats: 'üìä Budget/Stats',
                budgetAndStats: 'üìä Budget / Stats', fixedExpenses: 'üìå Fixed Expenses',
                dataManagement: 'üìÅ Data Management',
                dataManagementDesc: 'Save data to file or import from another device.',
                export: 'üíæ Export', import: 'üìÇ Import',
                salaryInput: 'Enter Salary', selectMonth: 'Select Month',
                amountEuro: 'Amount (‚Ç¨)', enterSalary: 'Enter your salary',
                save: 'Save', add: 'Add', cancel: 'Cancel',
                usageGuide: 'üí° Usage Guide',
                usageGuideDesc: 'You can enter different salaries each month. The remaining balance is calculated based on the most recent salary.',
                photoAutoInput: 'üì∏ Auto Input from Photo',
                photoAutoInputDesc: 'Upload a photo of your fixed expenses to automatically recognize and input them.',
                clickOrDrag: 'Click or drag an image here',
                supportedFormats: 'PNG, JPG, JPEG supported',
                analyzingImage: 'Analyzing image...',
                addFixedExpense: 'Add Fixed Expense', itemName: 'Item Name',
                fixedNamePlaceholder: 'e.g. Rent, Phone, Insurance',
                enterAmount: 'Enter amount', fixedExpenseList: 'Fixed Expenses List',
                dragToReorder: 'üí° Drag to reorder',
                addDailyExpense: 'Add Daily Expense/Income', date: 'Date', type: 'Type',
                expense: 'üí∏ Expense', income: 'üí∞ Income', transfer: 'üîÑ Transfer',
                transferFrom: 'From', transferTo: 'To',
                transferMemo: 'Memo (optional)', transferMemoPlaceholder: 'e.g., Living expenses, exchange',
                mainAccount: 'üè¶ Main Account (EUR)', krAccount: 'üá∞üá∑ Korean Account (KRW)',
                cryptoAccount: 'ü™ô Crypto', otherAccount: 'üìã Other',
                transferBadge: 'Transfer', transferLabel: '‚Üí',
                heroModeBank: 'üè¶ Bank Balance', heroModeAsset: 'üíé Total Assets', heroModeSpending: 'üí∏ Monthly Spending',
                dailyNamePlaceholder: 'e.g. Food, Transport, Refund',
                category: 'Category', paymentMethod: 'Payment Method',
                regularCard: 'üí≥ Regular Card (Bank)', cryptoCard: 'ü™ô Crypto Card',
                categoryManagement: 'üìÅ Category Management',
                addYourCategory: 'Add your own categories.',
                categoryName: 'Category name', emoji: 'Emoji',
                aiBulkClassify: 'ü§ñ AI Bulk Classification',
                aiBulkClassifyDesc: 'AI will automatically classify items categorized as "Other".',
                bulkClassify: 'Bulk Classify',
                listView: 'üìã List', calendarView: 'üìÖ Calendar',
                monthlyTotal: 'üìä Monthly Total',
                cardExpenseShort: 'üí≥ Card Expenses', cryptoCardExpenseShort: 'ü™ô Crypto Expenses',
                incomeLabel: 'üí∞ Income', netExpense: 'Net Expense',
                expenseCalendar: 'üìÖ Expense Calendar',
                sun: 'Sun', mon: 'Mon', tue: 'Tue', wed: 'Wed', thu: 'Thu', fri: 'Fri', sat: 'Sat',
                assetManagement: 'üíé Asset Management', addEditAsset: 'Add/Edit Asset',
                platformName: 'Platform', platformPlaceholder: 'e.g. Chase Bank, Coinbase',
                currency: 'Currency', balance: 'Balance',
                memoOptional: 'Memo (optional)', memoPlaceholder: 'e.g. Emergency fund, Investment',
                totalAssetsEUR: 'üí∞ Total Assets (EUR)',
                fetchLiveRates: 'üîÑ Fetch Live Rates',
                defaultRatesUsed: 'üìå Using default rates',
                assetList: 'Asset List',
                categoryAnalysis: 'üìä Category Expense Analysis',
                monthlyCategoryExpense: 'Monthly Category Expenses',
                categoryGuide: 'üí° Category Guide',
                categoryGuideDesc: 'AI automatically classifies expense items. You can edit categories in the Daily tab.',
                editTransaction: 'Edit Transaction', amount: 'Amount',
                monthlySalaryHistory: 'Monthly Salary History', delete: 'Delete', edit: 'Edit',
                noSalaryYet: 'No salary records yet.',
                noFixedYet: 'No fixed expenses yet.',
                noDailyYet: 'No daily expenses yet.',
                noDailyThisMonth: 'No expenses this month.',
                noAssetsYet: 'No assets registered.',
                noExpenseThisMonth: 'No expenses this month.',
                noCategoryExpense: 'No expenses in this category.',
                enterMonthAndAmount: 'Please enter both month and amount.',
                salarySaved: 'Salary saved!',
                enterNameAndAmount: 'Please enter both item name and amount.',
                enterAllFields: 'Please enter date, item name, and amount.',
                enterAllFieldsEdit: 'Please fill in all fields.',
                edited: 'Saved!',
                aiClassifying: 'AI classifying...',
                classifying: 'Classifying...',
                processing: 'Processing...',
                enterCategoryName: 'Please enter a category name.',
                categoryExists: 'This category already exists.',
                categoryAdded: ' category has been added!',
                deleteCategoryConfirm: 'Delete this category?',
                noCustomCategories: 'No custom categories added.',
                nothingToClassify: 'Nothing to classify. All items are already classified.',
                bulkClassifyStart: ' items will be classified by AI. Please wait.',
                classifyComplete: ' items have been classified!',
                classifyFailed: ' items failed to classify',
                classifyError: 'Error during classification: ',
                classifiedAs: ' category assigned.',
                enterItemNameFirst: 'Please enter an item name first.',
                exportDone: 'Data exported successfully!',
                invalidFile: 'This is not a valid budget data file.',
                mergeConfirm: 'Existing data found. Keep existing data and add new data?\n\nOK: Merge data\nCancel: Replace with imported data',
                importDone: 'Data imported successfully!',
                importError: 'Error reading file: ',
                deleteAssetConfirm: 'Delete this asset?',
                imageOnly: 'Only image files can be uploaded.',
                fixedItemsAdded: ' fixed expense items have been added!',
                noValidExpense: 'No valid expense items found.',
                imageAnalysisFailed: 'Could not recognize expenses from the image. Please enter manually.',
                imageAnalysisError: 'Error analyzing image: ',
                aiAutoClassify: 'ü§ñ AI Auto-classify',
                yearMonth: (y, m) => `${getMonthName(m, 'en')} ${y}`,
                dateDisplay: (y, m, d, wd) => `${wd}, ${getMonthName(m, 'en')} ${d}, ${y}`,
                itemCount: (n) => `${n} items`,
                subtotal: 'Subtotal',
                totalExpense: 'Total Expense',
                regularCardLabel: 'üí≥ Regular Card', cryptoCardLabel: 'ü™ô Crypto Card',
                incomeSection: 'üí∞ Income',
                regularBadge: 'üí≥ Regular', cryptoBadge: 'ü™ô Crypto', incomeBadge: 'üí∞ Income',
                liveTag: '(Live)',
                rateLoading: '‚è≥ Fetching rates...',
                rateError: '‚ùå Failed (using defaults)',
                rateUpdated: 'Updated',
                catFood: 'Food', catTransport: 'Transport', catShopping: 'Shopping',
                catEntertainment: 'Entertainment', catSubscription: 'Subscription',
                catMedical: 'Medical', catEducation: 'Education', catOther: 'Other', catIncome: 'Income',
                enterPlatformAndBalance: 'Please enter platform name and balance.',
                assetTypeFiat: 'Fiat', assetTypeCrypto: 'Crypto', assetTypeStock: 'Stock',
                selectCoin: 'Select Coin', searchCoin: 'Search (e.g. BTC, Solana, XRP...)',
                quantity: 'Quantity', enterQuantity: 'Amount held',
                stockTicker: 'Stock Ticker', tickerPlaceholder: 'e.g. AAPL, TSLA, MSFT',
                shares: 'shares', enterShares: 'Number of shares',
                pricePerShare: 'Price per Share (‚Ç¨)', currentPrice: 'Current price per share',
                noCoinFound: 'No coin found',
                priceLoading: 'Loading price...',
                priceFailed: 'Price unavailable',
                searchExpenses: 'Search expenses...',
                allCategories: 'All Categories', allPayments: 'All Payments',
                budgetGoals: 'üéØ Budget Goals', setBudget: 'Set',
                setBudgetGoals: 'üéØ Set Budget Goals',
                totalBudget: 'Total Budget (‚Ç¨)',
                budgetSaved: 'Budget goals saved!',
                noBudgetSet: 'Set your budget goals.',
                spent: 'Spent', remaining2: 'Remaining', over: 'Over',
                fixedLabel: 'Fixed', variableLabel: 'Variable', variableBudget: 'Variable Budget',
                categoryDonut: 'Category Breakdown', monthlyComparison: 'Monthly Comparison',
                vsLastMonth: 'üìà vs. Last Month',
                noLastMonthData: 'No data from last month.',
                increased: 'increase', decreased: 'decrease', same: 'same',
                gdriveSaving: 'Saving to Google Drive...',
                gdriveSaved: 'Saved to Google Drive!',
                gdriveError: 'Google Drive connection failed',
                weekdays: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                monthNames: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            },
            de: {
                title: 'üí∞ Mein Haushaltsbuch',
                totalAssetLabel: 'Gesamtverm√∂gen',
                monthlySpending: 'Monatsausgaben',
                salary: 'Gehalt:', otherIncome: '+ Sonstiges Einkommen:', fixedExpense: 'Fixkosten:',
                cardExpense: 'Kartenausgaben:', cryptoCardExpense: 'ü™ô Krypto-Karte:',
                remaining: 'Restbetrag:',
                tabSalary: 'üíµ Gehalt', tabDaily: 'üìÖ T√§glich',
                tabAssets: 'üíé Verm√∂gen', tabStats: 'üìä Budget/Statistik',
                budgetAndStats: 'üìä Budget / Statistik', fixedExpenses: 'üìå Fixkosten',
                dataManagement: 'üìÅ Datenverwaltung',
                dataManagementDesc: 'Daten als Datei speichern oder von einem anderen Ger√§t importieren.',
                export: 'üíæ Exportieren', import: 'üìÇ Importieren',
                salaryInput: 'Gehalt eingeben', selectMonth: 'Monat w√§hlen',
                amountEuro: 'Betrag (‚Ç¨)', enterSalary: 'Gehalt eingeben',
                save: 'Speichern', add: 'Hinzuf√ºgen', cancel: 'Abbrechen',
                usageGuide: 'üí° Anleitung',
                usageGuideDesc: 'Sie k√∂nnen jeden Monat ein anderes Gehalt eingeben. Der Restbetrag wird anhand des aktuellen Gehalts berechnet.',
                photoAutoInput: 'üì∏ Automatische Eingabe per Foto',
                photoAutoInputDesc: 'Laden Sie ein Foto Ihrer Fixkosten hoch, um diese automatisch zu erkennen.',
                clickOrDrag: 'Klicken oder Bild hierher ziehen',
                supportedFormats: 'PNG, JPG, JPEG unterst√ºtzt',
                analyzingImage: 'Bild wird analysiert...',
                addFixedExpense: 'Fixkosten hinzuf√ºgen', itemName: 'Bezeichnung',
                fixedNamePlaceholder: 'z.B. Miete, Telefon, Versicherung',
                enterAmount: 'Betrag eingeben', fixedExpenseList: 'Fixkosten-Liste',
                dragToReorder: 'üí° Zum Sortieren ziehen',
                addDailyExpense: 'T√§gliche Ausgabe/Einnahme', date: 'Datum', type: 'Typ',
                expense: 'üí∏ Ausgabe', income: 'üí∞ Einnahme', transfer: 'üîÑ √úberweisung',
                transferFrom: 'Von', transferTo: 'Nach',
                transferMemo: 'Notiz (optional)', transferMemoPlaceholder: 'z.B. Lebenshaltung, Umtausch',
                mainAccount: 'üè¶ Hauptkonto (EUR)', krAccount: 'üá∞üá∑ Koreanisches Konto (KRW)',
                cryptoAccount: 'ü™ô Krypto', otherAccount: 'üìã Sonstige',
                transferBadge: '√úberw.', transferLabel: '‚Üí',
                heroModeBank: 'üè¶ Kontostand', heroModeAsset: 'üíé Gesamtverm√∂gen', heroModeSpending: 'üí∏ Monatsausgaben',
                dailyNamePlaceholder: 'z.B. Essen, Transport, Erstattung',
                category: 'Kategorie', paymentMethod: 'Zahlungsmittel',
                regularCard: 'üí≥ Bankkarte', cryptoCard: 'ü™ô Krypto-Karte',
                categoryManagement: 'üìÅ Kategorieverwaltung',
                addYourCategory: 'Eigene Kategorien hinzuf√ºgen.',
                categoryName: 'Kategoriename', emoji: 'Emoji',
                aiBulkClassify: 'ü§ñ KI-Massenklassifizierung',
                aiBulkClassifyDesc: 'KI klassifiziert automatisch Eintr√§ge mit Kategorie "Sonstiges".',
                bulkClassify: 'Alle klassifizieren',
                listView: 'üìã Liste', calendarView: 'üìÖ Kalender',
                monthlyTotal: 'üìä Monatssumme',
                cardExpenseShort: 'üí≥ Kartenausgaben', cryptoCardExpenseShort: 'ü™ô Krypto-Ausgaben',
                incomeLabel: 'üí∞ Einnahmen', netExpense: 'Nettoausgaben',
                expenseCalendar: 'üìÖ Ausgabenkalender',
                sun: 'So', mon: 'Mo', tue: 'Di', wed: 'Mi', thu: 'Do', fri: 'Fr', sat: 'Sa',
                assetManagement: 'üíé Verm√∂gensverwaltung', addEditAsset: 'Verm√∂gen hinzuf√ºgen/bearbeiten',
                platformName: 'Plattform', platformPlaceholder: 'z.B. Deutsche Bank, Coinbase',
                currency: 'W√§hrung', balance: 'Kontostand',
                memoOptional: 'Notiz (optional)', memoPlaceholder: 'z.B. Notgroschen, Investment',
                totalAssetsEUR: 'üí∞ Gesamtverm√∂gen (EUR)',
                fetchLiveRates: 'üîÑ Live-Kurse abrufen',
                defaultRatesUsed: 'üìå Standardkurse verwendet',
                assetList: 'Verm√∂gensliste',
                categoryAnalysis: 'üìä Ausgabenanalyse nach Kategorie',
                monthlyCategoryExpense: 'Monatliche Kategorieausgaben',
                categoryGuide: 'üí° Kategorie-Info',
                categoryGuideDesc: 'KI klassifiziert Ausgaben automatisch. Kategorien k√∂nnen im Tab "T√§glich" bearbeitet werden.',
                editTransaction: 'Transaktion bearbeiten', amount: 'Betrag',
                monthlySalaryHistory: 'Monatliche Gehalts√ºbersicht', delete: 'L√∂schen', edit: 'Bearb.',
                noSalaryYet: 'Noch keine Gehaltseintr√§ge.',
                noFixedYet: 'Noch keine Fixkosten.',
                noDailyYet: 'Noch keine t√§glichen Ausgaben.',
                noDailyThisMonth: 'Keine Ausgaben in diesem Monat.',
                noAssetsYet: 'Kein Verm√∂gen registriert.',
                noExpenseThisMonth: 'Keine Ausgaben in diesem Monat.',
                noCategoryExpense: 'Keine Ausgaben in dieser Kategorie.',
                enterMonthAndAmount: 'Bitte Monat und Betrag eingeben.',
                salarySaved: 'Gehalt gespeichert!',
                enterNameAndAmount: 'Bitte Bezeichnung und Betrag eingeben.',
                enterAllFields: 'Bitte Datum, Bezeichnung und Betrag eingeben.',
                enterAllFieldsEdit: 'Bitte alle Felder ausf√ºllen.',
                edited: 'Gespeichert!',
                aiClassifying: 'KI klassifiziert...',
                classifying: 'Klassifizierung...',
                processing: 'Verarbeitung...',
                enterCategoryName: 'Bitte Kategorienamen eingeben.',
                categoryExists: 'Diese Kategorie existiert bereits.',
                categoryAdded: ' Kategorie wurde hinzugef√ºgt!',
                deleteCategoryConfirm: 'Diese Kategorie l√∂schen?',
                noCustomCategories: 'Keine eigenen Kategorien.',
                nothingToClassify: 'Nichts zu klassifizieren. Alle Eintr√§ge sind bereits klassifiziert.',
                bulkClassifyStart: ' Eintr√§ge werden per KI klassifiziert. Bitte warten.',
                classifyComplete: ' Eintr√§ge wurden klassifiziert!',
                classifyFailed: ' Eintr√§ge konnten nicht klassifiziert werden',
                classifyError: 'Fehler bei der Klassifizierung: ',
                classifiedAs: ' Kategorie zugewiesen.',
                enterItemNameFirst: 'Bitte zuerst Bezeichnung eingeben.',
                exportDone: 'Daten erfolgreich exportiert!',
                invalidFile: 'Keine g√ºltige Haushaltsbuch-Datei.',
                mergeConfirm: 'Vorhandene Daten gefunden. Bestehende Daten behalten und neue hinzuf√ºgen?\n\nOK: Daten zusammenf√ºhren\nAbbrechen: Mit importierten Daten ersetzen',
                importDone: 'Daten erfolgreich importiert!',
                importError: 'Fehler beim Lesen der Datei: ',
                deleteAssetConfirm: 'Dieses Verm√∂gen l√∂schen?',
                imageOnly: 'Nur Bilddateien k√∂nnen hochgeladen werden.',
                fixedItemsAdded: ' Fixkosten-Eintr√§ge wurden hinzugef√ºgt!',
                noValidExpense: 'Keine g√ºltigen Ausgabeneintr√§ge gefunden.',
                imageAnalysisFailed: 'Ausgaben im Bild nicht erkannt. Bitte manuell eingeben.',
                imageAnalysisError: 'Fehler bei der Bildanalyse: ',
                aiAutoClassify: 'ü§ñ KI-Automatik',
                yearMonth: (y, m) => `${getMonthName(m, 'de')} ${y}`,
                dateDisplay: (y, m, d, wd) => `${wd}, ${d}. ${getMonthName(m, 'de')} ${y}`,
                itemCount: (n) => `${n} Eintr.`,
                subtotal: 'Zwischensumme',
                totalExpense: 'Gesamtausgaben',
                regularCardLabel: 'üí≥ Bankkarte', cryptoCardLabel: 'ü™ô Krypto-Karte',
                incomeSection: 'üí∞ Einnahmen',
                regularBadge: 'üí≥ Karte', cryptoBadge: 'ü™ô Krypto', incomeBadge: 'üí∞ Einnahme',
                liveTag: '(Live)',
                rateLoading: '‚è≥ Kurse werden abgerufen...',
                rateError: '‚ùå Fehler (Standardwerte)',
                rateUpdated: 'Aktualisiert',
                catFood: 'Essen', catTransport: 'Transport', catShopping: 'Einkaufen',
                catEntertainment: 'Unterhaltung', catSubscription: 'Abos',
                catMedical: 'Gesundheit', catEducation: 'Bildung', catOther: 'Sonstiges', catIncome: 'Einnahme',
                enterPlatformAndBalance: 'Bitte Plattform und Kontostand eingeben.',
                assetTypeFiat: 'Fiatw√§hrung', assetTypeCrypto: 'Kryptow√§hrung', assetTypeStock: 'Aktien',
                selectCoin: 'Coin w√§hlen', searchCoin: 'Suche (z.B. BTC, Solana, XRP...)',
                quantity: 'Menge', enterQuantity: 'Bestand',
                stockTicker: 'Aktien-Ticker', tickerPlaceholder: 'z.B. AAPL, TSLA, SAP.DE',
                shares: 'Aktien', enterShares: 'Anzahl Aktien',
                pricePerShare: 'Preis pro Aktie (‚Ç¨)', currentPrice: 'Aktueller Kurs',
                noCoinFound: 'Kein Coin gefunden',
                priceLoading: 'Preis wird geladen...',
                priceFailed: 'Preis nicht verf√ºgbar',
                searchExpenses: 'Ausgaben suchen...',
                allCategories: 'Alle Kategorien', allPayments: 'Alle Zahlungsarten',
                budgetGoals: 'üéØ Budgetziele', setBudget: 'Einst.',
                setBudgetGoals: 'üéØ Budgetziele festlegen',
                totalBudget: 'Gesamtbudget (‚Ç¨)',
                budgetSaved: 'Budgetziele gespeichert!',
                noBudgetSet: 'Bitte Budgetziele festlegen.',
                spent: 'Ausgegeben', remaining2: '√úbrig', over: '√úber',
                fixedLabel: 'Fix', variableLabel: 'Variabel', variableBudget: 'Variables Budget',
                categoryDonut: 'Kategorienaufteilung', monthlyComparison: 'Monatsvergleich',
                vsLastMonth: 'üìà Vormonatsvergleich',
                noLastMonthData: 'Keine Daten vom Vormonat.',
                increased: 'Anstieg', decreased: 'R√ºckgang', same: 'gleich',
                gdriveSaving: 'Speichern in Google Drive...',
                gdriveSaved: 'In Google Drive gespeichert!',
                gdriveError: 'Google Drive-Verbindung fehlgeschlagen',
                weekdays: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
                monthNames: ['Jan', 'Feb', 'M√§r', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
            }
        };

        // Helper for month names
        function getMonthName(month, lang) {
            const names = {
                en: ['January','February','March','April','May','June','July','August','September','October','November','December'],
                de: ['Januar','Februar','M√§rz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember'],
                ko: ['1Ïõî','2Ïõî','3Ïõî','4Ïõî','5Ïõî','6Ïõî','7Ïõî','8Ïõî','9Ïõî','10Ïõî','11Ïõî','12Ïõî']
            };
            return (names[lang] || names['en'])[month - 1];
        }

        // Translation function
        function t(key) {
            return translations[currentLang]?.[key] || translations['ko'][key] || key;
        }

        // Apply language to all data-i18n elements
        function applyLanguage() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang]?.[key]) {
                    el.textContent = translations[currentLang][key];
                }
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (translations[currentLang]?.[key]) {
                    el.placeholder = translations[currentLang][key];
                }
            });
            document.documentElement.lang = currentLang === 'ko' ? 'ko' : currentLang === 'de' ? 'de' : 'en';
            document.title = t('title').replace('üí∞ ', '');
        }

        // Change language
        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('budgetAppLang', lang);
            applyLanguage();
            // Re-render dynamic content
            updateViewMonthDisplay();
            updateDisplay();
            renderSalaryList();
            renderFixedList();
            renderDailyList();
            renderAssetsList();
            updateAllCategorySelects();
            renderCustomCategoryList();
            if (currentView === 'calendar') renderCalendar();
            // Update rate status
            if (ratesLastUpdated) {
                updateRateStatusUI('success');
            }
            updateCategoryFilterOptions();
            if (document.getElementById('statsTab')?.classList.contains('active')) {
                renderBudgetGoals();
                updateCharts();
            }
            // Re-apply privacy after re-render
            applyPrivacy();
        }

        // Category name translation helper
        function getCategoryDisplayName(internalName) {
            const map = {
                'ÏãùÎπÑ': 'catFood', 'ÍµêÌÜµÎπÑ': 'catTransport', 'ÏáºÌïë': 'catShopping',
                'Î¨∏ÌôîÏÉùÌôú': 'catEntertainment', 'Íµ¨ÎèÖÎ£å': 'catSubscription',
                'ÏùòÎ£å': 'catMedical', 'ÍµêÏú°': 'catEducation', 'Í∏∞ÌÉÄ': 'catOther', 'ÏàòÏûÖ': 'catIncome'
            };
            const key = map[internalName];
            return key ? t(key) : internalName;
        }

        // ===== ÌîÑÎùºÏù¥Î≤ÑÏãú ÌÜ†Í∏Ä =====
        let privacyMode = localStorage.getItem('budgetPrivacy') === 'true';
        const HIDDEN_TEXT = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';

        function togglePrivacy() {
            privacyMode = !privacyMode;
            localStorage.setItem('budgetPrivacy', privacyMode);
            applyPrivacy();
        }

        function applyPrivacy() {
            const btn = document.getElementById('privacyBtn');
            if (btn) {
                btn.textContent = privacyMode ? 'üôà' : 'üëÅ';
            }

            // Hide/show all amounts with class privacy-amount
            document.querySelectorAll('.privacy-amount').forEach(el => {
                if (privacyMode) {
                    if (!el.dataset.realValue) {
                        el.dataset.realValue = el.textContent;
                    }
                    el.textContent = HIDDEN_TEXT;
                    el.classList.add('amount-hidden');
                } else {
                    if (el.dataset.realValue) {
                        el.textContent = el.dataset.realValue;
                    }
                    el.classList.remove('amount-hidden');
                }
            });

            // Hero section
            ['heroMainAmount', 'heroStat1Value', 'heroStat2Value'].forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                if (privacyMode) {
                    if (!el.dataset.realValue) el.dataset.realValue = el.textContent;
                    el.textContent = HIDDEN_TEXT;
                    el.classList.add('amount-hidden');
                } else {
                    if (el.dataset.realValue) el.textContent = el.dataset.realValue;
                    el.classList.remove('amount-hidden');
                }
            });
        }

        // Helper: set text and respect privacy
        function setAmountText(el, text) {
            if (!el) return;
            el.dataset.realValue = text;
            if (privacyMode) {
                el.textContent = HIDDEN_TEXT;
                el.classList.add('amount-hidden');
            } else {
                el.textContent = text;
                el.classList.remove('amount-hidden');
            }
        }

        // Update hero total assets section
        // Hero mode Ï†ÑÌôò
        function cycleHeroMode() {
            const modes = ['bank', 'asset', 'spending'];
            const idx = modes.indexOf(heroMode);
            heroMode = modes[(idx + 1) % modes.length];
            localStorage.setItem('budgetHeroMode', heroMode);
            updateDisplay();
        }

        function updateHeroAssets() {
            // ÏûêÏÇ∞ Ï¥ùÏï° Í≥ÑÏÇ∞
            let totalAssetsEUR = 0;
            assets.forEach(asset => {
                if (asset.assetType === 'stock') {
                    totalAssetsEUR += asset.amount * (asset.pricePerShare || 0);
                } else {
                    const rate = exchangeRates[asset.currency] || 0;
                    totalAssetsEUR += asset.amount * rate;
                }
            });

            // ÌÜµÏû• ÏûîÏï° Í≥ÑÏÇ∞
            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth();
            const currentSalary = getMonthlySalary(year, month);
            const totalFixed = fixedExpenses.reduce((s, e) => s + e.amount, 0);
            const monthlyExp = getMonthlyExpenses(year, month);
            const regularExp = monthlyExp.filter(e => e.type === 'expense' && (e.paymentMethod || 'regular') === 'regular').reduce((s, e) => s + e.amount, 0);
            const totalIncome = monthlyExp.filter(e => e.type === 'income').reduce((s, e) => s + e.amount, 0);
            // Ïù¥Ï≤¥ Ï§ë ÌÜµÏû•ÏóêÏÑú ÎÇòÍ∞Ñ Í∏àÏï° (main ‚Üí Îã§Î•∏Í≥≥)
            const transferOut = monthlyExp.filter(e => e.type === 'transfer' && e.transferFrom === 'salary_account').reduce((s, e) => s + e.amount, 0);
            // Ïù¥Ï≤¥ Ï§ë ÌÜµÏû•Ïóê Îì§Ïñ¥Ïò® Í∏àÏï° (Îã§Î•∏Í≥≥ ‚Üí main)
            const transferIn = monthlyExp.filter(e => e.type === 'transfer' && e.transferTo === 'salary_account').reduce((s, e) => s + e.amount, 0);
            const bankRemaining = currentSalary + totalIncome - totalFixed - regularExp - transferOut + transferIn;
            const totalMonthlySpent = totalFixed + regularExp + monthlyExp.filter(e => e.type === 'expense' && e.paymentMethod === 'crypto').reduce((s, e) => s + e.amount, 0);

            const mainLabel = document.getElementById('heroMainLabel');
            const mainAmount = document.getElementById('heroMainAmount');
            const mainSub = document.getElementById('heroMainSub');
            const stat1Label = document.getElementById('heroStat1Label');
            const stat1Value = document.getElementById('heroStat1Value');
            const stat2Label = document.getElementById('heroStat2Label');
            const stat2Value = document.getElementById('heroStat2Value');
            const modeBtn = document.getElementById('heroModeBtn');

            if (!mainLabel) return;

            if (heroMode === 'bank') {
                // Î©îÏù∏: ÌÜµÏû• ÏûîÏï°
                mainLabel.textContent = t('heroModeBank');
                setAmountText(mainAmount, formatCurrency(bankRemaining));
                mainAmount.style.color = bankRemaining >= 0 ? '#69db7c' : '#ff8787';
                mainSub.textContent = '';
                // sub stats: Ï¥ù ÏûêÏÇ∞, Ïù¥Î≤àÎã¨ ÏßÄÏ∂ú
                stat1Label.textContent = t('heroModeAsset');
                setAmountText(stat1Value, formatCurrency(totalAssetsEUR));
                stat1Value.className = 'balance-hero-stat-value';
                stat1Value.style.color = '#a5d8ff';
                stat2Label.textContent = t('heroModeSpending');
                setAmountText(stat2Value, formatCurrency(totalMonthlySpent));
                stat2Value.className = 'balance-hero-stat-value negative';
                stat2Value.style.color = '';
                if (modeBtn) modeBtn.textContent = 'üè¶';
            } else if (heroMode === 'asset') {
                // Î©îÏù∏: Ï¥ù ÏûêÏÇ∞
                mainLabel.textContent = t('heroModeAsset');
                setAmountText(mainAmount, formatCurrency(totalAssetsEUR));
                mainAmount.style.color = '';
                // sub text
                if (ratesLastUpdated && assets.length > 0) {
                    const timeStr = ratesLastUpdated.toLocaleTimeString(currentLang === 'ko' ? 'ko-KR' : currentLang === 'de' ? 'de-DE' : 'en-US', { hour: '2-digit', minute: '2-digit' });
                    mainSub.textContent = `üì° ${t('rateUpdated')} ${timeStr}`;
                } else { mainSub.textContent = ''; }
                // sub stats: ÌÜµÏû• ÏûîÏï°, Ïù¥Î≤àÎã¨ ÏßÄÏ∂ú
                stat1Label.textContent = t('heroModeBank');
                setAmountText(stat1Value, formatCurrency(bankRemaining));
                stat1Value.className = 'balance-hero-stat-value ' + (bankRemaining >= 0 ? 'positive' : 'negative');
                stat1Value.style.color = '';
                stat2Label.textContent = t('heroModeSpending');
                setAmountText(stat2Value, formatCurrency(totalMonthlySpent));
                stat2Value.className = 'balance-hero-stat-value negative';
                stat2Value.style.color = '';
                if (modeBtn) modeBtn.textContent = 'üíé';
            } else {
                // Î©îÏù∏: Ïù¥Î≤àÎã¨ ÏßÄÏ∂ú
                mainLabel.textContent = t('heroModeSpending');
                setAmountText(mainAmount, formatCurrency(totalMonthlySpent));
                mainAmount.style.color = '#ff8787';
                mainSub.textContent = `üìå ${formatCurrency(totalFixed)} + üí∏ ${formatCurrency(regularExp)}`;
                // sub stats: ÌÜµÏû• ÏûîÏï°, Ï¥ù ÏûêÏÇ∞
                stat1Label.textContent = t('heroModeBank');
                setAmountText(stat1Value, formatCurrency(bankRemaining));
                stat1Value.className = 'balance-hero-stat-value ' + (bankRemaining >= 0 ? 'positive' : 'negative');
                stat1Value.style.color = '';
                stat2Label.textContent = t('heroModeAsset');
                setAmountText(stat2Value, formatCurrency(totalAssetsEUR));
                stat2Value.className = 'balance-hero-stat-value';
                stat2Value.style.color = '#a5d8ff';
                if (modeBtn) modeBtn.textContent = 'üí∏';
            }
        }

        // ===== Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•ÏÜå =====
        let salaries = []; // ÏõîÎ≥Ñ ÏõîÍ∏â Î∞∞Ïó¥Î°ú Î≥ÄÍ≤Ω
        let fixedExpenses = [];
        let dailyExpenses = [];
        let currentCalendarDate = new Date(); // Îã¨Î†•Ïóê ÌëúÏãúÌï† ÌòÑÏû¨ ÎÇ†Ïßú
        let currentView = 'list'; // 'list' ÎòêÎäî 'calendar'
        let editingExpenseId = null; // ÌòÑÏû¨ ÏàòÏ†ï Ï§ëÏù∏ ÏßÄÏ∂ú ID
        let currentViewMonth = new Date(); // Î©îÏù∏ ÌôîÎ©¥ÏóêÏÑú Î≥¥Í≥† ÏûàÎäî Ïõî
        let customCategories = []; // ÏÇ¨Ïö©Ïûê Ï†ïÏùò Ïπ¥ÌÖåÍ≥†Î¶¨
        let assets = []; // ÏûêÏÇ∞ Î™©Î°ù
        let heroMode = localStorage.getItem('budgetHeroMode') || 'bank'; // 'bank', 'asset', 'spending'

        // ÌôòÏú® (Í∏∞Î≥∏Í∞í - Ïã§ÏãúÍ∞Ñ APIÎ°ú ÏóÖÎç∞Ïù¥Ìä∏Îê®)
        let exchangeRates = {
            'EUR': 1,
        };
        let ratesLastUpdated = null;
        let ratesLoading = false;
        let ratesFetchDone = false;
        let currentAssetType = 'fiat';
        let rateRefreshTimer = null;

        // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Ï∫êÏãúÎêú ÌôòÏú® Î≥µÏõê
        function loadCachedRates() {
            try {
                const cached = localStorage.getItem('budgetAppRatesCache');
                if (cached) {
                    const data = JSON.parse(cached);
                    Object.assign(exchangeRates, data.rates);
                    if (data.timestamp) {
                        ratesLastUpdated = new Date(data.timestamp);
                    }
                    console.log('Cached rates loaded:', Object.keys(data.rates).length, 'currencies');
                }
            } catch(e) { console.warn('Rate cache load failed:', e); }
        }

        // ÌôòÏú® Ï∫êÏãú Ï†ÄÏû•
        function saveCachedRates() {
            try {
                localStorage.setItem('budgetAppRatesCache', JSON.stringify({
                    rates: exchangeRates,
                    timestamp: ratesLastUpdated ? ratesLastUpdated.toISOString() : null
                }));
            } catch(e) { console.warn('Rate cache save failed:', e); }
        }

        // Ï∫êÏãúÎêú ÌôòÏú® Ï¶âÏãú Î°úÎìú
        loadCachedRates();

        // Popular coins with CoinGecko IDs
        const popularCoins = [
            { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin' },
            { id: 'ethereum', symbol: 'ETH', name: 'Ethereum' },
            { id: 'solana', symbol: 'SOL', name: 'Solana' },
            { id: 'ripple', symbol: 'XRP', name: 'XRP' },
            { id: 'cardano', symbol: 'ADA', name: 'Cardano' },
            { id: 'dogecoin', symbol: 'DOGE', name: 'Dogecoin' },
            { id: 'polkadot', symbol: 'DOT', name: 'Polkadot' },
            { id: 'avalanche-2', symbol: 'AVAX', name: 'Avalanche' },
            { id: 'chainlink', symbol: 'LINK', name: 'Chainlink' },
            { id: 'polygon-ecosystem-token', symbol: 'POL', name: 'Polygon' },
            { id: 'toncoin', symbol: 'TON', name: 'Toncoin' },
            { id: 'shiba-inu', symbol: 'SHIB', name: 'Shiba Inu' },
            { id: 'litecoin', symbol: 'LTC', name: 'Litecoin' },
            { id: 'uniswap', symbol: 'UNI', name: 'Uniswap' },
            { id: 'cosmos', symbol: 'ATOM', name: 'Cosmos' },
            { id: 'stellar', symbol: 'XLM', name: 'Stellar' },
            { id: 'tether', symbol: 'USDT', name: 'Tether' },
            { id: 'usd-coin', symbol: 'USDC', name: 'USD Coin' },
            { id: 'binancecoin', symbol: 'BNB', name: 'BNB' },
            { id: 'tron', symbol: 'TRX', name: 'TRON' },
            { id: 'sui', symbol: 'SUI', name: 'Sui' },
            { id: 'aptos', symbol: 'APT', name: 'Aptos' },
            { id: 'near', symbol: 'NEAR', name: 'NEAR Protocol' },
            { id: 'arbitrum', symbol: 'ARB', name: 'Arbitrum' },
            { id: 'optimism', symbol: 'OP', name: 'Optimism' },
            { id: 'pepe', symbol: 'PEPE', name: 'Pepe' },
            { id: 'render-token', symbol: 'RENDER', name: 'Render' },
            { id: 'fetch-ai', symbol: 'FET', name: 'Fetch.ai' },
        ];

        // Asset type switching
        function switchAssetType(type, evt) {
            currentAssetType = type;
            document.querySelectorAll('.asset-type-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.asset-type-content').forEach(c => c.classList.remove('active'));
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add('active');
            } else {
                // Fallback: find the correct tab
                document.querySelectorAll('.asset-type-tab').forEach(tab => {
                    if (tab.textContent.toLowerCase().includes(type)) tab.classList.add('active');
                });
            }
            document.getElementById('assetForm' + type.charAt(0).toUpperCase() + type.slice(1)).classList.add('active');
        }

        // Coin search
        function searchCoin(query) {
            const resultsEl = document.getElementById('coinSearchResults');
            if (!query || query.length < 1) {
                // Show popular coins
                renderCoinResults(popularCoins.slice(0, 10));
                return;
            }
            const q = query.toLowerCase();
            const matches = popularCoins.filter(c =>
                c.symbol.toLowerCase().includes(q) ||
                c.name.toLowerCase().includes(q) ||
                c.id.toLowerCase().includes(q)
            );
            renderCoinResults(matches.length > 0 ? matches : []);
        }

        function renderCoinResults(coins) {
            const resultsEl = document.getElementById('coinSearchResults');
            if (coins.length === 0) {
                resultsEl.innerHTML = `<div style="padding: 12px; color: #6c757d; font-size: 14px;">${t('noCoinFound') || 'No coin found'}</div>`;
                resultsEl.classList.add('active');
                return;
            }
            resultsEl.innerHTML = coins.map(c => {
                const price = exchangeRates[c.symbol];
                const priceDisplay = price
                    ? `<span style="color: #28a745; font-size: 13px;">‚Ç¨${price.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: price < 1 ? 6 : 2})}${ratesLastUpdated ? ' üì°' : ''}</span>`
                    : `<span style="color: #adb5bd; font-size: 12px;">‚Äî</span>`;
                return `
                <div class="coin-search-item" onclick="selectCoin('${c.id}', '${c.symbol}', '${c.name}')">
                    <div>
                        <strong>${c.name}</strong>
                        <span class="coin-symbol">${c.symbol}</span>
                    </div>
                    <span style="margin-left:auto;">${priceDisplay}</span>
                </div>
            `}).join('');
            resultsEl.classList.add('active');
        }

        function selectCoin(id, symbol, name) {
            document.getElementById('cryptoSearch').value = `${name} (${symbol})`;
            document.getElementById('selectedCoinId').value = id;
            document.getElementById('selectedCoinSymbol').value = symbol;
            document.getElementById('coinSearchResults').classList.remove('active');
        }

        // Close coin search when clicking outside
        document.addEventListener('click', (e) => {
            const searchEl = document.getElementById('cryptoSearch');
            const resultsEl = document.getElementById('coinSearchResults');
            if (searchEl && resultsEl && !searchEl.contains(e.target) && !resultsEl.contains(e.target)) {
                resultsEl.classList.remove('active');
            }
        });

        // Timeout helper
        function fetchTimeout(ms) {
            const ctrl = new AbortController();
            setTimeout(() => ctrl.abort(), ms);
            return ctrl.signal;
        }

        // Ïã§ÏãúÍ∞Ñ ÌôòÏú® + ÏΩîÏù∏ Í∞ÄÍ≤© Ï°∞Ìöå (Ïã§Ï†ú Í±∞ÎûòÏÜå APIÎßå ÏÇ¨Ïö©)
        async function fetchLiveRates() {
            if (ratesLoading) return;
            ratesLoading = true;
            updateRateStatusUI('loading');

            let fiatOk = false;
            let cryptoOk = false;

            // ===== 1) Î≤ïÏ†ïÌôîÌèê ÌôòÏú® =====
            // API 1: Frankfurter (ECB Í∏∞Î∞ò)
            if (!fiatOk) {
                try {
                    const res = await fetch('https://api.frankfurter.app/latest?from=EUR&to=USD,KRW', { signal: fetchTimeout(8000) });
                    if (res.ok) {
                        const data = await res.json();
                        if (data.rates?.KRW) exchangeRates['KRW'] = 1 / data.rates.KRW;
                        if (data.rates?.USD) exchangeRates['USD'] = 1 / data.rates.USD;
                        fiatOk = true;
                        console.log('‚úÖ Fiat rates via Frankfurter');
                    }
                } catch (e) { console.warn('Frankfurter failed:', e.message); }
            }
            // API 2: ExchangeRate-API (open)
            if (!fiatOk) {
                try {
                    const res = await fetch('https://open.er-api.com/v6/latest/EUR', { signal: fetchTimeout(8000) });
                    if (res.ok) {
                        const data = await res.json();
                        if (data.rates?.KRW) exchangeRates['KRW'] = 1 / data.rates.KRW;
                        if (data.rates?.USD) exchangeRates['USD'] = 1 / data.rates.USD;
                        fiatOk = true;
                        console.log('‚úÖ Fiat rates via ExchangeRate-API');
                    }
                } catch (e) { console.warn('ExchangeRate-API failed:', e.message); }
            }

            // ===== 2) ÏïîÌò∏ÌôîÌèê Ïã§ÏãúÍ∞Ñ ÏãúÏÑ∏ =====
            // Î≥¥Ïú† + Ïù∏Í∏∞ ÏΩîÏù∏ ID ÏàòÏßë
            const cryptoIds = new Set(popularCoins.map(c => c.id));
            assets.forEach(a => {
                if (a.assetType === 'crypto' && a.coingeckoId) cryptoIds.add(a.coingeckoId);
            });

            // API 1: CoinGecko (Î¨¥Î£å, EUR ÏßÅÏ†ë ÏßÄÏõê)
            if (!cryptoOk) {
                try {
                    const idsParam = [...cryptoIds].join(',');
                    const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${idsParam}&vs_currencies=eur`, { signal: fetchTimeout(10000) });
                    if (res.ok) {
                        const data = await res.json();
                        for (const coin of popularCoins) {
                            if (data[coin.id]?.eur) exchangeRates[coin.symbol] = data[coin.id].eur;
                        }
                        assets.forEach(a => {
                            if (a.assetType === 'crypto' && a.coingeckoId && data[a.coingeckoId]?.eur) {
                                exchangeRates[a.currency] = data[a.coingeckoId].eur;
                            }
                        });
                        if (data.bitcoin?.eur) exchangeRates['BTC'] = data.bitcoin.eur;
                        if (data.ethereum?.eur) exchangeRates['ETH'] = data.ethereum.eur;
                        cryptoOk = true;
                        console.log('‚úÖ Crypto prices via CoinGecko:', Object.keys(data).length, 'coins');
                    }
                } catch (e) { console.warn('CoinGecko failed:', e.message); }
            }

            // API 2: CoinCap (USD Í∏∞Î∞ò ‚Üí EUR Î≥ÄÌôò)
            if (!cryptoOk) {
                try {
                    const res = await fetch('https://api.coincap.io/v2/assets?limit=100', { signal: fetchTimeout(8000) });
                    if (res.ok) {
                        const data = await res.json();
                        const usdToEur = exchangeRates['USD'] || 0.92;
                        if (data.data) {
                            data.data.forEach(coin => {
                                const sym = coin.symbol.toUpperCase();
                                const priceEur = parseFloat(coin.priceUsd) * usdToEur;
                                if (priceEur > 0) exchangeRates[sym] = priceEur;
                            });
                            cryptoOk = true;
                            console.log('‚úÖ Crypto prices via CoinCap:', data.data.length, 'coins');
                        }
                    }
                } catch (e) { console.warn('CoinCap failed:', e.message); }
            }

            // API 3: Binance (Ï£ºÏöî ÏΩîÏù∏ EUR/USDT Ïåç)
            if (!cryptoOk) {
                try {
                    const res = await fetch('https://api.binance.com/api/v3/ticker/price', { signal: fetchTimeout(8000) });
                    if (res.ok) {
                        const data = await res.json();
                        const usdToEur = exchangeRates['USD'] || 0.92;
                        // symbol ‚Üí price map for USDT pairs
                        const priceMap = {};
                        data.forEach(t => { priceMap[t.symbol] = parseFloat(t.price); });

                        // EUR pairs first
                        for (const coin of popularCoins) {
                            const eurPair = coin.symbol + 'EUR';
                            const usdtPair = coin.symbol + 'USDT';
                            if (priceMap[eurPair]) {
                                exchangeRates[coin.symbol] = priceMap[eurPair];
                            } else if (priceMap[usdtPair]) {
                                exchangeRates[coin.symbol] = priceMap[usdtPair] * usdToEur;
                            }
                        }
                        // Check assets too
                        assets.forEach(a => {
                            if (a.assetType === 'crypto') {
                                const eurP = a.currency + 'EUR';
                                const usdtP = a.currency + 'USDT';
                                if (priceMap[eurP]) exchangeRates[a.currency] = priceMap[eurP];
                                else if (priceMap[usdtP]) exchangeRates[a.currency] = priceMap[usdtP] * usdToEur;
                            }
                        });
                        if (exchangeRates['BTC'] || priceMap['BTCEUR'] || priceMap['BTCUSDT']) {
                            cryptoOk = true;
                            console.log('‚úÖ Crypto prices via Binance');
                        }
                    }
                } catch (e) { console.warn('Binance failed:', e.message); }
            }

            // API 4: Kraken (Ïú†ÎüΩ Í±∞ÎûòÏÜå, EUR ÏßÅÏ†ë)
            if (!cryptoOk) {
                try {
                    const krakenPairs = ['XXBTZEUR','XETHZEUR','SOLEUR','XRPEUR','ADAEUR','DOTEUR','LINKEUR','DOGEEUR'];
                    const res = await fetch(`https://api.kraken.com/0/public/Ticker?pair=${krakenPairs.join(',')}`, { signal: fetchTimeout(8000) });
                    if (res.ok) {
                        const data = await res.json();
                        if (data.result) {
                            const krakenMap = {
                                'XXBTZEUR': 'BTC', 'XETHZEUR': 'ETH', 'SOLEUR': 'SOL', 'XRPEUR': 'XRP',
                                'ADAEUR': 'ADA', 'DOTEUR': 'DOT', 'LINKEUR': 'LINK', 'DOGEEUR': 'DOGE'
                            };
                            for (const [pair, sym] of Object.entries(krakenMap)) {
                                if (data.result[pair]?.c?.[0]) {
                                    exchangeRates[sym] = parseFloat(data.result[pair].c[0]);
                                }
                            }
                            cryptoOk = true;
                            console.log('‚úÖ Crypto prices via Kraken');
                        }
                    }
                } catch (e) { console.warn('Kraken failed:', e.message); }
            }

            // ===== 3) Ï£ºÏãù ÏãúÏÑ∏ =====
            const stockAssets = assets.filter(a => a.assetType === 'stock' && a.ticker);
            for (const stock of stockAssets) {
                try {
                    const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${stock.ticker}?interval=1d&range=1d`)}`;
                    const res = await fetch(proxyUrl, { signal: fetchTimeout(8000) });
                    if (res.ok) {
                        const data = await res.json();
                        const price = data?.chart?.result?.[0]?.meta?.regularMarketPrice;
                        const currency = data?.chart?.result?.[0]?.meta?.currency;
                        if (price) {
                            let priceInEUR = price;
                            if (currency === 'USD' && exchangeRates['USD']) priceInEUR = price * exchangeRates['USD'];
                            else if (currency === 'KRW' && exchangeRates['KRW']) priceInEUR = price * exchangeRates['KRW'];
                            stock.pricePerShare = priceInEUR;
                        }
                    }
                } catch (e) {
                    console.warn(`Stock ${stock.ticker} fetch failed:`, e.message);
                }
            }
            if (stockAssets.length > 0) saveData();

            ratesLoading = false;
            ratesFetchDone = true;

            if (fiatOk || cryptoOk) {
                ratesLastUpdated = new Date();
                saveCachedRates();
                updateRateStatusUI('success');
            } else {
                updateRateStatusUI('error');
            }

            renderAssetsList();
            updateDisplay();

            // 5Î∂ÑÎßàÎã§ ÏûêÎèô Í∞±Ïã†
            if (rateRefreshTimer) clearInterval(rateRefreshTimer);
            rateRefreshTimer = setInterval(() => {
                console.log('Auto-refreshing rates...');
                fetchLiveRates();
            }, 5 * 60 * 1000);
        }

        // ÌôòÏú® ÏÉÅÌÉú UI ÏóÖÎç∞Ïù¥Ìä∏
        function updateRateStatusUI(status) {
            const statusEl = document.getElementById('rateStatus');
            if (!statusEl) return;

            if (status === 'loading') {
                statusEl.innerHTML = `<span style="color: #6c757d;">‚è≥ CoinGecko ¬∑ Binance ¬∑ Kraken ${t('rateLoading').replace('‚è≥ ','')}</span>`;
            } else if (status === 'success') {
                const locale = currentLang === 'ko' ? 'ko-KR' : currentLang === 'de' ? 'de-DE' : 'en-US';
                const timeStr = ratesLastUpdated.toLocaleTimeString(locale, { hour: '2-digit', minute: '2-digit' });
                let rateInfo = '';
                if (exchangeRates['USD']) rateInfo += `USD = ‚Ç¨${exchangeRates['USD'].toFixed(4)}`;
                if (exchangeRates['BTC']) rateInfo += ` ¬∑ BTC = ‚Ç¨${exchangeRates['BTC'].toLocaleString()}`;
                if (exchangeRates['ETH']) rateInfo += ` ¬∑ ETH = ‚Ç¨${exchangeRates['ETH'].toLocaleString()}`;
                if (exchangeRates['SOL']) rateInfo += ` ¬∑ SOL = ‚Ç¨${exchangeRates['SOL'].toFixed(2)}`;
                statusEl.innerHTML = `<span style="color: #28a745;">‚úÖ ${t('rateUpdated')} ${timeStr}</span>` +
                    `<span style="color: #6c757d; font-size: 11px; margin-left: 8px;">‚ü≥ 5min</span><br>` +
                    `<span style="color: #6c757d; font-size: 12px;">${rateInfo}</span>`;
            } else if (status === 'error') {
                const hasCache = ratesLastUpdated !== null;
                if (hasCache) {
                    const locale = currentLang === 'ko' ? 'ko-KR' : currentLang === 'de' ? 'de-DE' : 'en-US';
                    const timeStr = ratesLastUpdated.toLocaleString(locale, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                    statusEl.innerHTML = `<span style="color: #e67700;">‚ö†Ô∏è API Ïó∞Í≤∞ Ïã§Ìå® ‚Äî ${t('rateUpdated')} ${timeStr} (cached)</span>`;
                } else {
                    const msg = currentLang === 'ko' ? '‚ùå Í±∞ÎûòÏÜå API Ïó∞Í≤∞ Î∂àÍ∞Ä ‚Äî GitHub Pages Î∞∞Ìè¨ ÌõÑ Ïã§ÏãúÍ∞Ñ ÏãúÏÑ∏Í∞Ä Î∞òÏòÅÎê©ÎãàÎã§' :
                                currentLang === 'de' ? '‚ùå B√∂rsen-API nicht erreichbar ‚Äî Live-Kurse nach GitHub Pages Deployment' :
                                '‚ùå Exchange API unavailable ‚Äî Live prices will work after deploying to GitHub Pages';
                    statusEl.innerHTML = `<span style="color: #dc3545; font-size: 13px;">${msg}</span>`;
                }
            }
        }

        // ÌÜµÌôî Í∏∞Ìò∏ Îß§Ìïë (ÎèôÏ†Å ÌôïÏû•)
        const currencySymbols = {
            'EUR': '‚Ç¨', 'KRW': '‚Ç©', 'USD': '$',
            'BTC': '‚Çø', 'ETH': 'Œû'
        };

        function getCurrencySymbol(code) {
            return currencySymbols[code] || code + ' ';
        }

        // ÏûêÏÇ∞ Ï∂îÍ∞Ä/ÏàòÏ†ï
        function addOrUpdateAsset() {
            let asset = null;

            if (currentAssetType === 'fiat') {
                const platform = document.getElementById('fiatPlatform').value.trim();
                const currency = document.getElementById('fiatCurrency').value;
                const amount = parseFloat(document.getElementById('fiatAmount').value);
                const memo = document.getElementById('fiatMemo').value.trim();

                if (!platform || !amount) { alert(t('enterPlatformAndBalance')); return; }

                asset = { assetType: 'fiat', platform, currency, amount, memo };

                document.getElementById('fiatPlatform').value = '';
                document.getElementById('fiatAmount').value = '';
                document.getElementById('fiatMemo').value = '';
                document.getElementById('fiatCurrency').value = 'EUR';

            } else if (currentAssetType === 'crypto') {
                const platform = document.getElementById('cryptoPlatform').value.trim();
                const coinId = document.getElementById('selectedCoinId').value;
                const coinSymbol = document.getElementById('selectedCoinSymbol').value;
                const amount = parseFloat(document.getElementById('cryptoAmount').value);
                const memo = document.getElementById('cryptoMemo').value.trim();

                if (!platform || !coinId || !amount) { alert(t('enterPlatformAndBalance')); return; }

                asset = { assetType: 'crypto', platform, currency: coinSymbol.toUpperCase(), coingeckoId: coinId, amount, memo };

                document.getElementById('cryptoPlatform').value = '';
                document.getElementById('cryptoSearch').value = '';
                document.getElementById('selectedCoinId').value = '';
                document.getElementById('selectedCoinSymbol').value = '';
                document.getElementById('cryptoAmount').value = '';
                document.getElementById('cryptoMemo').value = '';

            } else if (currentAssetType === 'stock') {
                const platform = document.getElementById('stockPlatform').value.trim();
                const ticker = document.getElementById('stockTicker').value.trim().toUpperCase();
                const shares = parseFloat(document.getElementById('stockShares').value);
                const price = parseFloat(document.getElementById('stockPrice').value);
                const memo = document.getElementById('stockMemo').value.trim();

                if (!platform || !ticker || !shares) { alert(t('enterPlatformAndBalance')); return; }

                asset = { assetType: 'stock', platform, currency: ticker, ticker, amount: shares, pricePerShare: price || 0, memo };

                document.getElementById('stockPlatform').value = '';
                document.getElementById('stockTicker').value = '';
                document.getElementById('stockShares').value = '';
                document.getElementById('stockPrice').value = '';
                document.getElementById('stockMemo').value = '';
            }

            if (!asset) return;

            // Check for existing same platform + currency
            const existingIndex = assets.findIndex(a => a.platform === asset.platform && a.currency === asset.currency);

            if (existingIndex !== -1) {
                assets[existingIndex] = { ...assets[existingIndex], ...asset, updatedAt: new Date().toISOString() };
            } else {
                asset.id = Date.now();
                asset.createdAt = new Date().toISOString();
                assets.push(asset);
            }

            saveData();
            renderAssetsList();
        }

        // ÏûêÏÇ∞ ÏÇ≠Ï†ú
        function deleteAsset(id) {
            assets = assets.filter(a => a.id !== id);
            saveData();
            renderAssetsList();
            updateDisplay();
        }

        // ÏûêÏÇ∞ Î™©Î°ù Î†åÎçîÎßÅ
        function renderAssetsList() {
            const list = document.getElementById('assetsList');
            
            if (assets.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üíé</div>
                        <p>${t('noAssetsYet')}</p>
                    </div>
                `;
                document.getElementById('totalAssetsEUR').textContent = '‚Ç¨0.00';
                updateHeroAssets();
                return;
            }

            let totalEUR = 0;
            
            // Group by type
            const fiatAssets = assets.filter(a => !a.assetType || a.assetType === 'fiat');
            const cryptoAssets = assets.filter(a => a.assetType === 'crypto' || (!a.assetType && ['BTC','ETH'].includes(a.currency)));
            const stockAssets = assets.filter(a => a.assetType === 'stock');

            let html = '';

            function renderAssetGroup(groupAssets, groupLabel, badgeClass) {
                if (groupAssets.length === 0) return '';
                let groupHtml = `<div style="margin-bottom: 16px;"><h4 style="color: #6c757d; font-size: 13px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">${groupLabel}</h4>`;
                
                groupAssets.forEach(asset => {
                    let valueInEUR = 0;
                    let displayAmount = '';
                    let symbol = getCurrencySymbol(asset.currency);
                    let priceAvailable = true;

                    if (asset.assetType === 'stock') {
                        const price = asset.pricePerShare || 0;
                        valueInEUR = asset.amount * price;
                        displayAmount = `${asset.amount.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 3})} ${t('shares') || 'shares'}`;
                        if (price > 0) {
                            displayAmount += ` √ó ‚Ç¨${price.toFixed(2)}`;
                        } else {
                            priceAvailable = false;
                        }
                    } else {
                        const rate = exchangeRates[asset.currency] || 0;
                        valueInEUR = asset.amount * rate;
                        displayAmount = `${symbol}${asset.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8})} ${asset.currency}`;
                        if (asset.currency !== 'EUR' && rate === 0) {
                            priceAvailable = false;
                        }
                    }
                    
                    if (priceAvailable) {
                        totalEUR += valueInEUR;
                    }

                    const typeIcon = asset.assetType === 'stock' ? 'üìà' : asset.assetType === 'crypto' ? 'ü™ô' : 'üè¶';

                    // Í∞ÄÍ≤© ÌëúÏãú: Ïã§ÏãúÍ∞Ñ / Ìè¥Î∞± / Î°úÎî© Ï§ë / Ïã§Ìå® Íµ¨Î∂Ñ
                    let valueDisplay = '';
                    if (asset.currency === 'EUR' && asset.assetType !== 'stock') {
                        valueDisplay = '';
                    } else if (!priceAvailable && !ratesFetchDone) {
                        valueDisplay = `<span style="color: #e67700; margin-left: 8px; font-size: 12px;">‚è≥ ${t('priceLoading')}</span>`;
                    } else if (!priceAvailable && ratesFetchDone) {
                        valueDisplay = `<span style="color: #dc3545; margin-left: 8px; font-size: 12px;">‚ùå ${t('priceFailed') || 'Price unavailable'}</span>`;
                    } else if (valueInEUR > 0 && ratesLastUpdated) {
                        valueDisplay = `<span style="color: #28a745; margin-left: 8px; font-weight: 600;">‚âà ‚Ç¨${valueInEUR.toFixed(2)} üì°</span>`;
                    } else if (valueInEUR > 0) {
                        valueDisplay = `<span style="color: #e67700; margin-left: 8px; font-weight: 600;">‚âà ‚Ç¨${valueInEUR.toFixed(2)} ‚ö†Ô∏è</span>`;
                    }
                    
                    groupHtml += `
                        <div class="list-item">
                            <div class="list-item-info" style="min-width: 0; flex: 1;">
                                <div class="list-item-name" style="display: flex; align-items: center; flex-wrap: wrap;">
                                    ${typeIcon} ${asset.platform}
                                    <span class="asset-badge ${badgeClass}">${asset.currency}</span>
                                    ${asset.memo ? `<span style="color: #6c757d; font-size: 12px; margin-left: 4px;">(${asset.memo})</span>` : ''}
                                </div>
                                <div class="list-item-detail" style="font-size: 13px;">
                                    ${displayAmount}
                                    ${valueDisplay}
                                </div>
                            </div>
                            <button class="btn btn-delete" onclick="deleteAsset(${asset.id})">${t('delete')}</button>
                        </div>
                    `;
                });
                groupHtml += '</div>';
                return groupHtml;
            }

            html += renderAssetGroup(fiatAssets, `üè¶ ${t('assetTypeFiat') || 'Fiat'}`, 'fiat');
            html += renderAssetGroup(cryptoAssets, `ü™ô ${t('assetTypeCrypto') || 'Crypto'}`, 'crypto');
            html += renderAssetGroup(stockAssets, `üìà ${t('assetTypeStock') || 'Stock'}`, 'stock');

            list.innerHTML = html;
            document.getElementById('totalAssetsEUR').textContent = `‚Ç¨${totalEUR.toFixed(2)}${ratesLastUpdated ? ' ' + t('liveTag') : ''}`;
            updateHeroAssets();
        }

        // Í∏∞Î≥∏ Ïπ¥ÌÖåÍ≥†Î¶¨
        const defaultCategories = [
            { name: 'ÏãùÎπÑ', emoji: 'üçΩÔ∏è' },
            { name: 'ÍµêÌÜµÎπÑ', emoji: 'üöá' },
            { name: 'ÏáºÌïë', emoji: 'üõçÔ∏è' },
            { name: 'Î¨∏ÌôîÏÉùÌôú', emoji: 'üé¨' },
            { name: 'Íµ¨ÎèÖÎ£å', emoji: 'üì±' },
            { name: 'ÏùòÎ£å', emoji: 'üè•' },
            { name: 'ÍµêÏú°', emoji: 'üìö' },
            { name: 'Í∏∞ÌÉÄ', emoji: 'üì¶' }
        ];

        // Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨ Í∞ÄÏ†∏Ïò§Í∏∞ (Í∏∞Î≥∏ + ÏÇ¨Ïö©Ïûê Ï†ïÏùò)
        function getAllCategories() {
            return [...defaultCategories, ...customCategories];
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î™®ÏßÄ Í∞ÄÏ†∏Ïò§Í∏∞
        function getCategoryEmoji(categoryName) {
            const allCategories = getAllCategories();
            const category = allCategories.find(c => c.name === categoryName);
            return category ? category.emoji : 'üì¶';
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù ÏòµÏÖò Î†åÎçîÎßÅ
        function renderCategoryOptions(selectElementId, includeAI = false) {
            const select = document.getElementById(selectElementId);
            if (!select) return;
            
            const allCategories = getAllCategories();
            let html = '';
            
            if (includeAI) {
                html += `<option value="">ü§ñ ${t('aiAutoClassify').replace('ü§ñ ','')}</option>`;
            }
            
            allCategories.forEach(cat => {
                html += `<option value="${cat.name}">${cat.emoji} ${getCategoryDisplayName(cat.name)}</option>`;
            });
            
            html += `<option value="ÏàòÏûÖ">üí∞ ${t('catIncome')}</option>`;
            
            const currentValue = select.value;
            select.innerHTML = html;
            if (currentValue) {
                select.value = currentValue;
            }
        }

        // ÏÇ¨Ïö©Ïûê Ï†ïÏùò Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä
        function addCustomCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            const emoji = document.getElementById('newCategoryEmoji').value.trim();
            
            if (!name) {
                alert(t('enterCategoryName'));
                return;
            }
            
            // Ï§ëÎ≥µ Ï≤¥ÌÅ¨
            const allCategories = getAllCategories();
            if (allCategories.some(c => c.name === name)) {
                alert(t('categoryExists'));
                return;
            }
            
            customCategories.push({
                name: name,
                emoji: emoji || 'üìå'
            });
            
            document.getElementById('newCategoryName').value = '';
            document.getElementById('newCategoryEmoji').value = '';
            
            saveData();
            renderCustomCategoryList();
            updateAllCategorySelects();
            
            alert(`"${emoji || 'üìå'} ${name}"${t('categoryAdded')}`);
        }

        // ÏÇ¨Ïö©Ïûê Ï†ïÏùò Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÇ≠Ï†ú
        function deleteCustomCategory(index) {
            const category = customCategories[index];
            const confirmed = confirm(`"${category.emoji} ${category.name}" - ${t('deleteCategoryConfirm')}`);
            
            if (confirmed) {
                customCategories.splice(index, 1);
                saveData();
                renderCustomCategoryList();
                updateAllCategorySelects();
            }
        }

        // ÏÇ¨Ïö©Ïûê Ï†ïÏùò Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù Î†åÎçîÎßÅ
        function renderCustomCategoryList() {
            const list = document.getElementById('customCategoryList');
            if (!list) return;
            
            if (customCategories.length === 0) {
                list.innerHTML = `<span style="color: #6c757d; font-size: 14px;">${t('noCustomCategories')}</span>`;
                return;
            }
            
            list.innerHTML = customCategories.map((cat, index) => `
                <span style="display: inline-flex; align-items: center; gap: 5px; padding: 5px 10px; background: white; border: 1px solid #dee2e6; border-radius: 6px; font-size: 14px;">
                    ${cat.emoji} ${cat.name}
                    <button onclick="deleteCustomCategory(${index})" style="background: none; border: none; color: #dc3545; cursor: pointer; padding: 0; margin-left: 5px; font-size: 16px;">√ó</button>
                </span>
            `).join('');
        }

        // Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateAllCategorySelects() {
            renderCategoryOptions('categorySelect', true);
            renderCategoryOptions('editCategory', false);
            updateCategoryFilterOptions();
        }

        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        function loadData() {
            const savedData = localStorage.getItem('budgetAppEuro_v2');
            if (savedData) {
                const data = JSON.parse(savedData);
                salaries = data.salaries || [];
                fixedExpenses = data.fixedExpenses || [];
                dailyExpenses = data.dailyExpenses || [];
                customCategories = data.customCategories || [];
                assets = data.assets || [];
                
                console.log('Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ ÏôÑÎ£å:', {
                    salaries: salaries.length,
                    fixedExpenses: fixedExpenses.length,
                    dailyExpenses: dailyExpenses.length,
                    customCategories: customCategories.length,
                    assets: assets.length
                });
                
                // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïóê Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÎìúÍ∞Ä ÏóÜÏúºÎ©¥ Ï∂îÍ∞Ä (ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò)
                dailyExpenses = dailyExpenses.map(expense => {
                    if (!expense.category) {
                        // ÏàòÏûÖÏù∏ Í≤ΩÏö∞
                        if (expense.type === 'income') {
                            expense.category = 'ÏàòÏûÖ';
                        } else {
                            // ÏßÄÏ∂úÏù∏ Í≤ΩÏö∞ Í∏∞Î≥∏Í∞í
                            expense.category = 'Í∏∞ÌÉÄ';
                        }
                    }
                    return expense;
                });
                
                console.log('ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏôÑÎ£å, ÏÉòÌîå Îç∞Ïù¥ÌÑ∞:', dailyExpenses[0]);
                
                // ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÌõÑ Ï†ÄÏû•
                saveData();
                
                updateDisplay();
                renderFixedList();
                renderDailyList();
                renderSalaryList();
                renderAssetsList();
            }
            // Ïò§Îäò ÎÇ†Ïßú Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
            document.getElementById('dailyDate').valueAsDate = new Date();
            // ÌòÑÏû¨ Ïõî Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
            const now = new Date();
            const currentMonth = now.toISOString().slice(0, 7);
            document.getElementById('salaryMonth').value = currentMonth;
            
            // Î©îÏù∏ ÌôîÎ©¥ Ïõî ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            updateViewMonthDisplay();
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨ UI ÏóÖÎç∞Ïù¥Ìä∏
            updateAllCategorySelects();
            renderCustomCategoryList();
        }

        // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveData() {
            const data = {
                salaries: salaries,
                fixedExpenses: fixedExpenses,
                dailyExpenses: dailyExpenses,
                customCategories: customCategories,
                assets: assets
            };
            localStorage.setItem('budgetAppEuro_v2', JSON.stringify(data));
        }

        // Î©îÏù∏ ÌôîÎ©¥ Ïõî Î≥ÄÍ≤Ω
        function changeViewMonth(delta) {
            currentViewMonth.setMonth(currentViewMonth.getMonth() + delta);
            updateViewMonthDisplay();
            updateDisplay();
            renderDailyList();
            // Update stats if visible
            if (document.getElementById('statsTab')?.classList.contains('active')) {
                renderCategoryStats();
                renderBudgetGoals();
                updateCharts();
            }
        }

        // Î©îÏù∏ ÌôîÎ©¥ Ïõî ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateViewMonthDisplay() {
            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth() + 1;
            document.getElementById('viewMonth').textContent = typeof t('yearMonth') === 'function' ? t('yearMonth')(year, month) : `${year}ÎÖÑ ${month}Ïõî`;
        }

        // Ìï¥Îãπ ÏõîÏùò ÏùºÎ≥ÑÏßÄÏ∂ú ÌïÑÌÑ∞ÎßÅ
        // Ìï¥Îãπ ÏõîÏùò ÏùºÎ≥ÑÏßÄÏ∂ú ÌïÑÌÑ∞ÎßÅ
        function getMonthlyExpenses(year, month) {
            return dailyExpenses.filter(expense => {
                if (!expense.date) return false;
                
                // YYYY-MM-DD ÌòïÏãùÏùò ÎÇ†ÏßúÎ•º ÏïàÏ†ÑÌïòÍ≤å ÌååÏã±
                const [expenseYear, expenseMonth, expenseDay] = expense.date.split('-').map(Number);
                return expenseYear === year && (expenseMonth - 1) === month;
            });
        }

        // Ìï¥Îãπ ÏõîÏùò ÏõîÍ∏â Í∞ÄÏ†∏Ïò§Í∏∞
        function getMonthlySalary(year, month) {
            const monthStr = `${year}-${String(month + 1).padStart(2, '0')}`;
            const salary = salaries.find(s => s.month === monthStr);
            return salary ? salary.amount : 0;
        }

        // ===== Collapsible sections =====
        function toggleSection(sectionId, toggleEl) {
            const body = document.getElementById(sectionId);
            if (!body) return;
            body.classList.toggle('collapsed');
            if (toggleEl) toggleEl.classList.toggle('collapsed');
        }

        // Í≥†Ï†ïÏßÄÏ∂ú Ï¥ùÏï° Î∞∞ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
        function updateFixedBadge() {
            const totalEl = document.getElementById('fixedTotalBadge');
            const countEl = document.getElementById('fixedCountBadge');
            if (!totalEl) return;
            const total = fixedExpenses.reduce((s, e) => s + e.amount, 0);
            totalEl.textContent = total > 0 ? formatCurrency(total) : '';
            if (countEl) {
                countEl.textContent = fixedExpenses.length > 0 
                    ? `(${fixedExpenses.length}${currentLang === 'ko' ? 'Í±¥' : currentLang === 'de' ? ' Posten' : ' items'})` 
                    : '';
            }
        }

        // ÌÉ≠ Ï†ÑÌôò
        function switchTab(evt, tab) {
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            evt.currentTarget.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
            
            // ÌÜµÍ≥Ñ ÌÉ≠ÏúºÎ°ú Ï†ÑÌôò Ïãú ÌÜµÍ≥Ñ + Í≥†Ï†ïÏßÄÏ∂ú Î†åÎçîÎßÅ
            if (tab === 'stats') {
                renderFixedList();
                updateFixedBadge();
                renderCategoryStats();
                renderBudgetGoals();
                updateCharts();
            }
        }

        // Í±∞Îûò Ïú†ÌòïÏóê Îî∞Îùº Í≤∞Ï†ú ÏàòÎã® ÌëúÏãú/Ïà®ÍπÄ
        function updatePaymentMethodOptions() {
            const transactionType = document.getElementById('transactionType').value;
            const paymentMethodGroup = document.getElementById('paymentMethodGroup');
            const transferFields = document.getElementById('transferFields');
            const categoryGroup = document.getElementById('categoryGroupContainer');
            const nameInput = document.getElementById('dailyName');
            
            if (transactionType === 'transfer') {
                paymentMethodGroup.style.display = 'none';
                transferFields.style.display = 'block';
                if (categoryGroup) categoryGroup.style.display = 'none';
                populateTransferDropdowns();
                nameInput.placeholder = currentLang === 'ko' ? 'Ïòà: ÏÉùÌôúÎπÑ Ïù¥Ï≤¥' : currentLang === 'de' ? 'z.B. √úberweisung' : 'e.g., Transfer';
            } else if (transactionType === 'income') {
                paymentMethodGroup.style.display = 'none';
                transferFields.style.display = 'none';
                if (categoryGroup) categoryGroup.style.display = 'block';
                nameInput.placeholder = t('dailyNamePlaceholder');
            } else {
                paymentMethodGroup.style.display = 'block';
                transferFields.style.display = 'none';
                if (categoryGroup) categoryGroup.style.display = 'block';
                nameInput.placeholder = t('dailyNamePlaceholder');
            }
        }

        // Ïù¥Ï≤¥ ÎìúÎ°≠Îã§Ïö¥ÏùÑ ÏûêÏÇ∞ Î™©Î°ùÏóêÏÑú ÏÉùÏÑ±
        function populateTransferDropdowns() {
            const fromSel = document.getElementById('transferFrom');
            const toSel = document.getElementById('transferTo');
            if (!fromSel || !toSel) return;

            const externalLabel = currentLang === 'ko' ? 'üìã Ïô∏Î∂Ä (ÏûêÏÇ∞ ÎØ∏Îì±Î°ù)' : currentLang === 'de' ? 'üìã Extern (nicht registriert)' : 'üìã External (unregistered)';
            const walletLabel = currentLang === 'ko' ? 'üè¶ ÏõîÍ∏â ÌÜµÏû• (Ïù¥ Ïï±)' : currentLang === 'de' ? 'üè¶ Gehaltskonto (diese App)' : 'üè¶ Salary Account (this app)';

            let options = `<option value="salary_account">${walletLabel}</option>`;
            assets.forEach(a => {
                const icon = a.assetType === 'crypto' ? 'ü™ô' : a.assetType === 'stock' ? 'üìà' : 'üè¶';
                const balance = a.assetType === 'stock' 
                    ? `${a.amount}Ï£º` 
                    : `${a.amount.toLocaleString()} ${a.currency}`;
                options += `<option value="asset_${a.id}">${icon} ${a.platform} (${balance})</option>`;
            });
            options += `<option value="external">${externalLabel}</option>`;

            fromSel.innerHTML = options;
            toSel.innerHTML = options;

            // Í∏∞Î≥∏Í∞í: ÏûêÏÇ∞ Ï§ë KRW ‚Üí EUR or Ï≤´Î≤àÏß∏ ‚Üí ÎëêÎ≤àÏß∏
            const krAsset = assets.find(a => a.currency === 'KRW');
            const eurAsset = assets.find(a => a.currency === 'EUR');
            if (krAsset) fromSel.value = 'asset_' + krAsset.id;
            if (eurAsset) toSel.value = 'asset_' + eurAsset.id;
            else toSel.value = 'salary_account';

            // ÏûîÏï° ÌûåÌä∏ ÏóÖÎç∞Ïù¥Ìä∏
            fromSel.onchange = toSel.onchange = updateTransferHint;
            updateTransferHint();
        }

        function updateTransferHint() {
            const hint = document.getElementById('transferAmountHint');
            if (!hint) return;
            const fromVal = document.getElementById('transferFrom').value;
            const toVal = document.getElementById('transferTo').value;

            let parts = [];
            [fromVal, toVal].forEach((val, i) => {
                if (val === 'salary_account') {
                    parts.push(i === 0 ? `Ï∂úÍ∏à: üè¶ ÏõîÍ∏â ÌÜµÏû•` : `ÏûÖÍ∏à: üè¶ ÏõîÍ∏â ÌÜµÏû•`);
                } else if (val.startsWith('asset_')) {
                    const a = assets.find(x => x.id === parseInt(val.replace('asset_', '')));
                    if (a) {
                        const bal = a.assetType === 'stock' ? `${a.amount}Ï£º` : `${a.amount.toLocaleString()} ${a.currency}`;
                        parts.push(`${i === 0 ? (currentLang==='ko'?'Ï∂úÍ∏à':'From') : (currentLang==='ko'?'ÏûÖÍ∏à':'To')}: ${a.platform} (${bal})`);
                    }
                }
            });

            if (parts.length > 0) {
                hint.innerHTML = parts.join(' ‚Üí ');
                hint.style.display = 'block';
            } else {
                hint.style.display = 'none';
            }
        }

        // Ïù¥Ï≤¥ Ïãú ÏûêÏÇ∞ ÏûîÏï° Ï°∞Ï†ï
        function applyTransferToAssets(fromVal, toVal, amountEUR) {
            // Ï∂úÍ∏à Í≥ÑÏ¢å Ï≤òÎ¶¨
            if (fromVal.startsWith('asset_')) {
                const id = parseInt(fromVal.replace('asset_', ''));
                const asset = assets.find(a => a.id === id);
                if (asset) {
                    if (asset.currency === 'EUR') {
                        asset.amount -= amountEUR;
                    } else {
                        // EUR ‚Üí Ìï¥Îãπ ÌÜµÌôîÎ°ú ÌôòÏÇ∞Ìï¥ÏÑú Ï∞®Í∞ê
                        const rate = exchangeRates[asset.currency] || 0;
                        if (rate > 0) {
                            const amountInCurrency = amountEUR / rate;
                            asset.amount -= amountInCurrency;
                        }
                    }
                    asset.amount = Math.round(asset.amount * 100) / 100;
                }
            }
            // salary_accountÎäî updateDisplayÏóêÏÑú ÏûêÎèô Í≥ÑÏÇ∞Îê®
            // externalÏùÄ ÏûêÏÇ∞Ïóê ÏòÅÌñ• ÏóÜÏùå

            // ÏûÖÍ∏à Í≥ÑÏ¢å Ï≤òÎ¶¨
            if (toVal.startsWith('asset_')) {
                const id = parseInt(toVal.replace('asset_', ''));
                const asset = assets.find(a => a.id === id);
                if (asset) {
                    if (asset.currency === 'EUR') {
                        asset.amount += amountEUR;
                    } else {
                        const rate = exchangeRates[asset.currency] || 0;
                        if (rate > 0) {
                            const amountInCurrency = amountEUR / rate;
                            asset.amount += amountInCurrency;
                        }
                    }
                    asset.amount = Math.round(asset.amount * 100) / 100;
                }
            }

            saveData();
        }

        // ÏõîÍ∏â ÏÑ§Ï†ï
        function setSalary() {
            const monthInput = document.getElementById('salaryMonth');
            const amountInput = document.getElementById('salaryInput');
            const month = monthInput.value;
            const amount = parseFloat(amountInput.value);

            if (!month || !amount) {
                alert(t('enterMonthAndAmount'));
                return;
            }

            // Í∞ôÏùÄ ÏõîÏù¥ ÏûàÏúºÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏, ÏóÜÏúºÎ©¥ Ï∂îÍ∞Ä
            const existingIndex = salaries.findIndex(s => s.month === month);
            if (existingIndex >= 0) {
                salaries[existingIndex].amount = amount;
            } else {
                salaries.push({
                    id: Date.now(),
                    month: month,
                    amount: amount
                });
            }

            // ÎÇ†ÏßúÏàú Ï†ïÎ†¨ (ÏµúÏã†Ïàú)
            salaries.sort((a, b) => b.month.localeCompare(a.month));

            amountInput.value = '';

            saveData();
            updateDisplay();
            renderSalaryList();
            alert(t('salarySaved'));
        }

        // ÏõîÍ∏â ÏÇ≠Ï†ú
        function deleteSalary(id) {
            salaries = salaries.filter(s => s.id !== id);
            saveData();
            updateDisplay();
            renderSalaryList();
        }

        // ÏõîÍ∏â Î™©Î°ù Î†åÎçîÎßÅ
        function renderSalaryList() {
            const list = document.getElementById('salaryList');
            
            if (salaries.length === 0) {
                list.innerHTML = `
                    <h3 style="margin: 20px 0 15px 0; color: #333;">${t('monthlySalaryHistory')}</h3>
                    <div class="empty-state">
                        <div class="empty-state-icon">üí∂</div>
                        <p>${t('noSalaryYet')}</p>
                    </div>
                `;
                return;
            }

            let html = `<h3 style="margin: 20px 0 15px 0; color: #333;">${t('monthlySalaryHistory')}</h3>`;
            html += salaries.map(salary => {
                const [year, month] = salary.month.split('-');
                const displayMonth = typeof t('yearMonth') === 'function' ? t('yearMonth')(parseInt(year), parseInt(month)) : `${year}ÎÖÑ ${month}Ïõî`;
                return `
                    <div class="list-item">
                        <div class="list-item-info">
                            <div class="list-item-name">${displayMonth}</div>
                        </div>
                        <div class="list-item-amount">${formatCurrency(salary.amount)}</div>
                        <button class="btn btn-delete" onclick="deleteSalary(${salary.id})">${t('delete')}</button>
                    </div>
                `;
            }).join('');

            list.innerHTML = html;
        }

        // Í≥†Ï†ïÏßÄÏ∂ú Ï∂îÍ∞Ä
        function addFixedExpense() {
            const name = document.getElementById('fixedName').value;
            const amount = parseFloat(document.getElementById('fixedAmount').value);

            if (!name || !amount) {
                alert(t('enterNameAndAmount'));
                return;
            }

            fixedExpenses.push({
                id: Date.now(),
                name: name,
                amount: amount
            });

            document.getElementById('fixedName').value = '';
            document.getElementById('fixedAmount').value = '';

            saveData();
            updateDisplay();
            renderFixedList();
            renderBudgetGoals();
            updateFixedBadge();
        }
        async function addDailyExpense() {
            const date = document.getElementById('dailyDate').value;
            const name = document.getElementById('dailyName').value;
            const amount = parseFloat(document.getElementById('dailyAmount').value);
            const transactionType = document.getElementById('transactionType').value;
            const paymentMethod = transactionType === 'income' ? 'income' : transactionType === 'transfer' ? 'transfer' : document.getElementById('paymentMethod').value;
            let category = document.getElementById('categorySelect').value;

            if (!date || !amount) {
                alert(t('enterAllFields'));
                return;
            }

            // Ïù¥Ï≤¥ Ï≤òÎ¶¨
            if (transactionType === 'transfer') {
                const from = document.getElementById('transferFrom').value;
                const to = document.getElementById('transferTo').value;
                const memo = document.getElementById('transferMemo').value;
                if (from === to) {
                    alert(currentLang === 'ko' ? 'Ï∂úÍ∏à/ÏûÖÍ∏à Í≥ÑÏ¢åÍ∞Ä Í∞ôÏäµÎãàÎã§.' : 'Source and destination are the same.');
                    return;
                }

                // Í≥ÑÏ¢åÎ™Ö ÏÉùÏÑ±
                function getAccountName(val) {
                    if (val === 'salary_account') return 'üè¶ ' + (currentLang === 'ko' ? 'ÏõîÍ∏â ÌÜµÏû•' : 'Salary');
                    if (val === 'external') return 'üìã ' + (currentLang === 'ko' ? 'Ïô∏Î∂Ä' : 'External');
                    if (val.startsWith('asset_')) {
                        const a = assets.find(x => x.id === parseInt(val.replace('asset_', '')));
                        return a ? `${a.platform} (${a.currency})` : val;
                    }
                    return val;
                }
                const transferName = name || `${getAccountName(from)} ‚Üí ${getAccountName(to)}`;
                
                // ÏûêÏÇ∞ ÏûîÏï° Ï°∞Ï†ï
                applyTransferToAssets(from, to, amount);

                dailyExpenses.push({
                    id: Date.now(),
                    date: date,
                    name: transferName,
                    amount: amount,
                    paymentMethod: 'transfer',
                    type: 'transfer',
                    category: 'Ïù¥Ï≤¥',
                    transferFrom: from,
                    transferTo: to,
                    transferMemo: memo
                });

                document.getElementById('dailyName').value = '';
                document.getElementById('dailyAmount').value = '';
                document.getElementById('transferMemo').value = '';
                document.getElementById('transactionType').value = 'expense';
                updatePaymentMethodOptions();
                saveData();
                updateDisplay();
                renderDailyList();
                renderAssetsList();
                if (currentView === 'calendar') renderCalendar();
                return;
            }

            if (!name) {
                alert(t('enterAllFields'));
                return;
            }

            // AI ÏûêÎèô Î∂ÑÎ•òÍ∞Ä ÏÑ†ÌÉùÎêú Í≤ΩÏö∞
            if (!category && transactionType === 'expense') {
                // Î°úÎî© ÌëúÏãú
                const addButton = event.target;
                const originalText = addButton.textContent;
                addButton.textContent = t('aiClassifying');
                addButton.disabled = true;
                
                try {
                    category = await classifyExpenseWithAI(name);
                    console.log(`"${name}" ‚Üí "${category}"Î°ú Î∂ÑÎ•òÎê®`);
                } catch (error) {
                    console.error('AI Î∂ÑÎ•ò Ïã§Ìå®:', error);
                    category = 'Í∏∞ÌÉÄ';
                } finally {
                    addButton.textContent = originalText;
                    addButton.disabled = false;
                }
            } else if (transactionType === 'income') {
                category = 'ÏàòÏûÖ';
            }

            dailyExpenses.push({
                id: Date.now(),
                date: date,
                name: name,
                amount: amount,
                paymentMethod: paymentMethod,
                type: transactionType,
                category: category || 'Í∏∞ÌÉÄ'
            });

            document.getElementById('dailyName').value = '';
            document.getElementById('dailyAmount').value = '';
            document.getElementById('transactionType').value = 'expense';
            document.getElementById('paymentMethod').value = 'regular';
            document.getElementById('categorySelect').value = '';
            updatePaymentMethodOptions();

            saveData();
            updateDisplay();
            renderDailyList();
            
            // Îã¨Î†• Î≥¥Í∏∞Í∞Ä ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏúºÎ©¥ Îã¨Î†•ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            if (currentView === 'calendar') {
                renderCalendar();
            }
        }

        // AIÎ°ú ÏßÄÏ∂ú Ïπ¥ÌÖåÍ≥†Î¶¨ Î∂ÑÎ•ò
        async function classifyExpenseWithAI(itemName) {
            try {
                const allCategories = getAllCategories();
                const categoryNames = allCategories.map(c => c.name).join(', ');
                
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 50,
                        messages: [
                            {
                                role: 'user',
                                content: `Îã§Ïùå ÏßÄÏ∂ú Ìï≠Î™©ÏùÑ Í∞ÄÏû• Ï†ÅÌï©Ìïú Ïπ¥ÌÖåÍ≥†Î¶¨Î°ú Î∂ÑÎ•òÌïòÏÑ∏Ïöî: "${itemName}"

ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïπ¥ÌÖåÍ≥†Î¶¨: ${categoryNames}

ÏòàÏãú:
- "Î≤ÑÍ±∞ÌÇπ", "Îß•ÎèÑÎÇ†Îìú", "Î∞•", "Ïª§Ìîº", "ÏãùÎãπ" ‚Üí ÏãùÎπÑ
- "Î≤ÑÏä§", "ÏßÄÌïòÏ≤†", "ÌÉùÏãú", "Í∏∞Ï∞®Ìëú" ‚Üí ÍµêÌÜµÎπÑ
- "Ïò∑", "Ïã†Î∞ú", "Í∞ÄÎ∞©", "ÌôîÏû•Ìíà" ‚Üí ÏáºÌïë
- "ÏòÅÌôî", "Í≥µÏó∞", "Í≤åÏûÑ", "ÎÑ∑ÌîåÎ¶≠Ïä§" ‚Üí Î¨∏ÌôîÏÉùÌôú
- "Ïú†ÌäúÎ∏å ÌîÑÎ¶¨ÎØ∏ÏóÑ", "Ïä§Ìè¨Ìã∞ÌååÏù¥", "Íµ¨ÎèÖ" ‚Üí Íµ¨ÎèÖÎ£å
- "Î≥ëÏõê", "ÏïΩ", "Í±¥Í∞ïÍ≤ÄÏßÑ" ‚Üí ÏùòÎ£å
- "Ï±Ö", "Í∞ïÏùò", "ÌïôÏõê" ‚Üí ÍµêÏú°

Î∞òÎìúÏãú ÏúÑ Ïπ¥ÌÖåÍ≥†Î¶¨ Ï§ë ÌïòÎÇòÎßå ÎãµÌïòÏÑ∏Ïöî. Îã§Î•∏ ÎßêÏùÄ ÌïòÏßÄ ÎßàÏÑ∏Ïöî.`
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Ïò§Î•ò:', response.status, errorText);
                    throw new Error('AI Î∂ÑÎ•ò Ïã§Ìå®');
                }

                const data = await response.json();
                const category = data.content[0].text.trim();
                
                console.log('AI ÏùëÎãµ:', category);
                
                // Ïú†Ìö®Ìïú Ïπ¥ÌÖåÍ≥†Î¶¨Ïù∏ÏßÄ ÌôïÏù∏
                const validCategories = allCategories.map(c => c.name);
                return validCategories.includes(category) ? category : 'Í∏∞ÌÉÄ';
            } catch (error) {
                console.error('AI Î∂ÑÎ•ò Ïò§Î•ò:', error);
                return 'Í∏∞ÌÉÄ';
            }
        }

        // Í∏∞Ï°¥ ÎÇ¥Ïó≠ ÏùºÍ¥Ñ AI Î∂ÑÎ•ò
        // Í∏∞Ï°¥ ÎÇ¥Ïó≠ ÏùºÍ¥Ñ AI Î∂ÑÎ•ò
        async function bulkClassifyExpenses(evt) {
            console.log('=== ÏùºÍ¥Ñ Î∂ÑÎ•ò ÏãúÏûë ===');
            console.log('Ï†ÑÏ≤¥ dailyExpenses Í∞úÏàò:', dailyExpenses.length);
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä "Í∏∞ÌÉÄ"Ïù∏ ÏßÄÏ∂úÎßå ÌïÑÌÑ∞ÎßÅ
            const unclassifiedExpenses = dailyExpenses.filter(e => 
                e.type === 'expense' && (e.category === 'Í∏∞ÌÉÄ' || !e.category)
            );

            console.log('Î∂ÑÎ•ò ÎåÄÏÉÅ Í∞úÏàò:', unclassifiedExpenses.length);

            if (unclassifiedExpenses.length === 0) {
                alert(t('nothingToClassify'));
                return;
            }

            alert(`${unclassifiedExpenses.length}${t('bulkClassifyStart')}`);
            
            console.log('Î∂ÑÎ•ò ÏãúÏûë!');

            // Î≤ÑÌäº Ï∞æÍ∏∞
            const button = evt.target;
            const originalText = button.textContent;
            button.textContent = t('classifying');
            button.disabled = true;

            try {
                let classified = 0;
                let failed = 0;
                
                console.log('for Î£®ÌîÑ ÏãúÏûë');
                
                for (let i = 0; i < unclassifiedExpenses.length; i++) {
                    const expense = unclassifiedExpenses[i];
                    console.log(`\n=== [${i+1}/${unclassifiedExpenses.length}] Ï≤òÎ¶¨ ÏãúÏûë ===`);
                    console.log('Ìï≠Î™©:', expense.name, 'ID:', expense.id);
                    
                    try {
                        console.log('AI Î∂ÑÎ•ò Ìò∏Ï∂ú Ï†Ñ...');
                        const category = await classifyExpenseWithAI(expense.name);
                        console.log('AI Î∂ÑÎ•ò Í≤∞Í≥º:', category);
                        
                        // ÏõêÎ≥∏ Î∞∞Ïó¥ÏóêÏÑú Ìï¥Îãπ Ìï≠Î™© Ï∞æÏïÑÏÑú ÏßÅÏ†ë ÏàòÏ†ï
                        const index = dailyExpenses.findIndex(e => e.id === expense.id);
                        console.log('Î∞∞Ïó¥ Ïù∏Îç±Ïä§:', index);
                        
                        if (index !== -1) {
                            console.log('ÏàòÏ†ï Ï†Ñ Ïπ¥ÌÖåÍ≥†Î¶¨:', dailyExpenses[index].category);
                            dailyExpenses[index].category = category;
                            console.log('ÏàòÏ†ï ÌõÑ Ïπ¥ÌÖåÍ≥†Î¶¨:', dailyExpenses[index].category);
                        } else {
                            console.error('‚ùå Ìï≠Î™©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå!');
                        }
                        
                        classified++;
                        button.textContent = `${classified}/${unclassifiedExpenses.length} ${t('processing')}`;
                        
                        // API Ìò∏Ï∂ú Í∞Ñ ÏßßÏùÄ ÏßÄÏó∞
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                    } catch (error) {
                        console.error(`‚ùå Î∂ÑÎ•ò Ïã§Ìå® (${expense.name}):`, error);
                        failed++;
                    }
                }

                console.log('\n=== Î∂ÑÎ•ò ÏôÑÎ£å ===');
                console.log('ÏÑ±Í≥µ:', classified, 'Ïã§Ìå®:', failed);
                
                saveData();
                console.log('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÏôÑÎ£å');
                
                renderDailyList();
                console.log('Î™©Î°ù Î†åÎçîÎßÅ ÏôÑÎ£å');
                
                if (failed > 0) {
                    alert(`‚úÖ ${classified}${t('classifyComplete')}\n‚ö†Ô∏è ${failed}${t('classifyFailed')}`);
                } else {
                    alert(`‚úÖ ${classified}${t('classifyComplete')}`);
                }
            } catch (error) {
                console.error('‚ùå ÏùºÍ¥Ñ Î∂ÑÎ•ò Ïò§Î•ò:', error);
                alert(t('classifyError') + error.message);
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        // ÏàòÏ†ï Î™®Îã¨ÏóêÏÑú AI Î∂ÑÎ•ò
        async function aiClassifyInEdit(evt) {
            const itemName = document.getElementById('editName').value;
            
            if (!itemName) {
                alert(t('enterItemNameFirst'));
                return;
            }

            const button = evt.target;
            const originalText = button.textContent;
            button.textContent = t('classifying');
            button.disabled = true;

            try {
                const category = await classifyExpenseWithAI(itemName);
                document.getElementById('editCategory').value = category;
                alert(`"${getCategoryDisplayName(category)}"${t('classifiedAs')}`);
            } catch (error) {
                console.error('AI Î∂ÑÎ•ò Ïò§Î•ò:', error);
                alert(t('classifyError') + error.message);
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        // Í≥†Ï†ïÏßÄÏ∂ú ÏÇ≠Ï†ú
        function deleteFixedExpense(id) {
            fixedExpenses = fixedExpenses.filter(e => e.id !== id);
            saveData();
            updateDisplay();
            renderFixedList();
            renderBudgetGoals();
            updateFixedBadge();
        }

        // ÏùºÎ≥ÑÏßÄÏ∂ú ÏÇ≠Ï†ú
        function deleteDailyExpense(id) {
            // Ïù¥Ï≤¥ ÏÇ≠Ï†ú Ïãú ÏûêÏÇ∞ ÏûîÏï° ÎêòÎèåÎ¶¨Í∏∞
            const expense = dailyExpenses.find(e => e.id === id);
            if (expense && expense.type === 'transfer' && expense.transferFrom && expense.transferTo) {
                // Î∞òÎåÄÎ°ú Ï†ÅÏö© (from‚Üîto)
                applyTransferToAssets(expense.transferTo, expense.transferFrom, expense.amount);
            }

            dailyExpenses = dailyExpenses.filter(e => e.id !== id);
            saveData();
            updateDisplay();
            renderDailyList();
            renderAssetsList();
            
            if (currentView === 'calendar') {
                renderCalendar();
            }
        }

        // Í∏àÏï° Ìè¨Îß∑ÌåÖ (Ïú†Î°ú)
        function formatCurrency(amount) {
            return '‚Ç¨' + amount.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        // ÏÉÅÎã® ÏöîÏïΩ ÏóÖÎç∞Ïù¥Ìä∏
        function updateDisplay() {
            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth();
            
            const currentSalary = getMonthlySalary(year, month);
            const totalFixed = fixedExpenses.reduce((sum, e) => sum + e.amount, 0);
            const monthlyExpenses = getMonthlyExpenses(year, month);
            
            const expenses = monthlyExpenses.filter(e => e.type === 'expense');
            const incomes = monthlyExpenses.filter(e => e.type === 'income');
            const transfers = monthlyExpenses.filter(e => e.type === 'transfer');
            
            const regularExpenses = expenses.filter(e => (e.paymentMethod || 'regular') === 'regular');
            const cryptoExpenses = expenses.filter(e => e.paymentMethod === 'crypto');
            
            const totalRegular = regularExpenses.reduce((sum, e) => sum + e.amount, 0);
            const totalCrypto = cryptoExpenses.reduce((sum, e) => sum + e.amount, 0);
            const totalIncome = incomes.reduce((sum, e) => sum + e.amount, 0);
            
            // Ïù¥Ï≤¥: ÌÜµÏû•(main)ÏóêÏÑú ÎÇòÍ∞Ñ/Îì§Ïñ¥Ïò® Í∏àÏï°
            const transferOut = transfers.filter(e => e.transferFrom === 'salary_account').reduce((s, e) => s + e.amount, 0);
            const transferIn = transfers.filter(e => e.transferTo === 'salary_account').reduce((s, e) => s + e.amount, 0);
            
            // ÌÜµÏû•ÏóêÏÑú ÎÇòÍ∞ÄÎäî Í∏àÏï° Í≥ÑÏÇ∞ (ÏõîÍ∏â + ÏàòÏûÖ - Í≥†Ï†ïÏßÄÏ∂ú - ÏùºÎ∞òÏπ¥ÎìúÏßÄÏ∂ú - Ïù¥Ï≤¥Ï∂úÍ∏à + Ïù¥Ï≤¥ÏûÖÍ∏à)
            const remaining = currentSalary + totalIncome - totalFixed - totalRegular - transferOut + transferIn;

            setAmountText(document.getElementById('salaryDisplay'), formatCurrency(currentSalary));
            setAmountText(document.getElementById('incomeDisplay'), formatCurrency(totalIncome));
            setAmountText(document.getElementById('fixedExpenseDisplay'), formatCurrency(totalFixed));
            setAmountText(document.getElementById('dailyExpenseDisplay'), formatCurrency(totalRegular));
            setAmountText(document.getElementById('cryptoExpenseDisplay'), formatCurrency(totalCrypto));
            setAmountText(document.getElementById('remainingDisplay'), formatCurrency(remaining));

            // Ïù¥Ï≤¥ ÌëúÏãú
            const transferDisplay = document.getElementById('transferDisplay');
            const netTransfer = transferOut - transferIn;
            if (transferDisplay) {
                if (transfers.length > 0) {
                    transferDisplay.parentElement.style.display = '';
                    setAmountText(transferDisplay, formatCurrency(netTransfer));
                } else {
                    transferDisplay.parentElement.style.display = 'none';
                }
            }

            // ÎÇ®ÏùÄ Í∏àÏï° ÏÉâÏÉÅ Î≥ÄÍ≤Ω
            const remainingEl = document.getElementById('remainingDisplay');
            if (remaining < 0) {
                remainingEl.style.color = 'var(--text-primary)';
                remainingEl.style.fontWeight = 'bold';
            } else {
                remainingEl.style.color = 'var(--text-primary)';
                remainingEl.style.fontWeight = '';
            }

            // Update hero
            updateHeroAssets();
        }

        // Í≥†Ï†ïÏßÄÏ∂ú Î™©Î°ù Î†åÎçîÎßÅ
        function renderFixedList() {
            const list = document.getElementById('fixedList');
            
            if (fixedExpenses.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>${t('noFixedYet')}</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = fixedExpenses.map((expense, index) => `
                <div class="list-item" draggable="true" data-id="${expense.id}" data-index="${index}">
                    <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    <div class="list-item-info">
                        <div class="list-item-name">${expense.name}</div>
                    </div>
                    <div class="list-item-amount">${formatCurrency(expense.amount)}</div>
                    <button class="btn btn-delete" onclick="deleteFixedExpense(${expense.id})">${t('delete')}</button>
                </div>
            `).join('');

            // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            setupDragAndDrop();
        }

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ ÏÑ§Ï†ï
        function setupDragAndDrop() {
            const items = document.querySelectorAll('#fixedList .list-item');
            let draggedItem = null;
            let draggedIndex = null;

            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedItem = item;
                    draggedIndex = parseInt(item.dataset.index);
                    item.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });

                item.addEventListener('dragend', (e) => {
                    item.classList.remove('dragging');
                    // Î™®Îì† drag-over ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                    items.forEach(i => i.classList.remove('drag-over'));
                });

                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    if (item !== draggedItem) {
                        item.classList.add('drag-over');
                    }
                });

                item.addEventListener('dragleave', (e) => {
                    item.classList.remove('drag-over');
                });

                item.addEventListener('drop', (e) => {
                    e.preventDefault();
                    item.classList.remove('drag-over');
                    
                    if (item !== draggedItem) {
                        const dropIndex = parseInt(item.dataset.index);
                        
                        // Î∞∞Ïó¥ÏóêÏÑú Ìï≠Î™© ÏàúÏÑú Î≥ÄÍ≤Ω
                        const movedItem = fixedExpenses.splice(draggedIndex, 1)[0];
                        fixedExpenses.splice(dropIndex, 0, movedItem);
                        
                        // Ï†ÄÏû• Î∞è Îã§Ïãú Î†åÎçîÎßÅ
                        saveData();
                        renderFixedList();
                    }
                });
            });
        }

        // ÏùºÎ≥ÑÏßÄÏ∂ú Î™©Î°ù Î†åÎçîÎßÅ
        function renderDailyList() {
            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth();
            
            // Ìï¥Îãπ ÏõîÏùò ÏßÄÏ∂úÎßå ÌïÑÌÑ∞ÎßÅ
            const monthlyExpenses = getMonthlyExpenses(year, month);
            
            // ÏßÄÏ∂úÍ≥º ÏàòÏûÖ Î∂ÑÎ¶¨ (Ïù¥Ï≤¥ Ï†úÏô∏)
            const expenses = monthlyExpenses.filter(e => e.type === 'expense');
            const incomes = monthlyExpenses.filter(e => e.type === 'income');
            
            // ÏõîÎ≥Ñ Ï¥ù ÏßÄÏ∂ú Í≥ÑÏÇ∞ Î∞è ÌëúÏãú
            const monthlyRegular = expenses
                .filter(e => (e.paymentMethod || 'regular') === 'regular')
                .reduce((sum, e) => sum + e.amount, 0);
            
            const monthlyCrypto = expenses
                .filter(e => e.paymentMethod === 'crypto')
                .reduce((sum, e) => sum + e.amount, 0);
            
            const monthlyIncome = incomes.reduce((sum, e) => sum + e.amount, 0);
            const monthlyNet = monthlyRegular + monthlyCrypto - monthlyIncome;

            document.getElementById('listMonthlyRegularTotal').textContent = formatCurrency(monthlyRegular);
            document.getElementById('listMonthlyCryptoTotal').textContent = formatCurrency(monthlyCrypto);
            document.getElementById('listMonthlyIncome').textContent = formatCurrency(monthlyIncome);
            document.getElementById('listMonthlyNet').textContent = formatCurrency(monthlyNet);
            
            const list = document.getElementById('dailyList');
            
            if (monthlyExpenses.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÖ</div>
                        <p>${t('noDailyThisMonth')}</p>
                    </div>
                `;
                return;
            }

            // ÎÇ†ÏßúÏàú Ï†ïÎ†¨ (ÏµúÏã†Ïàú)
            const sorted = [...monthlyExpenses].sort((a, b) => new Date(b.date) - new Date(a.date));

            list.innerHTML = sorted.map(expense => {
                const isIncome = expense.type === 'income';
                const isTransfer = expense.type === 'transfer';
                const paymentMethod = expense.paymentMethod || 'regular';
                const category = expense.category || 'Í∏∞ÌÉÄ';
                
                let badge = '';
                let amountClass = '';
                let amountPrefix = '';
                
                if (isTransfer) {
                    badge = `<span class="transfer-badge">${t('transferBadge')}</span>`;
                    amountClass = '';
                    amountPrefix = 'üîÑ ';
                } else if (isIncome) {
                    badge = `<span class="payment-badge income">${t('incomeBadge')}</span>`;
                    amountClass = ' income';
                    amountPrefix = '+';
                } else if (paymentMethod === 'crypto') {
                    badge = `<span class="payment-badge crypto">${t('cryptoBadge')}</span>`;
                } else {
                    badge = `<span class="payment-badge regular">${t('regularBadge')}</span>`;
                }
                
                // Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î™®ÏßÄ Îß§Ìïë
                const categoryEmoji = getCategoryEmoji(category);
                const categoryBadge = isTransfer ? '' : `<span class="category-badge">${categoryEmoji} ${getCategoryDisplayName(category)}</span>`;
                
                // Ïù¥Ï≤¥ ÏÉÅÏÑ∏
                const transferDetail = isTransfer && expense.transferMemo ? ` ¬∑ ${expense.transferMemo}` : '';
                
                return `
                    <div class="list-item${isIncome ? ' income' : ''}${isTransfer ? ' transfer' : ''}">
                        <div class="list-item-info">
                            <div class="list-item-name">${expense.name} ${badge} ${categoryBadge}</div>
                            <div class="list-item-detail">${expense.date}${transferDetail}</div>
                        </div>
                        <div class="list-item-amount${amountClass}">${amountPrefix}${formatCurrency(expense.amount)}</div>
                        <button class="btn btn-edit" onclick="editDailyExpense(${expense.id})">${t('edit')}</button>
                        <button class="btn btn-delete" onclick="deleteDailyExpense(${expense.id})">${t('delete')}</button>
                    </div>
                `;
            }).join('');
        }

        // Î≥¥Í∏∞ Ï†ÑÌôò (Î™©Î°ù/Îã¨Î†•)
        function switchDailyView(view) {
            currentView = view;
            const listView = document.getElementById('dailyListView');
            const calendarView = document.getElementById('dailyCalendarView');
            const buttons = document.querySelectorAll('.view-toggle button');

            buttons.forEach(btn => btn.classList.remove('active'));

            if (view === 'list') {
                listView.style.display = 'block';
                calendarView.style.display = 'none';
                buttons[0].classList.add('active');
            } else {
                listView.style.display = 'none';
                calendarView.style.display = 'block';
                buttons[1].classList.add('active');
                renderCalendar();
            }
        }

        // Îã¨Î†• Ïõî Î≥ÄÍ≤Ω
        function changeMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            renderCalendar();
        }

        // Îã¨Î†• Î†åÎçîÎßÅ
        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Ïõî ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            const monthNames = t('monthNames');
            document.getElementById('calendarMonth').textContent = typeof t('yearMonth') === 'function' ? t('yearMonth')(year, month + 1) : `${year}ÎÖÑ ${monthNames[month]}`;

            // Ïù¥Î≤à Îã¨Ïùò Ï≤´ÎÇ†Í≥º ÎßàÏßÄÎßâ ÎÇ†
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // Îã¨Î†• ÏãúÏûëÏùº (Ïù¥Ï†Ñ Îã¨ Ìè¨Ìï®)
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            // Îã¨Î†• Ï¢ÖÎ£åÏùº (Îã§Ïùå Îã¨ Ìè¨Ìï®)
            const endDate = new Date(lastDay);
            endDate.setDate(endDate.getDate() + (6 - lastDay.getDay()));

            // Ïù¥Î≤à Îã¨ ÏßÄÏ∂úÎßå ÌïÑÌÑ∞ÎßÅÌïòÏó¨ ÏõîÎ≥Ñ Ï¥ù ÏßÄÏ∂ú Í≥ÑÏÇ∞
            const monthlyExpenses = dailyExpenses.filter(expense => {
                const expenseDate = new Date(expense.date + 'T00:00:00');
                return expenseDate.getFullYear() === year && expenseDate.getMonth() === month;
            });

            const expenses = monthlyExpenses.filter(e => e.type === 'expense');
            const incomes = monthlyExpenses.filter(e => e.type === 'income');

            const monthlyRegular = expenses
                .filter(e => (e.paymentMethod || 'regular') === 'regular')
                .reduce((sum, e) => sum + e.amount, 0);
            
            const monthlyCrypto = expenses
                .filter(e => e.paymentMethod === 'crypto')
                .reduce((sum, e) => sum + e.amount, 0);
            
            const monthlyIncome = incomes.reduce((sum, e) => sum + e.amount, 0);
            const monthlyNet = monthlyRegular + monthlyCrypto - monthlyIncome;

            // ÏõîÎ≥Ñ Ï¥ù ÏßÄÏ∂ú ÌëúÏãú
            document.getElementById('monthlyRegularTotal').textContent = formatCurrency(monthlyRegular);
            document.getElementById('monthlyCryptoTotal').textContent = formatCurrency(monthlyCrypto);
            document.getElementById('monthlyIncome').textContent = formatCurrency(monthlyIncome);
            document.getElementById('monthlyNet').textContent = formatCurrency(monthlyNet);

            // ÎÇ†ÏßúÎ≥Ñ ÏßÄÏ∂ú Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨
            const expensesByDate = {};
            dailyExpenses.forEach(expense => {
                if (!expensesByDate[expense.date]) {
                    expensesByDate[expense.date] = {regular: [], crypto: [], income: []};
                }
                if (expense.type === 'income') {
                    expensesByDate[expense.date].income.push(expense);
                } else {
                    const paymentType = expense.paymentMethod || 'regular';
                    expensesByDate[expense.date][paymentType].push(expense);
                }
            });

            // Îã¨Î†• Í∑∏Î¶¨Í∏∞
            const calendarDays = document.getElementById('calendarDays');
            let html = '';
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayStr = formatDateLocal(today);

            let currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                const dateStr = formatDateLocal(currentDate);
                const isOtherMonth = currentDate.getMonth() !== month;
                const isToday = dateStr === todayStr;
                
                const dayExpenses = expensesByDate[dateStr] || {regular: [], crypto: [], income: []};
                const regularTotal = dayExpenses.regular.reduce((sum, e) => sum + e.amount, 0);
                const cryptoTotal = dayExpenses.crypto.reduce((sum, e) => sum + e.amount, 0);
                const incomeTotal = dayExpenses.income.reduce((sum, e) => sum + e.amount, 0);
                const totalCount = dayExpenses.regular.length + dayExpenses.crypto.length + dayExpenses.income.length;
                
                let dayClass = 'calendar-day';
                if (isOtherMonth) dayClass += ' other-month';
                if (isToday) dayClass += ' today';

                let expenseHtml = '';
                if (regularTotal > 0) {
                    expenseHtml += `<div class="calendar-day-expense">üí≥ ${formatCurrency(regularTotal)}</div>`;
                }
                if (cryptoTotal > 0) {
                    expenseHtml += `<div class="calendar-day-expense" style="font-size: 11px;">ü™ô ${formatCurrency(cryptoTotal)}</div>`;
                }
                if (incomeTotal > 0) {
                    expenseHtml += `<div class="calendar-day-expense" style="font-size: 11px; color: #28a745;">üí∞ +${formatCurrency(incomeTotal)}</div>`;
                }
                if (totalCount > 0) {
                    expenseHtml += `<div class="calendar-day-items">${typeof t('itemCount') === 'function' ? t('itemCount')(totalCount) : totalCount + 'Í±¥'}</div>`;
                }

                html += `
                    <div class="${dayClass}" onclick="showDateDetails('${dateStr}')">
                        <div class="calendar-day-number">${currentDate.getDate()}</div>
                        ${expenseHtml}
                    </div>
                `;

                currentDate.setDate(currentDate.getDate() + 1);
            }

            calendarDays.innerHTML = html;
        }

        // Î°úÏª¨ ÎÇ†ÏßúÎ•º YYYY-MM-DD ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò (ÏãúÍ∞ÑÎåÄ Î¨∏Ï†ú Î∞©ÏßÄ)
        function formatDateLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // ÎÇ†ÏßúÎ≥Ñ ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ Î™®Îã¨ Ïó¥Í∏∞
        function showDateDetails(dateStr) {
            const dayExpenses = dailyExpenses.filter(e => e.date === dateStr);
            
            if (dayExpenses.length === 0) {
                return; // ÏßÄÏ∂úÏù¥ ÏóÜÏúºÎ©¥ Î™®Îã¨ÏùÑ Ïó¥ÏßÄ ÏïäÏùå
            }

            // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ (ÏãúÍ∞ÑÎåÄ Î¨∏Ï†ú Î∞©ÏßÄ)
            const [year, month, day] = dateStr.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const weekdays = t('weekdays');
            const weekday = weekdays[date.getDay()];
            
            document.getElementById('modalDate').textContent = typeof t('dateDisplay') === 'function' ? t('dateDisplay')(year, month, day, weekday) : `${year}ÎÖÑ ${month}Ïõî ${day}Ïùº (${weekday})`;

            // ÏßÄÏ∂úÍ≥º ÏàòÏûÖ Î∂ÑÎ¶¨
            const expenses = dayExpenses.filter(e => e.type === 'expense');
            const incomes = dayExpenses.filter(e => e.type === 'income');
            
            // Í≤∞Ï†ú ÏàòÎã®Î≥ÑÎ°ú Î∂ÑÎ¶¨
            const regularExpenses = expenses.filter(e => (e.paymentMethod || 'regular') === 'regular');
            const cryptoExpenses = expenses.filter(e => e.paymentMethod === 'crypto');

            let html = '';

            // ÏùºÎ∞òÏπ¥Îìú ÏßÄÏ∂ú
            if (regularExpenses.length > 0) {
                html += '<div style="margin-bottom: 20px;">';
                html += `<h4 style="margin-bottom: 10px; color: #495057; font-size: 14px;">${t('regularCardLabel')}</h4>`;
                regularExpenses.forEach(expense => {
                    html += `
                        <div class="modal-expense-item">
                            <div class="modal-expense-info">
                                <div class="modal-expense-name">${expense.name}</div>
                            </div>
                            <div class="modal-expense-amount">${formatCurrency(expense.amount)}</div>
                        </div>
                    `;
                });
                const regularTotal = regularExpenses.reduce((sum, e) => sum + e.amount, 0);
                html += `<div style="text-align: right; padding: 10px 0; font-weight: 600; color: #495057;">${t('subtotal')}: ${formatCurrency(regularTotal)}</div>`;
                html += '</div>';
            }

            // Í∞ÄÏÉÅÌôîÌèêÏπ¥Îìú ÏßÄÏ∂ú
            if (cryptoExpenses.length > 0) {
                html += '<div style="margin-bottom: 20px;">';
                html += `<h4 style="margin-bottom: 10px; color: #495057; font-size: 14px;">${t('cryptoCardLabel')}</h4>`;
                cryptoExpenses.forEach(expense => {
                    html += `
                        <div class="modal-expense-item">
                            <div class="modal-expense-info">
                                <div class="modal-expense-name">${expense.name}</div>
                            </div>
                            <div class="modal-expense-amount">${formatCurrency(expense.amount)}</div>
                        </div>
                    `;
                });
                const cryptoTotal = cryptoExpenses.reduce((sum, e) => sum + e.amount, 0);
                html += `<div style="text-align: right; padding: 10px 0; font-weight: 600; color: #495057;">${t('subtotal')}: ${formatCurrency(cryptoTotal)}</div>`;
                html += '</div>';
            }

            // ÏàòÏûÖ
            if (incomes.length > 0) {
                html += '<div style="margin-bottom: 20px;">';
                html += `<h4 style="margin-bottom: 10px; color: #28a745; font-size: 14px;">${t('incomeSection')}</h4>`;
                incomes.forEach(income => {
                    html += `
                        <div class="modal-expense-item">
                            <div class="modal-expense-info">
                                <div class="modal-expense-name">${income.name}</div>
                            </div>
                            <div class="modal-expense-amount" style="color: #28a745;">+${formatCurrency(income.amount)}</div>
                        </div>
                    `;
                });
                const incomeTotal = incomes.reduce((sum, e) => sum + e.amount, 0);
                html += `<div style="text-align: right; padding: 10px 0; font-weight: 600; color: #28a745;">${t('subtotal')}: +${formatCurrency(incomeTotal)}</div>`;
                html += '</div>';
            }

            // Ï¥ùÌï©
            const totalExpense = expenses.reduce((sum, e) => sum + e.amount, 0);
            const totalIncome = incomes.reduce((sum, e) => sum + e.amount, 0);
            const netAmount = totalExpense - totalIncome;
            
            html += `
                <div class="modal-total">
                    <span>${t('netExpense')}</span>
                    <span>${formatCurrency(netAmount)}</span>
                </div>
            `;

            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('dateModal').classList.add('active');
        }

        // Î™®Îã¨ Îã´Í∏∞
        function closeModal(event) {
            if (!event || event.target.id === 'dateModal') {
                document.getElementById('dateModal').classList.remove('active');
            }
        }

        // ÏùºÎ≥ÑÏßÄÏ∂ú ÏàòÏ†ï Î™®Îã¨ Ïó¥Í∏∞
        function editDailyExpense(id) {
            const expense = dailyExpenses.find(e => e.id === id);
            if (!expense) return;

            editingExpenseId = id;
            
            const transactionType = expense.type || 'expense';
            document.getElementById('editTransactionType').value = transactionType;
            document.getElementById('editDate').value = expense.date;
            document.getElementById('editName').value = expense.name;
            document.getElementById('editAmount').value = expense.amount;
            document.getElementById('editCategory').value = expense.category || 'Í∏∞ÌÉÄ';
            
            if (transactionType === 'expense') {
                document.getElementById('editPaymentMethod').value = expense.paymentMethod || 'regular';
            }
            
            updateEditPaymentMethodOptions();
            document.getElementById('editModal').classList.add('active');
        }

        // ÏàòÏ†ï Î™®Îã¨Ïùò Í≤∞Ï†ú ÏàòÎã® ÌëúÏãú/Ïà®ÍπÄ
        function updateEditPaymentMethodOptions() {
            const transactionType = document.getElementById('editTransactionType').value;
            const paymentMethodGroup = document.getElementById('editPaymentMethodGroup');
            
            if (transactionType === 'income') {
                paymentMethodGroup.style.display = 'none';
            } else {
                paymentMethodGroup.style.display = 'block';
            }
        }

        // ÏàòÏ†ï Ï†ÄÏû•
        function saveEdit() {
            const transactionType = document.getElementById('editTransactionType').value;
            const date = document.getElementById('editDate').value;
            const name = document.getElementById('editName').value;
            const amount = parseFloat(document.getElementById('editAmount').value);
            const category = document.getElementById('editCategory').value;
            const paymentMethod = transactionType === 'income' ? 'income' : document.getElementById('editPaymentMethod').value;

            if (!date || !name || !amount) {
                alert(t('enterAllFieldsEdit'));
                return;
            }

            const expenseIndex = dailyExpenses.findIndex(e => e.id === editingExpenseId);
            if (expenseIndex !== -1) {
                dailyExpenses[expenseIndex] = {
                    ...dailyExpenses[expenseIndex],
                    date: date,
                    name: name,
                    amount: amount,
                    paymentMethod: paymentMethod,
                    type: transactionType,
                    category: category
                };

                saveData();
                updateDisplay();
                renderDailyList();
                
                if (currentView === 'calendar') {
                    renderCalendar();
                }

                closeEditModal();
                alert(t('edited'));
            }
        }

        // ÏàòÏ†ï Î™®Îã¨ Îã´Í∏∞
        function closeEditModal(event) {
            if (!event || event.target.id === 'editModal') {
                document.getElementById('editModal').classList.remove('active');
                editingExpenseId = null;
            }
        }

        // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closeEditModal();
            }
        });

        // Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ (JSON ÌååÏùºÎ°ú Îã§Ïö¥Î°úÎìú)
        function exportData() {
            const data = {
                salaries: salaries,
                fixedExpenses: fixedExpenses,
                dailyExpenses: dailyExpenses,
                exportDate: new Date().toISOString()
            };

            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `budget-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert(t('exportDone'));
        }

        // Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ (JSON ÌååÏùºÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞)
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Îç∞Ïù¥ÌÑ∞ Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
                    if (!data.salaries && !data.fixedExpenses && !data.dailyExpenses) {
                        alert(t('invalidFile'));
                        return;
                    }

                    // Îç∞Ïù¥ÌÑ∞ Î≥ëÌï© Ïó¨Î∂Ä ÌôïÏù∏
                    if (salaries.length > 0 || fixedExpenses.length > 0 || dailyExpenses.length > 0) {
                        const merge = confirm(t('mergeConfirm'));
                        
                        if (merge) {
                            // Îç∞Ïù¥ÌÑ∞ Î≥ëÌï©
                            salaries = [...salaries, ...(data.salaries || [])];
                            fixedExpenses = [...fixedExpenses, ...(data.fixedExpenses || [])];
                            dailyExpenses = [...dailyExpenses, ...(data.dailyExpenses || [])];
                        } else {
                            // Îç∞Ïù¥ÌÑ∞ ÍµêÏ≤¥
                            salaries = data.salaries || [];
                            fixedExpenses = data.fixedExpenses || [];
                            dailyExpenses = data.dailyExpenses || [];
                        }
                    } else {
                        // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Í∑∏ÎÉ• Í∞ÄÏ†∏Ïò§Í∏∞
                        salaries = data.salaries || [];
                        fixedExpenses = data.fixedExpenses || [];
                        dailyExpenses = data.dailyExpenses || [];
                    }

                    // ÏõîÍ∏â ÎÇ†ÏßúÏàú Ï†ïÎ†¨
                    salaries.sort((a, b) => b.month.localeCompare(a.month));

                    saveData();
                    updateDisplay();
                    renderSalaryList();
                    renderFixedList();
                    renderDailyList();
                    
                    if (currentView === 'calendar') {
                        renderCalendar();
                    }

                    alert(t('importDone'));
                } catch (error) {
                    alert(t('importError') + error.message);
                }
            };
            
            reader.readAsText(file);
            
            // ÌååÏùº ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî (Í∞ôÏùÄ ÌååÏùºÏùÑ Îã§Ïãú ÏÑ†ÌÉùÌï† Ïàò ÏûàÎèÑÎ°ù)
            event.target.value = '';
        }

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        const uploadArea = document.getElementById('uploadArea');
        if (uploadArea) {
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageUpload({ target: { files: files } });
                }
            });
        }

        // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ï≤òÎ¶¨
        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Ïù¥ÎØ∏ÏßÄ ÌååÏùº ÌôïÏù∏
            if (!file.type.startsWith('image/')) {
                alert(t('imageOnly'));
                return;
            }

            // ÎØ∏Î¶¨Î≥¥Í∏∞ ÌëúÏãú
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('previewImage');
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);

            // Î°úÎî© ÌëúÏãú
            document.getElementById('loading').classList.add('active');

            try {
                // Ïù¥ÎØ∏ÏßÄÎ•º base64Î°ú Î≥ÄÌôò
                const base64 = await fileToBase64(file);
                
                // Claude APIÎ°ú Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù
                const expenses = await analyzeImageWithClaude(base64, file.type);
                
                // Î∂ÑÏÑùÎêú ÎÇ¥Ïó≠ Ï∂îÍ∞Ä
                if (expenses && expenses.length > 0) {
                    let addedCount = 0;
                    expenses.forEach(expense => {
                        if (expense.name && expense.amount && expense.amount > 0) {
                            fixedExpenses.push({
                                id: Date.now() + addedCount,
                                name: expense.name,
                                amount: expense.amount
                            });
                            addedCount++;
                        }
                    });

                    if (addedCount > 0) {
                        saveData();
                        updateDisplay();
                        renderFixedList();
                        alert(`${addedCount}${t('fixedItemsAdded')}`);
                    } else {
                        alert(t('noValidExpense'));
                    }
                } else {
                    alert(t('imageAnalysisFailed'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert(t('imageAnalysisError') + error.message);
            } finally {
                // Î°úÎî© Ïà®Í∏∞Í∏∞
                document.getElementById('loading').classList.remove('active');
                // ÌååÏùº ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
                event.target.value = '';
            }
        }

        // ÌååÏùºÏùÑ base64Î°ú Î≥ÄÌôò
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Claude APIÎ°ú Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù
        async function analyzeImageWithClaude(base64Image, mimeType) {
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [
                            {
                                role: 'user',
                                content: [
                                    {
                                        type: 'image',
                                        source: {
                                            type: 'base64',
                                            media_type: mimeType,
                                            data: base64Image
                                        }
                                    },
                                    {
                                        type: 'text',
                                        text: `Ïù¥ Ïù¥ÎØ∏ÏßÄÏóêÏÑú Í≥†Ï†ïÏßÄÏ∂ú Ìï≠Î™©Îì§ÏùÑ Ï∞æÏïÑÏÑú JSON ÌòïÏãùÏúºÎ°ú Ï∂îÏ∂úÌï¥Ï£ºÏÑ∏Ïöî. 
                                        
ÏùëÎãµÏùÄ Î∞òÎìúÏãú JSON Î∞∞Ïó¥ ÌòïÏãùÏúºÎ°úÎßå ÏûëÏÑ±ÌïòÍ≥†, Îã§Î•∏ ÏÑ§Î™ÖÏùÄ Ï†àÎåÄ Ìè¨Ìï®ÌïòÏßÄ ÎßàÏÑ∏Ïöî.
Í∏àÏï°ÏóêÏÑú ÏâºÌëúÎÇò ÌÜµÌôî Í∏∞Ìò∏Îäî Ï†úÍ±∞ÌïòÍ≥† Ïà´ÏûêÎßå ÏûÖÎ†•ÌïòÏÑ∏Ïöî.

ÌòïÏãù:
[
  {"name": "Ìï≠Î™©Î™Ö", "amount": Í∏àÏï°},
  {"name": "Ìï≠Î™©Î™Ö", "amount": Í∏àÏï°}
]

ÏòàÏãú:
[
  {"name": "ÏõîÏÑ∏", "amount": 800},
  {"name": "Ï†ÑÍ∏∞ÏÑ∏", "amount": 50}
]`
                                    }
                                ]
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error('API ÏöîÏ≤≠ Ïã§Ìå®');
                }

                const data = await response.json();
                const textContent = data.content.find(item => item.type === 'text')?.text || '';
                
                // JSON ÌååÏã±
                const jsonMatch = textContent.match(/\[[\s\S]*\]/);
                if (jsonMatch) {
                    const expenses = JSON.parse(jsonMatch[0]);
                    return expenses;
                }
                
                return [];
            } catch (error) {
                console.error('Claude API Error:', error);
                throw error;
            }
        }


        // ===== Dark Mode =====
        let darkMode = localStorage.getItem('budgetDarkMode') === 'true';
        
        function toggleDarkMode() {
            darkMode = !darkMode;
            applyDarkMode();
            localStorage.setItem('budgetDarkMode', darkMode);
        }
        
        function applyDarkMode() {
            document.body.classList.toggle('dark-mode', darkMode);
            const btn = document.getElementById('darkToggle');
            if (btn) btn.textContent = darkMode ? '‚òÄÔ∏è' : 'üåô';
            document.querySelector('meta[name="theme-color"]').content = darkMode ? '#1a1a2e' : '#212529';
            // Update charts if they exist
            if (typeof updateCharts === 'function') updateCharts();
        }

        // ===== Search / Filter =====
        function filterDailyList() {
            const searchTerm = (document.getElementById('expenseSearch')?.value || '').toLowerCase();
            const catFilter = document.getElementById('categoryFilter')?.value || '';
            const payFilter = document.getElementById('paymentFilter')?.value || '';
            
            const items = document.querySelectorAll('#dailyList .list-item');
            items.forEach(item => {
                const name = (item.querySelector('.list-item-name')?.textContent || '').toLowerCase();
                const matchSearch = !searchTerm || name.includes(searchTerm);
                const matchCat = !catFilter || name.includes(getCategoryDisplayName(catFilter));
                let matchPay = true;
                if (payFilter) {
                    if (payFilter === 'income') matchPay = item.classList.contains('income');
                    else if (payFilter === 'transfer') matchPay = item.classList.contains('transfer');
                    else if (payFilter === 'crypto') matchPay = name.includes(t('cryptoBadge'));
                    else if (payFilter === 'regular') matchPay = name.includes(t('regularBadge'));
                }
                item.style.display = (matchSearch && matchCat && matchPay) ? '' : 'none';
            });
        }

        function updateCategoryFilterOptions() {
            const sel = document.getElementById('categoryFilter');
            if (!sel) return;
            const allCats = getAllCategories();
            let html = `<option value="">${t('allCategories')}</option>`;
            allCats.forEach(c => {
                html += `<option value="${c.name}">${c.emoji} ${getCategoryDisplayName(c.name)}</option>`;
            });
            sel.innerHTML = html;
        }

        // ===== Budget Goals =====
        let budgetGoals = JSON.parse(localStorage.getItem('budgetGoals') || '{}');

        function showBudgetSetup() {
            document.getElementById('budgetSetupPanel').style.display = 'block';
            document.getElementById('totalBudgetInput').value = budgetGoals.total || '';
            
            const totalFixed = fixedExpenses.reduce((s, e) => s + e.amount, 0);
            const fixedInfo = document.getElementById('fixedInfoInSetup');
            if (fixedInfo) {
                if (totalFixed > 0) {
                    const items = fixedExpenses.map(f => `${f.name}: ${formatCurrency(f.amount)}`).join(', ');
                    fixedInfo.innerHTML = `<div style="padding: 12px; background: ${darkMode ? '#1a3a5c' : '#e7f5ff'}; border-radius: 6px; font-size: 13px; color: ${darkMode ? '#a5d8ff' : '#1971c2'}; margin-top: 10px;">
                        <div style="margin-bottom: 6px; font-weight: 600;">üìå ${t('fixedExpenses')}: ${formatCurrency(totalFixed)}/Êúà</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">${items}</div>
                        <div style="font-weight: 600;">üí° ${t('variableBudget')}: <span id="variableBudgetPreview" style="font-size: 16px;">${formatCurrency((budgetGoals.total || 0) - totalFixed)}</span></div>
                    </div>`;
                } else {
                    fixedInfo.innerHTML = `<div style="padding: 10px; background: ${darkMode ? '#1a3a5c' : '#fff3bf'}; border-radius: 6px; font-size: 13px; color: ${darkMode ? '#ffd43b' : '#e67700'}; margin-top: 10px;">
                        üí° ${currentLang === 'ko' ? 'Í≥†Ï†ïÏßÄÏ∂úÏùÑ Î®ºÏ†Ä Ï∂îÍ∞ÄÌïòÎ©¥ Î≥ÄÎèô ÏòàÏÇ∞Ïù¥ ÏûêÎèô Í≥ÑÏÇ∞Îê©ÎãàÎã§.' : currentLang === 'de' ? 'Fixkosten hinzuf√ºgen f√ºr automatische Berechnung.' : 'Add fixed expenses first for automatic variable budget calculation.'}
                    </div>`;
                }
            }

            const container = document.getElementById('categoryBudgetInputs');
            const cats = getAllCategories().filter(c => c.name !== 'ÏàòÏûÖ');
            container.innerHTML = cats.map(c => `
                <div class="input-row" style="margin-bottom: 8px;">
                    <div class="input-group" style="flex: 1;">
                        <label>${c.emoji} ${getCategoryDisplayName(c.name)}</label>
                        <input type="number" id="budget_${c.name}" value="${budgetGoals[c.name] || ''}" placeholder="‚Ç¨" step="10">
                    </div>
                </div>
            `).join('');
        }

        function hideBudgetSetup() {
            document.getElementById('budgetSetupPanel').style.display = 'none';
        }

        function updateVariableBudgetPreview() {
            const el = document.getElementById('variableBudgetPreview');
            if (!el) return;
            const total = parseFloat(document.getElementById('totalBudgetInput').value) || 0;
            const totalFixed = fixedExpenses.reduce((s, e) => s + e.amount, 0);
            el.textContent = formatCurrency(total - totalFixed);
            el.style.color = (total - totalFixed) < 0 ? '#fa5252' : '#1971c2';
        }

        function saveBudgetGoals() {
            budgetGoals = {};
            const total = parseFloat(document.getElementById('totalBudgetInput').value);
            if (total) budgetGoals.total = total;
            
            getAllCategories().forEach(c => {
                const input = document.getElementById('budget_' + c.name);
                if (input && input.value) budgetGoals[c.name] = parseFloat(input.value);
            });
            
            localStorage.setItem('budgetGoals', JSON.stringify(budgetGoals));
            hideBudgetSetup();
            renderBudgetGoals();
            alert(t('budgetSaved'));
        }

        function renderBudgetGoals() {
            const container = document.getElementById('budgetGoalsDisplay');
            if (!container) return;
            
            const totalFixed = fixedExpenses.reduce((s, e) => s + e.amount, 0);

            if (!budgetGoals.total && Object.keys(budgetGoals).length === 0) {
                // ÏòàÏÇ∞ ÎØ∏ÏÑ§Ï†ï ÏãúÏóêÎèÑ Í≥†Ï†ïÏßÄÏ∂ú ÏöîÏïΩ ÌëúÏãú
                if (totalFixed > 0) {
                    container.innerHTML = `
                        <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 8px;">${t('noBudgetSet')}</p>
                        <div style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px; color: var(--text-secondary);">
                            üìå ${t('fixedExpenses')}: <strong>${formatCurrency(totalFixed)}</strong>/Êúà
                        </div>`;
                } else {
                    container.innerHTML = `<p style="color: var(--text-muted); font-size: 14px;">${t('noBudgetSet')}</p>`;
                }
                return;
            }

            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth();
            const dailyExp = getMonthlyExpenses(year, month).filter(e => e.type === 'expense');
            const totalDaily = dailyExp.reduce((s, e) => s + e.amount, 0);
            const totalSpent = totalFixed + totalDaily;

            let html = '<div class="budget-section">';
            
            // ===== Ï¥ù ÏòàÏÇ∞ =====
            if (budgetGoals.total) {
                const pct = (totalSpent / budgetGoals.total) * 100;
                const fixedPct = (totalFixed / budgetGoals.total) * 100;
                const dailyPct = (totalDaily / budgetGoals.total) * 100;
                const cls = pct > 100 ? 'over' : pct > 80 ? 'warn' : 'ok';
                const overAmt = totalSpent - budgetGoals.total;
                const remaining = budgetGoals.total - totalSpent;

                html += `
                    <div class="budget-item" style="padding-bottom: 16px;">
                        <div class="budget-header">
                            <span style="font-weight: 600;">üìä ${t('totalBudget').replace(' (‚Ç¨)', '')}</span>
                            <span style="font-size: 14px; color: var(--text-muted);">
                                ${formatCurrency(totalSpent)} / ${formatCurrency(budgetGoals.total)}
                                ${overAmt > 0 ? `<span style="color: #fa5252; font-weight: 600;"> (+${formatCurrency(overAmt)} ${t('over')})</span>` : ''}
                            </span>
                        </div>
                        <!-- Í≥†Ï†ï + Î≥ÄÎèô Ïù¥Ï§ë ÌîÑÎ°úÍ∑∏Î†àÏä§ Î∞î -->
                        <div class="budget-bar-track" style="height: 14px; position: relative;">
                            <div style="position: absolute; height: 100%; border-radius: 5px; background: linear-gradient(90deg, #748ffc, #5c7cfa); width: ${Math.min(fixedPct, 100)}%;"></div>
                            <div style="position: absolute; height: 100%; border-radius: 5px; background: ${pct > 100 ? 'linear-gradient(90deg, #ff8787, #fa5252)' : pct > 80 ? 'linear-gradient(90deg, #ffd43b, #fab005)' : 'linear-gradient(90deg, #69db7c, #51cf66)'}; left: ${Math.min(fixedPct, 100)}%; width: ${Math.min(dailyPct, 100 - Math.min(fixedPct, 100))}%;"></div>
                        </div>
                        <!-- Î≤îÎ°Ä -->
                        <div style="display: flex; gap: 16px; margin-top: 8px; font-size: 12px; flex-wrap: wrap;">
                            <span style="display: flex; align-items: center; gap: 4px;">
                                <span style="width: 10px; height: 10px; border-radius: 2px; background: #5c7cfa; display: inline-block;"></span>
                                <span style="color: var(--text-muted);">üìå ${t('fixedLabel') || 'Í≥†Ï†ï'}: ${formatCurrency(totalFixed)}</span>
                            </span>
                            <span style="display: flex; align-items: center; gap: 4px;">
                                <span style="width: 10px; height: 10px; border-radius: 2px; background: ${cls === 'ok' ? '#51cf66' : cls === 'warn' ? '#fab005' : '#fa5252'}; display: inline-block;"></span>
                                <span style="color: var(--text-muted);">üí∏ ${t('variableLabel') || 'Î≥ÄÎèô'}: ${formatCurrency(totalDaily)}</span>
                            </span>
                            ${remaining > 0 ? `<span style="color: #28a745; font-weight: 600;">üí∞ ${t('remaining2')}: ${formatCurrency(remaining)}</span>` : ''}
                        </div>
                        <!-- Í≥†Ï†ïÏßÄÏ∂ú Ï†úÏô∏ ÎÇ®ÏùÄ Î≥ÄÎèô ÏòàÏÇ∞ -->
                        ${budgetGoals.total > totalFixed ? `
                        <div style="margin-top: 10px; padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;">
                            <div style="display: flex; justify-content: space-between; color: var(--text-secondary);">
                                <span>üí° ${t('variableBudget') || 'Î≥ÄÎèôÏßÄÏ∂ú ÏòàÏÇ∞'} (${t('totalBudget').replace(' (‚Ç¨)', '')} ‚àí ${t('fixedLabel') || 'Í≥†Ï†ï'})</span>
                                <span style="font-weight: 600;">${formatCurrency(budgetGoals.total - totalFixed)}</span>
                            </div>
                            <div class="budget-bar-track" style="margin-top: 6px;">
                                <div class="budget-bar-fill ${totalDaily > (budgetGoals.total - totalFixed) ? 'over' : totalDaily > (budgetGoals.total - totalFixed) * 0.8 ? 'warn' : 'ok'}" 
                                     style="width: ${Math.min((totalDaily / (budgetGoals.total - totalFixed)) * 100, 100)}%"></div>
                            </div>
                            <div style="text-align: right; margin-top: 4px; font-size: 12px; color: var(--text-muted);">
                                ${formatCurrency(totalDaily)} / ${formatCurrency(budgetGoals.total - totalFixed)}
                                ${(budgetGoals.total - totalFixed - totalDaily) > 0 
                                    ? ` ‚Äî <span style="color: #28a745;">${formatCurrency(budgetGoals.total - totalFixed - totalDaily)} ${t('remaining2')}</span>` 
                                    : ` ‚Äî <span style="color: #fa5252;">+${formatCurrency(totalDaily - (budgetGoals.total - totalFixed))} ${t('over')}</span>`}
                            </div>
                        </div>` : ''}
                    </div>`;
            }

            // ===== Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏòàÏÇ∞ (Í≥†Ï†ïÏßÄÏ∂ú Îß§Ïπ≠ Ìè¨Ìï®) =====
            getAllCategories().filter(c => budgetGoals[c.name]).forEach(cat => {
                const catDaily = dailyExp.filter(e => e.category === cat.name).reduce((s, e) => s + e.amount, 0);
                // Í≥†Ï†ïÏßÄÏ∂ú Ï§ë Ïù¥ Ïπ¥ÌÖåÍ≥†Î¶¨ÏôÄ Ïù¥Î¶ÑÏù¥ Îß§Ïπ≠ÎêòÎäî Í≤É Ï∞æÍ∏∞
                const catFixed = fixedExpenses.filter(f => matchFixedToCategory(f.name, cat.name)).reduce((s, e) => s + e.amount, 0);
                const catTotal = catDaily + catFixed;
                const budget = budgetGoals[cat.name];
                const pct = (catTotal / budget) * 100;
                const cls = pct > 100 ? 'over' : pct > 80 ? 'warn' : 'ok';
                const fixedPctCat = (catFixed / budget) * 100;

                html += `
                    <div class="budget-item">
                        <div class="budget-header">
                            <span>${cat.emoji} ${getCategoryDisplayName(cat.name)}</span>
                            <span style="font-size: 13px; color: var(--text-muted);">${formatCurrency(catTotal)} / ${formatCurrency(budget)}</span>
                        </div>
                        <div class="budget-bar-track" style="position: relative;">
                            ${catFixed > 0 ? `<div style="position: absolute; height: 100%; border-radius: 5px; background: #748ffc; width: ${Math.min(fixedPctCat, 100)}%;"></div>` : ''}
                            <div class="budget-bar-fill ${cls}" style="width: ${Math.min(pct, 100)}%; opacity: ${catFixed > 0 ? '0.7' : '1'};"></div>
                        </div>
                        ${catFixed > 0 ? `<div style="font-size: 11px; color: var(--text-muted); margin-top: 3px;">üìå ${formatCurrency(catFixed)} + üí∏ ${formatCurrency(catDaily)}</div>` : ''}
                    </div>`;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Í≥†Ï†ïÏßÄÏ∂ú Ïù¥Î¶Ñ ‚Üí Ïπ¥ÌÖåÍ≥†Î¶¨ Îß§Ïπ≠ (ÌÇ§ÏõåÎìú Í∏∞Î∞ò)
        function matchFixedToCategory(fixedName, categoryName) {
            const name = fixedName.toLowerCase();
            const catMap = {
                'ÏãùÎπÑ': ['ÏãùÎπÑ', 'ÏùåÏãù', 'food', 'grocery', 'market', 'lebensmittel', 'essen', 'meal', 'lunch', 'dinner'],
                'ÍµêÌÜµ': ['ÍµêÌÜµ', 'Ï£ºÏú†', 'Î≤ÑÏä§', 'ÏßÄÌïòÏ≤†', 'Ï£ºÏ∞®', 'transport', 'gas', 'fuel', 'verkehr', 'tanken', 'parking', 'metro', 'bahn', 'db '],
                'ÏáºÌïë': ['ÏáºÌïë', 'shopping', 'einkauf', 'amazon', 'ebay', 'otto'],
                'Î¨∏ÌôîÏÉùÌôú': ['Î¨∏Ìôî', 'entertainment', 'unterhaltung', 'kino', 'theater', 'museum', 'concert'],
                'Íµ¨ÎèÖÎ£å': ['Íµ¨ÎèÖ', 'Î©§Î≤ÑÏã≠', 'subscription', 'member', 'abo', 'premium', 'netflix', 'spotify', 'youtube', 'apple', 'icloud', 'google one', 'disney', 'hbo', 'amazon prime', 'chatgpt', 'gpt', 'claude', 'github'],
                'ÏùòÎ£å': ['ÏùòÎ£å', 'Î≥¥Ìóò', 'Î≥ëÏõê', 'ÏïΩÍµ≠', 'ÏïΩ', 'Í±¥Í∞ï', 'medical', 'insurance', 'health', 'versicherung', 'arzt', 'kranken', 'pharmacy', 'apotheke', 'krankenkasse'],
                'ÍµêÏú°': ['ÍµêÏú°', 'ÌïôÏõê', 'Í∞ïÏùò', 'ÌïôÎπÑ', 'ÏàòÏóÖ', 'education', 'course', 'tuition', 'bildung', 'kurs', 'udemy', 'coursera'],
                'Í∏∞ÌÉÄ': ['ÏõîÏÑ∏', 'ÏßëÏÑ∏', 'Í¥ÄÎ¶¨ÎπÑ', 'Ï†ÑÍ∏∞', 'Í∞ÄÏä§', 'ÏàòÎèÑ', 'Ïù∏ÌÑ∞ÎÑ∑', 'Ìï∏ÎìúÌè∞', 'ÌÜµÏã†', 'rent', 'miete', 'strom', 'electricity', 'water', 'wasser', 'internet', 'phone', 'handy', 'mobilfunk', 'nebenkosten', 'utility', 'utilities']
            };
            const keywords = catMap[categoryName] || [];
            return keywords.some(kw => name.includes(kw));
        }

        // ===== Charts =====
        let donutChartInst = null;
        let barChartInst = null;

        function updateCharts() {
            renderDonutChart();
            renderBarChart();
            renderMoMComparison();
        }

        function renderDonutChart() {
            const canvas = document.getElementById('donutChart');
            if (!canvas || typeof Chart === 'undefined') return;

            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth();
            const monthlyExp = getMonthlyExpenses(year, month).filter(e => e.type === 'expense');

            const categoryTotals = {};
            monthlyExp.forEach(e => {
                const cat = e.category || 'Í∏∞ÌÉÄ';
                categoryTotals[cat] = (categoryTotals[cat] || 0) + e.amount;
            });

            // Í≥†Ï†ïÏßÄÏ∂úÏùÑ Î≥ÑÎèÑ Ìï≠Î™©ÏúºÎ°ú Ï∂îÍ∞Ä
            const totalFixed = fixedExpenses.reduce((s, e) => s + e.amount, 0);
            if (totalFixed > 0) {
                const fixedLabel = t('fixedLabel') || 'Í≥†Ï†ï';
                categoryTotals['üìå ' + fixedLabel] = totalFixed;
            }

            const sorted = Object.entries(categoryTotals).sort((a, b) => b[1] - a[1]);
            const labels = sorted.map(([cat]) => cat.startsWith('üìå') ? cat : getCategoryDisplayName(cat));
            const data = sorted.map(([, amt]) => amt);
            const colors = ['#667eea','#764ba2','#f093fb','#f5576c','#4facfe','#43e97b','#fa709a','#fee140','#a18cd1','#fbc2eb','#748ffc','#99e9f2'];

            if (donutChartInst) donutChartInst.destroy();
            const textColor = darkMode ? '#e4e6eb' : '#212529';
            donutChartInst = new Chart(canvas, {
                type: 'doughnut',
                data: { labels, datasets: [{ data, backgroundColor: colors.slice(0, data.length), borderWidth: 0 }] },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: textColor, padding: 12, font: { size: 12 } } },
                        tooltip: {
                            callbacks: {
                                label: function(ctx) {
                                    const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                    const pct = ((ctx.raw / total) * 100).toFixed(1);
                                    return ` ${ctx.label}: ‚Ç¨${ctx.raw.toFixed(2)} (${pct}%)`;
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        function renderBarChart() {
            const canvas = document.getElementById('barChart');
            if (!canvas || typeof Chart === 'undefined') return;

            const labels = [];
            const fixedArr = [];
            const variableArr = [];
            const incomes = [];
            const now = new Date(currentViewMonth);
            const totalFixed = fixedExpenses.reduce((s, e) => s + e.amount, 0);

            for (let i = 5; i >= 0; i--) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const y = d.getFullYear(), m = d.getMonth();
                const mLabel = typeof t('monthNames') === 'object' ? t('monthNames')[m] : (m + 1) + 'Ïõî';
                labels.push(mLabel);
                
                const mExp = getMonthlyExpenses(y, m);
                const dailyTotal = mExp.filter(e => e.type === 'expense').reduce((s, e) => s + e.amount, 0);
                fixedArr.push(totalFixed);
                variableArr.push(dailyTotal);
                incomes.push(mExp.filter(e => e.type === 'income').reduce((s, e) => s + e.amount, 0));
            }

            if (barChartInst) barChartInst.destroy();
            const textColor = darkMode ? '#e4e6eb' : '#212529';
            const gridColor = darkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
            barChartInst = new Chart(canvas, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [
                        { label: 'üìå ' + (t('fixedLabel') || 'Í≥†Ï†ï'), data: fixedArr, backgroundColor: '#748ffc', borderRadius: 4, stack: 'expense' },
                        { label: 'üí∏ ' + (t('variableLabel') || 'Î≥ÄÎèô'), data: variableArr, backgroundColor: '#ff6b6b', borderRadius: 4, stack: 'expense' },
                        { label: 'üí∞ ' + (t('income') || 'ÏàòÏûÖ').replace('üí∞ ', ''), data: incomes, backgroundColor: '#51cf66', borderRadius: 4, stack: 'income' }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: textColor, font: { size: 11 } } } },
                    scales: {
                        x: { stacked: true, ticks: { color: textColor }, grid: { color: gridColor } },
                        y: { stacked: true, ticks: { color: textColor, callback: v => '‚Ç¨' + v }, grid: { color: gridColor } }
                    }
                }
            });
        }

        function renderMoMComparison() {
            const container = document.getElementById('momComparison');
            if (!container) return;

            const y = currentViewMonth.getFullYear(), m = currentViewMonth.getMonth();
            const prevDate = new Date(y, m - 1, 1);
            const currExp = getMonthlyExpenses(y, m).filter(e => e.type === 'expense');
            const prevExp = getMonthlyExpenses(prevDate.getFullYear(), prevDate.getMonth()).filter(e => e.type === 'expense');

            const totalFixed = fixedExpenses.reduce((s, e) => s + e.amount, 0);
            const currDaily = currExp.reduce((s, e) => s + e.amount, 0);
            const prevDaily = prevExp.reduce((s, e) => s + e.amount, 0);
            // Ï¥ù ÏßÄÏ∂ú = Í≥†Ï†ï + Î≥ÄÎèô
            const currTotal = totalFixed + currDaily;
            const prevTotal = totalFixed + prevDaily;

            if (prevDaily === 0 && totalFixed === 0) {
                container.innerHTML = `<p style="color: var(--text-muted); font-size: 14px;">${t('noLastMonthData')}</p>`;
                return;
            }

            // Î≥ÄÎèôÏßÄÏ∂úÎßå ÎπÑÍµê (Í≥†Ï†ïÏùÄ Îß§Îã¨ Í∞ôÏúºÎãàÍπå)
            const diff = currDaily - prevDaily;
            const pctChange = prevDaily > 0 ? ((diff / prevDaily) * 100).toFixed(1) : (currDaily > 0 ? '‚àû' : '0');
            const isUp = diff > 0;
            const arrow = isUp ? 'üìà' : diff < 0 ? 'üìâ' : '‚û°Ô∏è';
            const color = isUp ? '#fa5252' : diff < 0 ? '#51cf66' : 'var(--text-muted)';
            const label = isUp ? t('increased') : diff < 0 ? t('decreased') : t('same');

            let html = `<div style="display: flex; align-items: center; gap: 15px; padding: 10px 0;">
                <span style="font-size: 28px;">${arrow}</span>
                <div>
                    <div style="font-size: 20px; font-weight: 700; color: ${color};">${isUp ? '+' : ''}${pctChange}% ${label}</div>
                    <div style="font-size: 13px; color: var(--text-muted);">
                        üí∏ ${t('variableLabel')}: ${formatCurrency(prevDaily)} ‚Üí ${formatCurrency(currDaily)} (${isUp ? '+' : ''}${formatCurrency(diff)})
                    </div>
                    ${totalFixed > 0 ? `<div style="font-size: 12px; color: var(--text-muted); margin-top: 2px;">
                        üìå ${t('fixedLabel')}: ${formatCurrency(totalFixed)}/Êúà ¬∑ ${currentLang === 'ko' ? 'Ï¥ù' : 'Total'}: ${formatCurrency(currTotal)}
                    </div>` : ''}
                </div>
            </div>`;

            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÎπÑÍµê (Î≥ÄÎèôÏßÄÏ∂úÎßå)
            const allCats = new Set([...currExp.map(e => e.category), ...prevExp.map(e => e.category)]);
            let catHtml = '';
            allCats.forEach(cat => {
                if (!cat) return;
                const curr = currExp.filter(e => e.category === cat).reduce((s, e) => s + e.amount, 0);
                const prev = prevExp.filter(e => e.category === cat).reduce((s, e) => s + e.amount, 0);
                if (curr === 0 && prev === 0) return;
                const d = prev > 0 ? (((curr - prev) / prev) * 100).toFixed(0) : (curr > 0 ? '+‚àû' : '0');
                const c = curr > prev ? '#fa5252' : curr < prev ? '#51cf66' : 'var(--text-muted)';
                const emoji = getCategoryEmoji(cat);
                catHtml += `<div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px; border-bottom: 1px solid var(--border-color);">
                    <span>${emoji} ${getCategoryDisplayName(cat)}</span>
                    <span style="color: ${c}; font-weight: 600;">${d > 0 ? '+' : ''}${d}% (${formatCurrency(curr)})</span>
                </div>`;
            });
            if (catHtml) html += `<div style="margin-top: 10px;">${catHtml}</div>`;

            container.innerHTML = html;
        }

        // ===== Google Drive Integration =====
        const GDRIVE_API_KEY = ''; // User needs to set this
        const GDRIVE_CLIENT_ID = ''; // User needs to set this
        let gdriveReady = false;

        function saveToGDrive() {
            // If no API key configured, offer download + manual upload instructions
            if (!GDRIVE_API_KEY || !GDRIVE_CLIENT_ID) {
                // Fallback: Export and open Google Drive
                exportData();
                const driveUrl = 'https://drive.google.com/drive/my-drive';
                if (confirm(currentLang === 'ko' 
                    ? 'JSON ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§. Google DriveÎ•º Ïó¥Ïñ¥ÏÑú ÏóÖÎ°úÎìúÌïòÏãúÍ≤†ÏäµÎãàÍπå?' 
                    : currentLang === 'de'
                    ? 'JSON-Datei wurde heruntergeladen. Google Drive √∂ffnen zum Hochladen?'
                    : 'JSON file downloaded. Open Google Drive to upload?')) {
                    window.open(driveUrl, '_blank');
                }
                return;
            }

            // Full API integration
            const btn = document.getElementById('gdriveSaveBtn');
            btn.disabled = true;
            btn.innerHTML = `‚è≥ ${t('gdriveSaving')}`;

            gapi.load('client:auth2', async () => {
                try {
                    await gapi.client.init({
                        apiKey: GDRIVE_API_KEY,
                        clientId: GDRIVE_CLIENT_ID,
                        scope: 'https://www.googleapis.com/auth/drive.file'
                    });
                    
                    const authInst = gapi.auth2.getAuthInstance();
                    if (!authInst.isSignedIn.get()) {
                        await authInst.signIn();
                    }

                    const data = {
                        salaries, fixedExpenses, dailyExpenses, customCategories, assets,
                        exportDate: new Date().toISOString(),
                        version: 'v2'
                    };

                    const boundary = '-------314159265358979323846';
                    const metadata = JSON.stringify({
                        name: 'budget-backup.json',
                        mimeType: 'application/json'
                    });
                    const body = `--${boundary}\r\nContent-Type: application/json\r\n\r\n${metadata}\r\n--${boundary}\r\nContent-Type: application/json\r\n\r\n${JSON.stringify(data)}\r\n--${boundary}--`;

                    await gapi.client.request({
                        path: '/upload/drive/v3/files',
                        method: 'POST',
                        params: { uploadType: 'multipart' },
                        headers: { 'Content-Type': `multipart/related; boundary=${boundary}` },
                        body: body
                    });

                    btn.innerHTML = `‚úÖ ${t('gdriveSaved')}`;
                    setTimeout(() => { btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M7.71 3.5L1.15 15l4.58 7.5h13.54l4.58-7.5L17.29 3.5H7.71z"/></svg> Google Drive'; btn.disabled = false; }, 3000);
                } catch (e) {
                    console.error('GDrive error:', e);
                    btn.innerHTML = `‚ùå ${t('gdriveError')}`;
                    btn.disabled = false;
                }
            });
        }

        // ===== PWA Service Worker =====
        function initPWA() {
            // Dynamic manifest
            const manifest = {
                name: t('title').replace(/[^\w\s]/g, '').trim(),
                short_name: 'Budget',
                start_url: window.location.href.split('?')[0],
                display: 'standalone',
                background_color: darkMode ? '#1a1a2e' : '#ffffff',
                theme_color: darkMode ? '#1a1a2e' : '#212529',
                icons: [{ src: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üí∞</text></svg>', sizes: '512x512', type: 'image/svg+xml' }]
            };
            const blob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
            document.getElementById('pwa-manifest').href = URL.createObjectURL(blob);

            // Service worker
            if ('serviceWorker' in navigator) {
                const swCode = `
                    const CACHE = 'budget-v1';
                    self.addEventListener('install', e => {
                        e.waitUntil(caches.open(CACHE).then(c => c.addAll([self.location.href.replace('sw.js', '')])));
                    });
                    self.addEventListener('fetch', e => {
                        e.respondWith(fetch(e.request).catch(() => caches.match(e.request)));
                    });
                `;
                const swBlob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(swBlob);
                navigator.serviceWorker.register(swUrl).catch(() => {});
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        loadData();

        // Ïñ∏Ïñ¥ ÏÑ§Ï†ï Ï†ÅÏö©
        document.getElementById('langSelect').value = currentLang;
        applyLanguage();

        // ÌîÑÎùºÏù¥Î≤ÑÏãú Î™®Îìú Ï†ÅÏö©
        applyPrivacy();

        // Dark mode Ï†ÅÏö©
        applyDarkMode();

        // PWA Ï¥àÍ∏∞Ìôî
        initPWA();

        // Í≤ÄÏÉâ ÌïÑÌÑ∞ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏòµÏÖò Ï¥àÍ∏∞Ìôî
        updateCategoryFilterOptions();

        // Ï∫êÏãúÎêú ÌôòÏú®Ïù¥ ÏûàÏúºÎ©¥ ÏÉÅÌÉú ÌëúÏãú
        if (ratesLastUpdated) {
            updateRateStatusUI('success');
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ïã§ÏãúÍ∞Ñ ÌôòÏú® ÏûêÎèô Ï°∞Ìöå
        fetchLiveRates();

        // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌÜµÍ≥Ñ Î†åÎçîÎßÅ
        function renderCategoryStats() {
            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth();
            
            // Ìï¥Îãπ ÏõîÏùò ÏßÄÏ∂úÎßå Í∞ÄÏ†∏Ïò§Í∏∞ (ÏàòÏûÖ Ï†úÏô∏)
            const monthlyExpenses = getMonthlyExpenses(year, month).filter(e => e.type === 'expense');
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú Í∑∏Î£πÌôî
            const categoryTotals = {};
            monthlyExpenses.forEach(expense => {
                const category = expense.category || 'Í∏∞ÌÉÄ';
                if (!categoryTotals[category]) {
                    categoryTotals[category] = { daily: 0, fixed: 0 };
                }
                categoryTotals[category].daily += expense.amount;
            });

            // Í≥†Ï†ïÏßÄÏ∂úÏùÑ Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê Îß§Ïπ≠
            fixedExpenses.forEach(f => {
                let matched = false;
                for (const catName of Object.keys(categoryTotals)) {
                    if (matchFixedToCategory(f.name, catName)) {
                        categoryTotals[catName].fixed += f.amount;
                        matched = true;
                        break;
                    }
                }
                if (!matched) {
                    // Í∏∞Ï°¥ Ïπ¥ÌÖåÍ≥†Î¶¨ Ï§ë Îß§Ïπ≠ ÏãúÎèÑ
                    const allCats = getAllCategories();
                    for (const cat of allCats) {
                        if (cat.name !== 'ÏàòÏûÖ' && matchFixedToCategory(f.name, cat.name)) {
                            if (!categoryTotals[cat.name]) categoryTotals[cat.name] = { daily: 0, fixed: 0 };
                            categoryTotals[cat.name].fixed += f.amount;
                            matched = true;
                            break;
                        }
                    }
                }
                if (!matched) {
                    // Îß§Ïπ≠ Ïïà ÎêòÎ©¥ "üìå Í≥†Ï†ïÏßÄÏ∂ú" Î≥ÑÎèÑ Ìï≠Î™©
                    const fixedKey = 'üìå ' + (t('fixedLabel') || 'Í≥†Ï†ï');
                    if (!categoryTotals[fixedKey]) categoryTotals[fixedKey] = { daily: 0, fixed: 0 };
                    categoryTotals[fixedKey].fixed += f.amount;
                }
            });

            // Ï¥ù ÏßÄÏ∂ú Í≥ÑÏÇ∞
            const totalExpense = Object.values(categoryTotals).reduce((sum, v) => sum + v.daily + v.fixed, 0);

            const statsContainer = document.getElementById('categoryStats');
            
            if (totalExpense === 0) {
                statsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <p>${t('noExpenseThisMonth')}</p>
                    </div>
                `;
                return;
            }

            // Í∏àÏï°ÏàúÏúºÎ°ú Ï†ïÎ†¨
            const sortedCategories = Object.entries(categoryTotals)
                .map(([cat, v]) => [cat, v.daily + v.fixed, v.daily, v.fixed])
                .sort((a, b) => b[1] - a[1]);

            let html = '<div style="margin-top: 15px;">';
            sortedCategories.forEach(([category, total, daily, fixed]) => {
                const percentage = (total / totalExpense * 100).toFixed(1);
                const isFixedOnly = category.startsWith('üìå');
                const emoji = isFixedOnly ? '' : getCategoryEmoji(category);
                const displayName = isFixedOnly ? category : getCategoryDisplayName(category);
                
                // Í≥†Ï†ï+Î≥ÄÎèô ÏÉÅÏÑ∏
                let detail = '';
                if (fixed > 0 && daily > 0) {
                    detail = `<span style="font-size: 11px; color: var(--text-muted); margin-left: 6px;">üìå${formatCurrency(fixed)} + üí∏${formatCurrency(daily)}</span>`;
                } else if (fixed > 0) {
                    detail = `<span style="font-size: 11px; color: var(--text-muted); margin-left: 6px;">üìå ${t('fixedLabel') || 'Í≥†Ï†ï'}</span>`;
                }

                // ÌîÑÎ°úÍ∑∏Î†àÏä§ Î∞î ÏÉâÏÉÅ: Í≥†Ï†ï=ÌååÎûë, Î≥ÄÎèô=Î≥¥Îùº
                const fixedPct = (fixed / totalExpense * 100).toFixed(1);
                const dailyPct = (daily / totalExpense * 100).toFixed(1);
                
                html += `
                    <div class="category-stats-item" onclick="showCategoryDetails('${category}')" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: 600; color: var(--text-primary);">${emoji} ${displayName}${detail}</span>
                            <div style="text-align: right;">
                                <span style="font-weight: bold; color: var(--text-primary); margin-right: 10px;">${formatCurrency(total)}</span>
                                <span style="color: var(--text-muted); font-size: 14px;">${percentage}%</span>
                            </div>
                        </div>
                        <div style="background: var(--bg-secondary); height: 8px; border-radius: 4px; overflow: hidden; position: relative;">
                            ${fixed > 0 ? `<div style="position:absolute; background: #748ffc; height: 100%; width: ${fixedPct}%; border-radius: 4px;"></div>` : ''}
                            <div style="position:absolute; left: ${fixed > 0 ? fixedPct : 0}%; background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: ${dailyPct}%; border-radius: 4px;"></div>
                        </div>
                    </div>
                `;
            });
            
            // Î≤îÎ°Ä
            if (fixedExpenses.length > 0) {
                html += `<div style="display: flex; gap: 16px; margin-top: 12px; font-size: 11px; color: var(--text-muted);">
                    <span style="display: flex; align-items: center; gap: 4px;">
                        <span style="width: 10px; height: 10px; border-radius: 2px; background: #748ffc; display: inline-block;"></span> üìå ${t('fixedLabel') || 'Í≥†Ï†ï'}
                    </span>
                    <span style="display: flex; align-items: center; gap: 4px;">
                        <span style="width: 10px; height: 10px; border-radius: 2px; background: #667eea; display: inline-block;"></span> üí∏ ${t('variableLabel') || 'Î≥ÄÎèô'}
                    </span>
                </div>`;
            }
            html += '</div>';

            statsContainer.innerHTML = html;
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ Î™®Îã¨ ÌëúÏãú
        function showCategoryDetails(categoryName) {
            const year = currentViewMonth.getFullYear();
            const month = currentViewMonth.getMonth();
            
            const isFixedCategory = categoryName.startsWith('üìå');

            // Ìï¥Îãπ ÏõîÏùò Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏùºÎ≥Ñ ÏßÄÏ∂ú
            const categoryExpenses = isFixedCategory ? [] : getMonthlyExpenses(year, month).filter(e => 
                e.type === 'expense' && e.category === categoryName
            );

            // Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê Îß§Ïπ≠ÎêòÎäî Í≥†Ï†ïÏßÄÏ∂ú
            const matchedFixed = isFixedCategory 
                ? fixedExpenses.filter(f => {
                    // "üìå Í≥†Ï†ï" Ïπ¥ÌÖåÍ≥†Î¶¨ = Ïñ¥ÎîîÏóêÎèÑ Îß§Ïπ≠ Ïïà Îêú Í≥†Ï†ïÏßÄÏ∂ú
                    const allCats = getAllCategories();
                    return !allCats.some(c => c.name !== 'ÏàòÏûÖ' && matchFixedToCategory(f.name, c.name));
                })
                : fixedExpenses.filter(f => matchFixedToCategory(f.name, categoryName));

            if (categoryExpenses.length === 0 && matchedFixed.length === 0) {
                return;
            }

            // ÎÇ†ÏßúÏàú Ï†ïÎ†¨ (ÏµúÏã†Ïàú)
            const sorted = [...categoryExpenses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const emoji = isFixedCategory ? 'üìå' : getCategoryEmoji(categoryName);
            const displayName = isFixedCategory ? categoryName : getCategoryDisplayName(categoryName);
            const dailyTotal = categoryExpenses.reduce((sum, e) => sum + e.amount, 0);
            const fixedTotal = matchedFixed.reduce((sum, e) => sum + e.amount, 0);
            const total = dailyTotal + fixedTotal;
            const itemCount = categoryExpenses.length + matchedFixed.length;
            
            document.getElementById('modalDate').textContent = `${emoji} ${displayName} (${itemCount}Í±¥)`;

            let html = '<div style="max-height: 400px; overflow-y: auto;">';
            
            // Í≥†Ï†ïÏßÄÏ∂ú Ìï≠Î™© Î®ºÏ†Ä ÌëúÏãú
            matchedFixed.forEach(f => {
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border-color); background: ${darkMode ? '#1a3a5c' : '#e7f5ff'};">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">üìå ${f.name} <span style="font-size: 11px; padding: 2px 6px; background: #748ffc; color: white; border-radius: 4px;">${t('fixedLabel') || 'Í≥†Ï†ï'}</span></div>
                            <div style="font-size: 13px; color: var(--text-muted);">${currentLang === 'ko' ? 'Îß§Ïõî Í≥†Ï†ï' : currentLang === 'de' ? 'Monatlich fix' : 'Monthly fixed'}</div>
                        </div>
                        <div style="font-weight: bold; color: var(--text-primary); white-space: nowrap; margin-left: 15px;">
                            ${formatCurrency(f.amount)}
                        </div>
                    </div>
                `;
            });

            // ÏùºÎ≥Ñ ÏßÄÏ∂ú Ìï≠Î™©
            sorted.forEach(expense => {
                const paymentBadge = expense.paymentMethod === 'crypto' 
                    ? `<span class="payment-badge crypto">${t('cryptoBadge')}</span>`
                    : `<span class="payment-badge regular">${t('regularBadge')}</span>`;
                
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border-color);">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">${expense.name} ${paymentBadge}</div>
                            <div style="font-size: 13px; color: var(--text-muted);">${expense.date}</div>
                        </div>
                        <div style="font-weight: bold; color: var(--text-primary); white-space: nowrap; margin-left: 15px;">
                            ${formatCurrency(expense.amount)}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            html += `
                <div class="modal-total">
                    <span>${t('totalExpense')}</span>
                    <span>${formatCurrency(total)}</span>
                </div>
                ${fixedTotal > 0 && dailyTotal > 0 ? `<div style="font-size: 12px; color: var(--text-muted); text-align: right; margin-top: 4px;">üìå ${formatCurrency(fixedTotal)} + üí∏ ${formatCurrency(dailyTotal)}</div>` : ''}
            `;

            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('dateModal').classList.add('active');
        }
    </script>
</body>
</html>
